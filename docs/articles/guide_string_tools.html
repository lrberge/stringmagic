<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>String tools: magic edition • stringmagic</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="String tools: magic edition">
<meta property="og:description" content="stringmagic">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">stringmagic</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    </li>
<li class="dropdown-header">Guides</li>
    <li>
      <a href="../articles/guide_string_magic.html">`string_magic`: Magical String Interpolation</a>
    </li>
    <li>
      <a href="../articles/guide_string_tools.html">String tools: magic edition</a>
    </li>
    <li>
      <a href="../articles/guide_customization.html">Tailor-made functions and operations</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">References</li>
    <li>
      <a href="../articles/ref_operations.html">`string_magic`'s operations: The reference</a>
    </li>
    <li>
      <a href="../articles/ref_string_magic_special_operations.html">`string_magic`'s sepcial operations</a>
    </li>
    <li>
      <a href="../articles/ref_regex_flags.html">Regular expression flags</a>
    </li>
    <li>
      <a href="../articles/ref_regex_logic.html">Regular expression logic</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/lrberge/stringmagic/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>String tools: magic edition</h1>
                        <h4 data-toc-skip class="author">Laurent R.
Bergé</h4>
            
            <h4 data-toc-skip class="date">2024-04-25</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/lrberge/stringmagic/blob/HEAD/vignettes/guide_string_tools.rmd" class="external-link"><code>vignettes/guide_string_tools.rmd</code></a></small>
      <div class="hidden name"><code>guide_string_tools.rmd</code></div>

    </div>

    
    
<p>This vignette describes <code>stringmagic</code> tools for handling
character vectors. It details:</p>
<ul>
<li>how to <a href="#sec_detect">detect complex regex (=regular
expression) patterns</a>
</li>
<li>how to easily, and clearly, <a href="#sec_ops">chain multiple string
operations</a>
</li>
<li>how to efficiently, and clearly, <a href="#sec_clean">clean
character strings</a>
</li>
<li>how to quickly <a href="#sec_vec">create character vectors</a>
</li>
<li>how to <a href="#sec_split">split a vector and turn the result into
a data frame, and vice versa</a>
</li>
</ul>
<div class="section level2">
<h2 id="sec_detect">Detection of regex patterns<a class="anchor" aria-label="anchor" href="#sec_detect"></a>
</h2>
<p>Detecting a single regex pattern is pretty straightforward with
regular tools like <code><a href="https://rdrr.io/r/base/grep.html" class="external-link">base::grepl</a></code> or
<code>stringr::string_detect</code>. Things become more complicated when
we want to detect the presence of multiple patterns.</p>
<p><code>stringmagic</code> offers three functions with an intuitive
syntax to deal with complex pattern detection:</p>
</div>
<div class="section level2">
<h2 id="detect_funs">Pattern detection with <code>string_is</code>,
<code>string_which</code> and <code>string_get</code><a class="anchor" aria-label="anchor" href="#detect_funs"></a>
</h2>
<p>Use <code>string_is</code>, <code>string_which</code> and
<code>string_get</code> to detect patterns in character vectors and
obtain either a logical vector, an integer vector, or the values.</p>
<p>In this section we give examples for <code>string_get</code> which
hopefully will be explicit enough to illustrate how it works. For the
record, <code>string_get</code> uses <code>string_is</code> internally
so these examples are equivalent with <code>string_is</code> or
<code>string_which</code>.</p>
<p>Ex.1: series of examples using the <em>recommended syntax</em>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cars</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/cat_magic.html">cat_magic</a></span><span class="op">(</span><span class="st">"All cars from mtcars:\n{C, 60 width ? cars}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; All cars from mtcars:</span></span>
<span><span class="co">#&gt; Mazda RX4, Mazda RX4 Wag, Datsun 710, Hornet 4 Drive, Hornet</span></span>
<span><span class="co">#&gt; Sportabout, Valiant, Duster 360, Merc 240D, Merc 230, Merc</span></span>
<span><span class="co">#&gt; 280, Merc 280C, Merc 450SE, Merc 450SL, Merc 450SLC,</span></span>
<span><span class="co">#&gt; Cadillac Fleetwood, Lincoln Continental, Chrysler Imperial,</span></span>
<span><span class="co">#&gt; Fiat 128, Honda Civic, Toyota Corolla, Toyota Corona, Dodge</span></span>
<span><span class="co">#&gt; Challenger, AMC Javelin, Camaro Z28, Pontiac Firebird, Fiat</span></span>
<span><span class="co">#&gt; X1-9, Porsche 914-2, Lotus Europa, Ford Pantera L, Ferrari</span></span>
<span><span class="co">#&gt; Dino, Maserati Bora and Volvo 142E</span></span>
<span></span>
<span><span class="co"># cars with an 'a', an 'e', an 'i', and an 'o', all in lower case</span></span>
<span><span class="fu"><a href="../reference/string_get.html">string_get</a></span><span class="op">(</span><span class="va">cars</span>, <span class="st">"a &amp; e &amp; i &amp; o"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Cadillac Fleetwood"  "Lincoln Continental" "Pontiac Firebird"   </span></span>
<span><span class="co">#&gt; [4] "Ferrari Dino"        "Maserati Bora"</span></span>
<span></span>
<span><span class="co"># cars with no 'e' and at least one digit</span></span>
<span><span class="fu"><a href="../reference/string_get.html">string_get</a></span><span class="op">(</span><span class="va">cars</span>, <span class="st">"!e &amp; \\d"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Mazda RX4"     "Mazda RX4 Wag" "Datsun 710"    "Fiat 128"     </span></span>
<span><span class="co">#&gt; [5] "Camaro Z28"    "Fiat X1-9"     "Volvo 142E"</span></span>
<span></span>
<span><span class="co"># flags apply to all</span></span>
<span><span class="co"># contains the 'words' 2, 9 or l</span></span>
<span><span class="co"># alternative syntax for flags: "wi/2 | 9 | l"</span></span>
<span><span class="fu"><a href="../reference/string_get.html">string_get</a></span><span class="op">(</span><span class="va">cars</span>, <span class="st">"word, ignore/2 | 9 | l"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Fiat X1-9"      "Porsche 914-2"  "Ford Pantera L"</span></span></code></pre></div>
<p>The default syntax is <code>string_get(x, ...)</code> (same for
<code>string_is</code> and <code>string_which</code>), where
<code>...</code> contains any number of patterns to detect. By default
the results of these pattern detections are combined with a logical AND.
To combine them with a logical OR, you need to use the argument
<code>or = TRUE</code>. You can also pass the flags as regular function
arguments. They then apply to all patterns.</p>
<p>Ex.2: replication of Ex.1 using an alternative syntax.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># string_get(cars, "a &amp; e &amp; i &amp; o")</span></span>
<span><span class="co"># cars with an 'a', an 'e', an 'i', and an 'o', all in lower case</span></span>
<span><span class="fu"><a href="../reference/string_get.html">string_get</a></span><span class="op">(</span><span class="va">cars</span>, <span class="st">"a"</span>, <span class="st">"e"</span>, <span class="st">"i"</span>, <span class="st">"o"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Cadillac Fleetwood"  "Lincoln Continental" "Pontiac Firebird"   </span></span>
<span><span class="co">#&gt; [4] "Ferrari Dino"        "Maserati Bora"</span></span>
<span></span>
<span><span class="co"># string_get(cars, "!e &amp; \\d")</span></span>
<span><span class="co"># cars with no 'e' and at least one digit</span></span>
<span><span class="fu"><a href="../reference/string_get.html">string_get</a></span><span class="op">(</span><span class="va">cars</span>, <span class="st">"!e"</span>, <span class="st">"\\d"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Mazda RX4"     "Mazda RX4 Wag" "Datsun 710"    "Fiat 128"     </span></span>
<span><span class="co">#&gt; [5] "Camaro Z28"    "Fiat X1-9"     "Volvo 142E"</span></span>
<span></span>
<span><span class="co"># string_get(cars, "!/e &amp; \\d")</span></span>
<span><span class="co"># This example cannot be replicated directly, we need to apply logical equivalence</span></span>
<span><span class="fu"><a href="../reference/string_get.html">string_get</a></span><span class="op">(</span><span class="va">cars</span>, <span class="st">"!e"</span>, <span class="st">"!\\d"</span>, or <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "Mazda RX4"           "Mazda RX4 Wag"       "Datsun 710"         </span></span>
<span><span class="co">#&gt;  [4] "Hornet Sportabout"   "Valiant"             "Cadillac Fleetwood" </span></span>
<span><span class="co">#&gt;  [7] "Lincoln Continental" "Chrysler Imperial"   "Fiat 128"           </span></span>
<span><span class="co">#&gt; [10] "Honda Civic"         "Toyota Corolla"      "Toyota Corona"      </span></span>
<span><span class="co">#&gt; [13] "Dodge Challenger"    "AMC Javelin"         "Camaro Z28"         </span></span>
<span><span class="co">#&gt; [16] "Pontiac Firebird"    "Fiat X1-9"           "Lotus Europa"       </span></span>
<span><span class="co">#&gt; [19] "Ford Pantera L"      "Ferrari Dino"        "Maserati Bora"      </span></span>
<span><span class="co">#&gt; [22] "Volvo 142E"</span></span>
<span></span>
<span><span class="co"># string_get(cars, "wi/2 | 9 | l")</span></span>
<span><span class="co"># contains the 'words' 2, 9 or l</span></span>
<span><span class="fu"><a href="../reference/string_get.html">string_get</a></span><span class="op">(</span><span class="va">cars</span>, <span class="st">"2"</span>, <span class="st">"9"</span>, <span class="st">"l"</span>, or <span class="op">=</span> <span class="cn">TRUE</span>, word <span class="op">=</span> <span class="cn">TRUE</span>, ignore.case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Fiat X1-9"      "Porsche 914-2"  "Ford Pantera L"</span></span></code></pre></div>
<div class="section level4">
<h4 id="detect_get">Specificities of <code>srt_get</code><a class="anchor" aria-label="anchor" href="#detect_get"></a>
</h4>
<p>On top of the detection previously described, the function
<code>srt_get</code> changes its behavior with the arguments
<code>seq</code> or <code>seq.unik</code>. It also supports <a href="#get_caching">automatic caching</a>.</p>
<div class="section level5">
<h5 id="sequentially-appending-results">Sequentially appending results<a class="anchor" aria-label="anchor" href="#sequentially-appending-results"></a>
</h5>
<p>As seen previously, patterns in <code>...</code> are combined with a
logical AND. If you set <code>seq = TRUE</code>, this behavior changes.
The results of each pattern becomes stacked sequentially. Schematically,
you obtain the vector
<code>c(x_that_contains_pat1, x_that_contains_pat2, etc)</code> with
<code>pat1</code> the first pattern in <code>...</code>,
<code>pat2</code> the second pattern, etc.</p>
<p>Using <code>seq.unik = TRUE</code> is like <code>seq</code> but
applies the function <code><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique()</a></code> at the end.</p>
<p>Ex: sequentially combining results.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># cars without digits, then cars with 2 'a's or 2 'e's and a digit</span></span>
<span><span class="fu"><a href="../reference/string_get.html">string_get</a></span><span class="op">(</span><span class="va">cars</span>, <span class="st">"!\\d"</span>, <span class="st">"i/a.+a | e.+e &amp; \\d"</span>, seq <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "Hornet Sportabout"   "Valiant"             "Cadillac Fleetwood" </span></span>
<span><span class="co">#&gt;  [4] "Lincoln Continental" "Chrysler Imperial"   "Honda Civic"        </span></span>
<span><span class="co">#&gt;  [7] "Toyota Corolla"      "Toyota Corona"       "Dodge Challenger"   </span></span>
<span><span class="co">#&gt; [10] "AMC Javelin"         "Pontiac Firebird"    "Lotus Europa"       </span></span>
<span><span class="co">#&gt; [13] "Ford Pantera L"      "Ferrari Dino"        "Maserati Bora"      </span></span>
<span><span class="co">#&gt; [16] "Mazda RX4"           "Mazda RX4 Wag"       "Hornet 4 Drive"     </span></span>
<span><span class="co">#&gt; [19] "Merc 450SE"          "Camaro Z28"</span></span>
<span></span>
<span><span class="co"># let's get the first word of each car name</span></span>
<span><span class="va">car_first</span> <span class="op">=</span> <span class="fu"><a href="../reference/string_ops.html">string_ops</a></span><span class="op">(</span><span class="va">cars</span>, <span class="st">"extract.first"</span><span class="op">)</span></span>
<span><span class="co"># we select car brands ending with 'a', then ending with 'i'</span></span>
<span><span class="fu"><a href="../reference/string_get.html">string_get</a></span><span class="op">(</span><span class="va">car_first</span>, <span class="st">"a$"</span>, <span class="st">"i$"</span>, seq <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Mazda"    "Mazda"    "Honda"    "Toyota"   "Toyota"   "Ferrari"  "Maserati"</span></span>
<span><span class="co"># seq.unik is similar to seq but applies unique()</span></span>
<span><span class="fu"><a href="../reference/string_get.html">string_get</a></span><span class="op">(</span><span class="va">car_first</span>, <span class="st">"a$"</span>, <span class="st">"i$"</span>, seq.unik <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Mazda"    "Honda"    "Toyota"   "Ferrari"  "Maserati"</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="get_caching">Caching<a class="anchor" aria-label="anchor" href="#get_caching"></a>
</h5>
<p>At the exploration stage, we often run the same command with a few
variations on the same data set. Acknowledging this,
<code>string_get</code> supports the caching of the data argument in
interactive use. This means that the user can concentrate in the pattern
to find and need not bother to write the data from where to fectch the
values. Note that <code>string_get</code> is the only
<code>stringmagic</code> function to have this ability.</p>
<p>Caching is always enabled, you don’t need to do anything.</p>
<p>Ex: caching of the data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Since we used `car_first` in the previous example, we don't need to provide</span></span>
<span><span class="co"># it explicitly now</span></span>
<span><span class="co"># =&gt; brands containing 'M' and ending with 'a' or 'i'; brands containing 'M'</span></span>
<span><span class="fu"><a href="../reference/string_get.html">string_get</a></span><span class="op">(</span><span class="st">"M &amp; [ai]$"</span>, <span class="st">"M"</span>, seq.unik <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Mazda"    "Maserati" "Merc"     "AMC"</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="sec_ops">Chaining string operations with <code>string_ops</code><a class="anchor" aria-label="anchor" href="#sec_ops"></a>
</h2>
<p>Formatting text data often requires applying many functions (be it
for parsing, text analysis, etc). Even for simple tasks, the number of
operations can quickly balloon, adding many lines of code, reducing
readability, and all this for basic processing.</p>
<p>The function <code>string_ops</code> tries to solve this problem. It
has access to all (50+) <a href="https://lrberge.github.io/stringmagic/articles/ref_operations.html" class="external-link"><code>string_magic</code>
operations</a>, allowing for a compact and readable way to chain basic
operations on character strings.</p>
<p>Below are a few motivating examples.</p>
<p>Ex.1: Parsing data.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># parsing an input: extracting the numbers</span></span>
<span><span class="va">input</span> <span class="op">=</span> <span class="st">"8.5in, 5.5, .5 cm"</span></span>
<span><span class="fu"><a href="../reference/string_ops.html">string_ops</a></span><span class="op">(</span><span class="va">input</span>, <span class="st">"','split, tws, '^\\. =&gt; 0.'replace, '^\\D+|\\D+$'replace, num"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 8.5 5.5 0.5</span></span>
<span></span>
<span></span>
<span><span class="co"># Explanation------------------------------------------------------------------|</span></span>
<span><span class="co"># ','split: splitting w.r.t. ','                                               |</span></span>
<span><span class="co"># tws: trimming the whitespaces                                                |</span></span>
<span><span class="co"># '^\\. =&gt; 0.'replace: adds a 0 to strings starting with '.'                   |</span></span>
<span><span class="co"># '^\\D+|\\D+$'replace: removes non-digits on both ends of the string          |</span></span>
<span><span class="co"># num: converts to numeric                                                     |</span></span>
<span></span>
<span></span>
<span><span class="co"># now extracting the units</span></span>
<span><span class="fu"><a href="../reference/string_ops.html">string_ops</a></span><span class="op">(</span><span class="va">input</span>, <span class="st">"','split, '^[ \\d.]+'replace, tws"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "in" ""   "cm"</span></span>
<span></span>
<span></span>
<span><span class="co"># Explanation------------------------------------------------------------------|</span></span>
<span><span class="co"># ','split: splitting w.r.t. ','                                               |</span></span>
<span><span class="co"># '^[ \\d.]+'replace: removes the ' ', digit                                   |</span></span>
<span><span class="co">#                     and '.' at the beginning of the string                   |</span></span>
<span><span class="co"># tws: trimming the whitespaces                                                |</span></span></code></pre></div>
<p>Ex.2: extracing information from text.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Now using the car data</span></span>
<span><span class="va">cars</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># let's get the brands starting with an "m"</span></span>
<span><span class="fu"><a href="../reference/string_ops.html">string_ops</a></span><span class="op">(</span><span class="va">cars</span>, <span class="st">"'i/^m'get, x, unik"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Mazda"    "Merc"     "Maserati"</span></span>
<span></span>
<span></span>
<span><span class="co"># Explanation------------------------------------------------------------------|</span></span>
<span><span class="co"># 'i/^m'get: keeps only the elements starting with an m,                       |</span></span>
<span><span class="co">#            i/ is the 'regex-flag' "ignore" to ignore the case                |</span></span>
<span><span class="co">#            ^m means "starts with an m" in regex language                     |</span></span>
<span><span class="co"># x: extracts the first pattern. The default pattern is "[[:alnum:]]+"         |</span></span>
<span><span class="co">#    which means an alpha-numeric word                                         |</span></span>
<span><span class="co"># unik: applies unique() to the vector                                         |</span></span>
<span></span>
<span></span>
<span><span class="co"># let's get the 3 largest numbers appearing in the car models</span></span>
<span><span class="fu"><a href="../reference/string_ops.html">string_ops</a></span><span class="op">(</span><span class="va">cars</span>, <span class="st">"'\\d+'x, rm, unik, num, dsort, 3 first"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 914 710 450</span></span>
<span></span>
<span></span>
<span><span class="co"># Explanation------------------------------------------------------------------|</span></span>
<span><span class="co"># '\\d+'x: extracts the first pattern, the pattern meaning "a succession"      |</span></span>
<span><span class="co">#          of digits in regex language                                         |</span></span>
<span><span class="co"># rm: removes elements equal to the empty string (default behavior)            |</span></span>
<span><span class="co"># unik: applies unique() to the vector                                         |</span></span>
<span><span class="co"># num: converts to numeric                                                     |</span></span>
<span><span class="co"># dsort: sorts in decreasing order                                             |</span></span>
<span><span class="co"># 3 first: keeps only the first three element                                  |</span></span></code></pre></div>
<p>As you can see, an operation that would take multiple lines to read
and understand now can be read from left to right in a single line.</p>
</div>
<div class="section level2">
<h2 id="sec_clean">
<code>string_clean</code>: One function to clean them all<a class="anchor" aria-label="anchor" href="#sec_clean"></a>
</h2>
<p>The function <code>string_clean</code> streamlines the cleaning of
character vectors by providing:</p>
<ul>
<li><ol style="list-style-type: lower-roman">
<li>a specialized syntax to replace multiple regex patterns,</li>
</ol></li>
<li><ol start="2" style="list-style-type: lower-roman">
<li>a direct access to many low level string operations, and</li>
</ol></li>
<li><ol start="3" style="list-style-type: lower-roman">
<li>the ability to chain these two operations.</li>
</ol></li>
</ul>
<div class="section level3">
<h3 id="cleaning-syntax">Cleaning syntax<a class="anchor" aria-label="anchor" href="#cleaning-syntax"></a>
</h3>
<p>This function is of the form <code>string_clean(x, ...)</code> with
<code>x</code> the vector to clean and <code>...</code> any number of
cleaning operations which can be of two types:</p>
<ol style="list-style-type: decimal">
<li>use <code>"pat1, pat2 =&gt; replacement"</code> to replace the regex
patterns <code>pat1</code> and <code>pat2</code> with the value
<code>replacement</code>.</li>
<li>use <code>"@op1, op2"</code> to perform any arbitrary sequence of <a href="https://lrberge.github.io/stringmagic/articles/ref_operations.html" class="external-link"><code>string_magic</code>
operation</a>
</li>
</ol>
<p>In the operation <code>"pat1, pat2 =&gt; replacement"</code>, the
pattern is first split with respect to the pipe, <code>" =&gt; "</code>
(change it with argument <code>pipe</code>), to get
<code>replacement</code>. Then the pattern is split with respect to
commas (i.e. <code>",[ \t\n]+"</code>, change it with argument
<code>sep</code>) to get <code>pat1</code> and <code>pat2</code>. A
sequence of <code><a href="https://rdrr.io/r/base/grep.html" class="external-link">base::gsub</a></code> calls is performed to replace each
<code>patx</code> with <code>replacement</code>.</p>
<p>By default the replacement is the empty string. This means that
writting <code>"pat1, pat2"</code> will lead to erasing these two
patterns.</p>
<p>If a pattern starts with an <code>"@"</code>, the subsequent
character string is sent to <code>string_ops</code>. For example
<code>"@ascii, lower"</code> is equivalent to
<code>string_ops(x, "ascii, lower")</code> which turns <code>x</code> to
ASCII and lowers the case.</p>
</div>
<div class="section level3">
<h3 id="clean_example">Example of text cleaning<a class="anchor" aria-label="anchor" href="#clean_example"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">monologue</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"For who would bear the whips and scorns of time"</span>,</span>
<span>              <span class="st">"Th' oppressor's wrong, the proud man's contumely,"</span>,</span>
<span>              <span class="st">"The pangs of despis'd love, the law's delay,"</span>,</span>
<span>              <span class="st">"The insolence of office, and the spurns"</span>,</span>
<span>              <span class="st">"That patient merit of th' unworthy takes,"</span>,</span>
<span>              <span class="st">"When he himself might his quietus make"</span>,</span>
<span>              <span class="st">"With a bare bodkin? Who would these fardels bear,"</span>,</span>
<span>              <span class="st">"To grunt and sweat under a weary life,"</span>,</span>
<span>              <span class="st">"But that the dread of something after death-"</span>,</span>
<span>              <span class="st">"The undiscover'd country, from whose bourn"</span>,</span>
<span>              <span class="st">"No traveller returns- puzzles the will,"</span>,</span>
<span>              <span class="st">"And makes us rather bear those ills we have"</span>,</span>
<span>              <span class="st">"Than fly to others that we know not of?"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Cleaning a text</span></span>
<span><span class="fu"><a href="../reference/string_clean.html">string_clean</a></span><span class="op">(</span><span class="va">monologue</span>, </span>
<span>          <span class="co"># use string_magic to: lower the case and remove basic stopwords</span></span>
<span>          <span class="st">"@lower, stopword"</span>,</span>
<span>          <span class="co"># remove a few extra stopwords(we use the flag word 'w/')</span></span>
<span>          <span class="st">"w/th, 's"</span>,</span>
<span>          <span class="co"># manually stem some verbs</span></span>
<span>          <span class="st">"despis'd =&gt; despise"</span>, <span class="st">"undiscover'd =&gt; undiscover"</span>, <span class="st">"(m|t)akes =&gt; \\1ake"</span>,</span>
<span>          <span class="co"># still stemming: dropping the ending 's' for words of 4+ letters, except for quietus</span></span>
<span>          <span class="st">"(\\w{3,}[^u])s\\b =&gt; \\1"</span>,</span>
<span>          <span class="co"># normalizing the whitespaces + removing punctuation</span></span>
<span>          <span class="st">"@ws.punct"</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "bear whip scorn time"                "oppressor wrong proud man contumely"</span></span>
<span><span class="co">#&gt;  [3] "pang despise love law delay"         "insolence office spurn"             </span></span>
<span><span class="co">#&gt;  [5] "patient merit unworthy take"         "might quietus make"                 </span></span>
<span><span class="co">#&gt;  [7] "bare bodkin fardel bear"             "grunt sweat weary life"             </span></span>
<span><span class="co">#&gt;  [9] "dread something death"               "undiscover country whose bourn"     </span></span>
<span><span class="co">#&gt; [11] "traveller return puzzle will"        "make us rather bear ills"           </span></span>
<span><span class="co">#&gt; [13] "fly other know"</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="sec_vec">Create simple character vectors with <code>string_vec</code><a class="anchor" aria-label="anchor" href="#sec_vec"></a>
</h2>
<p>The function <code>string_vec</code> is dedicated to the creation of
small character vectors. You feed it a comma separated list of values in
a string and it will turn it into a vector.</p>
<p>Ex.1: creating a simple vector.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fruits</span> <span class="op">=</span> <span class="fu"><a href="../reference/string_vec.html">string_vec</a></span><span class="op">(</span><span class="st">"orange, apple, pineapple, strawberry"</span><span class="op">)</span></span>
<span><span class="va">fruits</span></span>
<span><span class="co">#&gt; [1] "orange"     "apple"      "pineapple"  "strawberry"</span></span></code></pre></div>
<p>Within the enumeration, you can use interpolation, with curly
brackets (<code><a href="https://rdrr.io/r/base/Paren.html" class="external-link">{}</a></code>), to insert the elements from a vector into
the current string.</p>
<p>Ex.2: adding a vector into an enumeration.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">more_fruits</span> <span class="op">=</span> <span class="fu"><a href="../reference/string_vec.html">string_vec</a></span><span class="op">(</span><span class="st">"lemon, {fruits}, peach"</span><span class="op">)</span></span>
<span><span class="va">more_fruits</span></span>
<span><span class="co">#&gt; [1] "lemon"      "orange"     "apple"      "pineapple"  "strawberry"</span></span>
<span><span class="co">#&gt; [6] "peach"</span></span></code></pre></div>
<p>The interpolation is performed with <a href="https://lrberge.github.io/stringmagic/articles/guide_string_magic.html" class="external-link"><code>string_magic</code></a>.
This means that any <a href="https://lrberge.github.io/stringmagic/articles/ref_operations.html" class="external-link"><code>string_magic</code>
operation</a> can be applied on-the-fly.</p>
<p>Ex.3: replicating Ex.2 but shortening long fruit names.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">more_fruits</span> <span class="op">=</span> <span class="fu"><a href="../reference/string_vec.html">string_vec</a></span><span class="op">(</span><span class="st">"lemon, {6 Shorten ? fruits}, peach"</span><span class="op">)</span></span>
<span><span class="va">more_fruits</span></span>
<span><span class="co">#&gt; [1] "lemon"   "orange"  "apple"   "pinea.." "straw.." "peach"</span></span></code></pre></div>
<p>Since interpolations are resolved with <code>string_magic</code>, you
can add any text before/after the interpolation:</p>
<p>Ex.4: adding text before the interpolation.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pkgs</span> <span class="op">=</span> <span class="fu"><a href="../reference/string_vec.html">string_vec</a></span><span class="op">(</span><span class="st">"pandas, os, time, re"</span><span class="op">)</span></span>
<span><span class="va">imports</span> <span class="op">=</span> <span class="fu"><a href="../reference/string_vec.html">string_vec</a></span><span class="op">(</span><span class="st">"import numpy as np, import {pkgs}"</span><span class="op">)</span></span>
<span><span class="va">imports</span></span>
<span><span class="co">#&gt; [1] "import numpy as np" "import pandas"      "import os"         </span></span>
<span><span class="co">#&gt; [4] "import time"        "import re"</span></span></code></pre></div>
<div class="section level4">
<h4 id="creating-small-matrices-or-data-frames">Creating small matrices or data frames<a class="anchor" aria-label="anchor" href="#creating-small-matrices-or-data-frames"></a>
</h4>
<p>You can transform the returned vector into a matrix or a data frame
using the arguments <code>.cmat</code>, <code>.nmat</code>
(<strong>c</strong>haracter or <strong>n</strong>umeric matrix) or
<code>.df</code>.</p>
<p>Ex.5: returning a matrix.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/string_vec.html">string_vec</a></span><span class="op">(</span><span class="st">"1, 5,</span></span>
<span><span class="st">            3, 2,</span></span>
<span><span class="st">            5, 12"</span>, .nmat <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,]    1    5</span></span>
<span><span class="co">#&gt; [2,]    3    2</span></span>
<span><span class="co">#&gt; [3,]    5   12</span></span></code></pre></div>
<p>The number of rows is guessed from the number of newlines in the
string. You can avoid using character strings, but in that case you need
to explicitly give the number of rows.</p>
<p>Ex.5-bis: returning a numeric matrix, giving <code>.nmat</code> the
number of rows.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/string_vec.html">string_vec</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>,</span>
<span>           <span class="fl">3</span>, <span class="fl">2</span>,</span>
<span>           <span class="fl">5</span>, <span class="fl">12</span>, .nmat <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,]    1    5</span></span>
<span><span class="co">#&gt; [2,]    3    2</span></span>
<span><span class="co">#&gt; [3,]    5   12</span></span></code></pre></div>
<p>If you want to return a data.frame, you can add the column names in
the .df argument: either in a regular vector, either in a comma
separated list. Note that columns looking like numeric values are always
converted.</p>
<p>Ex.6: returning a data frame.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># you can add the column names directly in the argument .df</span></span>
<span><span class="va">df</span> <span class="op">=</span> <span class="fu"><a href="../reference/string_vec.html">string_vec</a></span><span class="op">(</span><span class="st">"1, john,</span></span>
<span><span class="st">                 3, marie,</span></span>
<span><span class="st">                 5, harry"</span>, .df <span class="op">=</span> <span class="st">"id, name"</span><span class="op">)</span></span>
<span><span class="va">df</span></span>
<span><span class="co">#&gt;   id  name</span></span>
<span><span class="co">#&gt; 1  1  john</span></span>
<span><span class="co">#&gt; 2  3 marie</span></span>
<span><span class="co">#&gt; 3  5 harry</span></span>
<span></span>
<span><span class="co"># automatic conversion of numeric values</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">id</span> <span class="op">*</span> <span class="fl">5</span></span>
<span><span class="co">#&gt; [1]  5 15 25</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="sec_split">Split vectors and turn the result into a data frame, and vice
versa<a class="anchor" aria-label="anchor" href="#sec_split"></a>
</h2>
<p>The function <code>string_split2df</code> (and
<code>string_split2dt</code>) splits a vector using a regular expression
pattern and turns it into a data frame, remembering the original
identifiers. You can get the original vectors back (almost) with the
function <code>paste_conditional</code>.</p>
<p>Ex.1: breaking up two sentences with respect to punctuation and
spaces; then merging them back.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Nor rain, wind, thunder, fire are my daughters."</span>,</span>
<span>      <span class="st">"When my information changes, I alter my conclusions."</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># we split at each word</span></span>
<span><span class="va">sentences_split</span> <span class="op">=</span> <span class="fu"><a href="../reference/string_split2df.html">string_split2df</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"[[:punct:] ]+"</span><span class="op">)</span></span>
<span><span class="va">sentences_split</span></span>
<span><span class="co">#&gt;    obs           x</span></span>
<span><span class="co">#&gt; 1    1         Nor</span></span>
<span><span class="co">#&gt; 2    1        rain</span></span>
<span><span class="co">#&gt; 3    1        wind</span></span>
<span><span class="co">#&gt; 4    1     thunder</span></span>
<span><span class="co">#&gt; 5    1        fire</span></span>
<span><span class="co">#&gt; 6    1         are</span></span>
<span><span class="co">#&gt; 7    1          my</span></span>
<span><span class="co">#&gt; 8    1   daughters</span></span>
<span><span class="co">#&gt; 9    2        When</span></span>
<span><span class="co">#&gt; 10   2          my</span></span>
<span><span class="co">#&gt; 11   2 information</span></span>
<span><span class="co">#&gt; 12   2     changes</span></span>
<span><span class="co">#&gt; 13   2           I</span></span>
<span><span class="co">#&gt; 14   2       alter</span></span>
<span><span class="co">#&gt; 15   2          my</span></span>
<span><span class="co">#&gt; 16   2 conclusions</span></span>
<span></span>
<span><span class="co"># recovering the original vectors (we only lose the punctuation)</span></span>
<span><span class="fu"><a href="../reference/paste_conditional.html">paste_conditional</a></span><span class="op">(</span><span class="va">sentences_split</span><span class="op">$</span><span class="va">x</span>, <span class="va">sentences_split</span><span class="op">$</span><span class="va">obs</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                                    1 </span></span>
<span><span class="co">#&gt;        "Nor rain wind thunder fire are my daughters" </span></span>
<span><span class="co">#&gt;                                                    2 </span></span>
<span><span class="co">#&gt; "When my information changes I alter my conclusions"</span></span></code></pre></div>
<p>If identifiers are associated to the elements of the vector, you can
provide them so that the data frame returned contains them.</p>
<p>Ex.2: splitting with identifiers and merging back with a formula.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ws"</span>, <span class="st">"jmk"</span><span class="op">)</span></span>
<span><span class="co"># we add the identifier</span></span>
<span><span class="va">base_words</span> <span class="op">=</span> <span class="fu"><a href="../reference/string_split2df.html">string_split2df</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"[[:punct:] ]+"</span>, id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>author <span class="op">=</span> <span class="va">id</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># merging back using a formula</span></span>
<span><span class="fu"><a href="../reference/paste_conditional.html">paste_conditional</a></span><span class="op">(</span><span class="va">x</span> <span class="op">~</span> <span class="va">author</span>, <span class="va">base_words</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                          author: jmk </span></span>
<span><span class="co">#&gt; "When my information changes I alter my conclusions" </span></span>
<span><span class="co">#&gt;                                           author: ws </span></span>
<span><span class="co">#&gt;        "Nor rain wind thunder fire are my daughters"</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Laurent R Berge.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.8.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
