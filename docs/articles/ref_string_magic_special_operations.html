<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>`string_magic`'s sepcial operations • stringmagic</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="`string_magic`'s sepcial operations">
<meta property="og:description" content="stringmagic">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">stringmagic</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    </li>
<li class="dropdown-header">Guides</li>
    <li>
      <a href="../articles/guide_string_magic.html">`string_magic`: Magical String Interpolation</a>
    </li>
    <li>
      <a href="../articles/guide_string_tools.html">String tools: magic edition</a>
    </li>
    <li>
      <a href="../articles/guide_customization.html">Tailor-made functions and operations</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">References</li>
    <li>
      <a href="../articles/ref_operations.html">`string_magic`'s operations: The reference</a>
    </li>
    <li>
      <a href="../articles/ref_string_magic_special_operations.html">`string_magic`'s sepcial operations</a>
    </li>
    <li>
      <a href="../articles/ref_regex_flags.html">Regular expression flags</a>
    </li>
    <li>
      <a href="../articles/ref_regex_logic.html">Regular expression logic</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/lrberge/stringmagic/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>
<code>string_magic</code>’s sepcial
operations</h1>
                        <h4 data-toc-skip class="author">Laurent R.
Berge</h4>
            
            <h4 data-toc-skip class="date">2023-07-18</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/lrberge/stringmagic/blob/HEAD/vignettes/ref_string_magic_special_operations.rmd" class="external-link"><code>vignettes/ref_string_magic_special_operations.rmd</code></a></small>
      <div class="hidden name"><code>ref_string_magic_special_operations.rmd</code></div>

    </div>

    
    
<p>This vingette presents advanced operations included in
<code>string_magic</code>. There are four parts:</p>
<ul>
<li><a href="#sec_group_wise">group-wise operations</a></li>
<li><a href="#sec_conditional">conditional operations</a></li>
<li><a href="#sec_ifelse">compact if-else operator</a></li>
<li><a href="#sec_pluralization">pluralization</a></li>
</ul>
<p>By default the function <code>string_magic</code> returns a plain
character vector. This may not render nicely in this vignette. Hence we
create an alias to <code>string_magic</code> which applies
<code><a href="https://rdrr.io/r/base/cat.html" class="external-link">base::cat</a></code> just before leaving the function.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lrberge.github.io/stringmagic/" class="external-link">stringmagic</a></span><span class="op">)</span></span>
<span><span class="va">string_magic</span> <span class="op">=</span> <span class="fu"><a href="../reference/string_magic_alias.html">string_magic_alias</a></span><span class="op">(</span>.post <span class="op">=</span> <span class="fu">base</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="sec_group_wise">Group-wise operations<a class="anchor" aria-label="anchor" href="#sec_group_wise"></a>
</h2>
<p>In <code>string_magic</code>, the operations <code>split</code> and
<code>extract</code> keep a memory of the strings that were split
(i.e. they provide multiple results for each initial string
element).</p>
<p>Use the tilde operator, of the form <code>~(op1, op2)</code>, to
apply operations group-wise, to each of the split strings. Better with
an example.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Oreste, Hermione"</span>, <span class="st">"Hermione, Pyrrhus"</span>, <span class="st">"Pyrrhus, Andromaque"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/string_magic.html">string_magic</a></span><span class="op">(</span><span class="st">"Troubles ahead: {', 'split, ~(' loves 'c), C ? x}."</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Troubles ahead: Oreste loves Hermione, Hermione loves Pyrrhus and Pyrrhus loves Andromaque.</span></span></code></pre>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
<p>Almost all operations can be applied group-wise (although only
operations changing the order or the length of the strings really
matter, see the <a href="LINK">dedicated section</a>).</p>
</div>
<div class="section level2">
<h2 id="sec_conditional">Conditional operations<a class="anchor" aria-label="anchor" href="#sec_conditional"></a>
</h2>
<p>There are two operators to apply operations conditionally:
<code>if</code> and <code>vif</code>, the latter standing for
<em>verbatim if</em>.</p>
<div class="section level3">
<h3 id="if-statement">
<em>if</em> statement<a class="anchor" aria-label="anchor" href="#if-statement"></a>
</h3>
<p>The syntax of <code>if</code> is
<code>if(cond ; ops_true ; ops_false)</code> with <code>cond</code> a
condition (i.e. logical operation) on the value being interpolated,
<code>ops_true</code> a comma-separated sequence of operations if the
condition is <code>TRUE</code> and <code>ops_false</code> an
<em>optional</em> a sequence of operations if the condition is
<code>FALSE</code>.</p>
<p>The condition <code>cond</code> accepts the following special
values:</p>
<ul>
<li>
<code>.</code> (the dot): refers to the current vector</li>
<li>
<code>.nchar</code> or <code>.C</code>: represent the number of
characters of the current vector (equivalent to
<code>nchar(.)</code>)</li>
<li>
<code>.len</code> or <code>.N</code>.: represent the length of the
current vector (equivalent to <code>length(.)</code>)</li>
</ul>
<p>Ex.1: Let’s take a sentence, delete words of less than 4 characters,
and trim words of 7+ characters.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="st">"Songe Céphise à cette nuit cruelle qui fut pour tout un peuple une nuit éternelle"</span></span>
<span><span class="fu"><a href="../reference/string_magic.html">string_magic</a></span><span class="op">(</span><span class="st">"{' 'split, if(.nchar&lt;=4 ; nuke ; '7|..'k), c ? x}"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Songe Céphise cette cruelle peuple éternel..</span></span></code></pre>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
<p>Let’s break it down. First the sentence is split w.r.t. spaces
(command <code>' 'split</code>), leading to a vector of words. Then we
use the special variable <code>.nchar</code> in <code>if</code>’s
condition to refer to the number of characters of the current vector
(the words). The words with less than 4 characters are nuked
(i.e. removed), and the other words are trimmed at 7 characters
(<code>'7|..'k</code>). Finally the modified vector of words is
collapsed with the command <code>c</code>, leading to the result.</p>
<p>In Ex.1 the condition led to a vector of length greater than 1
(length = number of words), triggerring element-wise operations.</p>
<p>If a condition leads to a result of length 1, then the operations are
applied to the full string vector. Contrary to element-wise conditions
for which operations modifying the length of the vectors are
<strong>forbidden</strong> (apart from nuking), such operations are fine
in full-string conditions.</p>
<p>Ex.2: we write the sum of several elements, if the vector is longer
than 4, we replace all remaining elements with an ellispsis.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># same expression for two values of x give different results</span></span>
<span><span class="va">x_short</span> <span class="op">=</span> <span class="fu"><a href="../reference/string_magic.html">string_magic</a></span><span class="op">(</span><span class="st">"x{1:4}"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## x1 x2 x3 x4</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the false statement is missing: it means that nothing is done is .N&lt;=4</span></span>
<span><span class="fu"><a href="../reference/string_magic.html">string_magic</a></span><span class="op">(</span><span class="st">"y = {if(.N&gt;4 ; 3 first, '...'insert.right), ' + 'c ? x_short}"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## y =</span></span></code></pre>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x_long</span> <span class="op">=</span> <span class="fu"><a href="../reference/string_magic.html">string_magic</a></span><span class="op">(</span><span class="st">"x{1:10}"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## x1 x2 x3 x4 x5 x6 x7 x8 x9 x10</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/string_magic.html">string_magic</a></span><span class="op">(</span><span class="st">"y = {if(.N&gt;4 ; 3 first, '...'insert.right), ' + 'c ? x_long}"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## y =</span></span></code></pre>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
<p>In this example, the operations applied are:</p>
<ul>
<li>short vector:
<code>string_magic("y = {' + 'c ? x_short}")</code>
</li>
<li>long vector:
<code>string_magic("y = {3 first, '...'insert.right, ' + 'c ? x_long}")</code>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="verbatim-if-statement">
<em>Verbatim if</em> statement<a class="anchor" aria-label="anchor" href="#verbatim-if-statement"></a>
</h3>
<p>For <code>vif</code>, the syntax is
<code>vif(cond ; verb_true ; verb_false)</code> with
<code>verb_true</code> a verbatim value with which the vector will be
replaced if the condition is <code>TRUE</code>. This is similar for
<code>verb_false</code>. The condition works as in <code>if</code>.</p>
<p>As for the if operator, you can use the special values
<code>"."</code>, <code>.len</code>, <code>.N</code>,
<code>.nchar</code> and <code>.C</code> in the condition. On top of
this, you can use <code>'.'</code> to refer to the current value in
<code>verb_true</code> and <code>verb_false</code>, as illustrated by
the following example.</p>
<p>Ex.3: we want to replace all values lower than 10 by the the string
“&lt;10”, and then create an enumeration.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pval</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1e-20</span>, <span class="fl">0.15</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/string_magic.html">string_magic</a></span><span class="op">(</span><span class="st">"pvalues: {vif(.&lt;1e-16 ; &lt;1e-16 ; {%05f?.}), fill.right ? pval}"</span>, .collapse <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## pvalues:   &lt;1e-16</span></span>
<span><span class="co">## pvalues: 0.150000</span></span>
<span><span class="co">## pvalues: 0.500000</span></span></code></pre>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
<p>In this example, the condition is of the same length as the vector,
so an element-wise operation is triggered. Note that we use
<code>'.'</code> to refer to <code>pval</code> in the condition.
Elements lower than 1e-16 are replaced with the string
<code>"&lt;1e-16"</code>. Other elements are replaced with
<code>{%05f?.}</code>. This string contains the interpolation
delimiters, interpolation applies. The dot, <code>'.'</code>, now refers
to the values of <code>pval</code> respecting the condition. And
<code>sprintf</code> formatting is applied (<code>%05f</code>). After
this, we right align the results.</p>
<p>Conditions of length 1 apply the replacement to the full vector.
Knowing this, let’s redo Ex.2 differently:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="../reference/string_magic.html">string_magic</a></span><span class="op">(</span><span class="st">"x{1:10}"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## x1 x2 x3 x4 x5 x6 x7 x8 x9 x10</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/string_magic.html">string_magic</a></span><span class="op">(</span><span class="st">"y = {vif(.N&gt;4 ; {first?x} + ... + {last?x} ; {' + 'c?x}) ? x}"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## y =</span></span></code></pre>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
<p>Let’s break it down. If the length of the vector is greater than 4
(here it’s 10), then the full string is replaced with
<code>"{first?x} + ... + {last?x}"</code>. Since this string contains
curly brackets, interpolation applies. Hence we obtain the string
<code>"x1 + ... + x10"</code>. Finally, this is collated to
<code>"y = "</code> leading to the result.</p>
<p>If the vector were of length lower than 4, it would have been
replaced with <code>"{' + 'collapse?x}"</code>, which will be
interpolated.</p>
</div>
</div>
<div class="section level2">
<h2 id="sec_ifelse">Special interpolation: if-else<a class="anchor" aria-label="anchor" href="#sec_ifelse"></a>
</h2>
<p>Using an ampersand (<code>"&amp;"</code>) as the first character of
an interpolation leads to an <em>if-else</em> operation. Using two
ampersands (<code>"&amp;&amp;"</code>) leads to a slightly different
operation described at the end of this section.</p>
<div class="section level3">
<h3 id="regular-if-else">Regular if-else: “&amp;”<a class="anchor" aria-label="anchor" href="#regular-if-else"></a>
</h3>
<p>The syntax is as follows:
<code>{&amp;cond ; verb_true ; verb_false}</code> with <code>cond</code>
a condition (i.e. logical operation), <code>verb_true</code> a verbatim
value with which the vector will be replaced if the condition is
<code>TRUE</code> and <code>verb_false</code> an <em>optional</em>
verbatim value with which the vector will be replaced if the condition
is <code>FALSE</code>. If not provided, <code>verb_false</code> is
considered to be the <em>empty string</em> unless the operator is the
double ampersand described (<code>&amp;&amp;</code>) at the end of this
section.</p>
<p>Note that in <code>cond</code>, you can use the function
<code>len</code>, an alias to <code>length</code>.</p>
<p>Ex.1: we take a vector and compose a message depending on its length.
If its length is lower than 10 then we write the message
<code>"x is short"</code>, otherwise we write <code>"x is long"</code>,
and insert <code>"very"</code> depending on the number of digits.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span></span>
<span><span class="fu"><a href="../reference/string_magic.html">string_magic</a></span><span class="op">(</span><span class="st">"x is {&amp;len(x)&lt;10 ; short ; {`log10(.N)-1`times, ''c ! very }long}"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## x is short</span></span></code></pre>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">50</span></span>
<span><span class="fu"><a href="../reference/string_magic.html">string_magic</a></span><span class="op">(</span><span class="st">"x is {&amp;len(x)&lt;10 ; short ; {`log10(.N)-1`times, ''c ! very }long}"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## x is long</span></span></code></pre>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5000</span></span>
<span><span class="fu"><a href="../reference/string_magic.html">string_magic</a></span><span class="op">(</span><span class="st">"x is {&amp;len(x)&lt;10 ; short ; {`log10(.N)-1`times, ''c ! very }long}"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## x is very very long</span></span></code></pre>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
<p>If a condition leads to a result of length 1, the full string is
replaced by the verbatim expression. Further, this expression will be
interpolated if requested. This was the case in Ex.1 where
<code>verb_false</code> was interpolated.</p>
<p>If the condition uses a variable, in later interpolations you can
refer to the first variable present in the condition with ‘.’, and use
‘.len’ or ‘.N’ to refer to its length.</p>
<p>If the condition’s length is greater than 1, then each logical values
equal to <code>TRUE</code> is replaced by <code>verb_true</code>, and
<code>FALSE</code> values are replaced with <code>verb_false</code>.
There can be interpolation on the values <code>verb_true</code> and
<code>verb_false</code>. In that case the interpolation must result into
a vector of either length 1 or a length equal to the condition. Then
element-wise replacements are made, a la <code><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">base::ifelse</a></code>.</p>
<p>Ex.2: illustration of element-wise replacements.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span></span>
<span><span class="va">y</span> <span class="op">=</span> <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="fu"><a href="../reference/string_magic.html">string_magic</a></span><span class="op">(</span><span class="st">"{&amp;x %% 2 ; odd ; {y}}"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## odd b odd d</span></span></code></pre>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
<p>In that example, when x is odd, it is replaced with
<code>"odd"</code>, and when even it is replaced with the elements of
y.</p>
</div>
<div class="section level3">
<h3 id="if-else-with-automatic-filling">
<em>if-else</em> with automatic filling<a class="anchor" aria-label="anchor" href="#if-else-with-automatic-filling"></a>
</h3>
<p>Using the two ampersands operator (<code>&amp;&amp;</code>) is like
the simple ampersand version but the default for <code>verb_false</code>
is the variable used in the condition itself. So the syntax is
<code>{&amp;&amp;cond ; verb_true}</code> and <em>it does not
accept</em> <code>verb_false</code>.</p>
<p>Ex.3: let’s write the integer <code>i</code> in letters when equal to
3 only.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">i</span> <span class="op">=</span> <span class="fl">3</span> </span>
<span><span class="fu"><a href="../reference/string_magic.html">string_magic</a></span><span class="op">(</span><span class="st">"i = {&amp;&amp;i == 3 ; three}"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## i = three</span></span></code></pre>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">i</span> <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="fu"><a href="../reference/string_magic.html">string_magic</a></span><span class="op">(</span><span class="st">"i = {&amp;&amp;i == 3 ; three}"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## i = 5</span></span></code></pre>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
<p>When the condition is of length 1: the full vector is replaced. When
the condition is of the length of the vector, an element-wise
replacement is triggered, like in example 3.</p>
</div>
</div>
<div class="section level2">
<h2 id="sec_pluralization">Special interpolation: Pluralization<a class="anchor" aria-label="anchor" href="#sec_pluralization"></a>
</h2>
<p>There is advanced support for pluralization which greatly facilitates
the writing of messages in natural language.</p>
<div class="section level3">
<h3 id="pluralization-principles">Pluralization: Principles<a class="anchor" aria-label="anchor" href="#pluralization-principles"></a>
</h3>
<p>There are two ways to pluralize: over length or over value. To
trigger a “pluralization” interpolation use as first character:</p>
<ul>
<li>
<code>#</code> to pluralize over the value of a variable (see
Ex.1)</li>
<li>
<code>$</code> to pluralize over the length of a variable (see
Ex.2)</li>
</ul>
<p>Ex.1: we add an ending ‘s’ based on a number.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="fu"><a href="../reference/string_magic.html">string_magic</a></span><span class="op">(</span><span class="st">"I bought {N?x} book{#s}."</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## I bought five books.</span></span></code></pre>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="fu"><a href="../reference/string_magic.html">string_magic</a></span><span class="op">(</span><span class="st">"I bought {N?x} book{#s}."</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## I bought one book.</span></span></code></pre>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
<p>The syntax is <code>{#plural_ops ? variable}</code> or
<code>{#plural_ops}</code> where <code>plural_ops</code> are specific
pluralization operations which will be described below. The
pluralization is perfomed <em>always</em> with respect to the value of a
variable.</p>
<p>You can either add the variable explicitly
(<code>{#plural_ops ? variable}</code>) or refer to it implicitly
(<code>{#plural_ops}</code>). If implicit, then the algorithm will look
at the previous variable that was interpolated and pluralize over it.
This is exaclty what happens in Ex.1 where <code>x</code> was
interpolated in <code>{N?x}</code> and the plural operation
<code>s</code> (in <code>{#s}</code>) applies to <code>x</code>. It
would have been equivalent to have <code>{#s ? x}</code>. If a variable
wasn’t interpolated before, then the next interpolated variable will be
used (see Ex.2). If no variable is interpolated at all, an error is
thrown.</p>
<p>Ex.2: we add an ending ‘s’ and conjugate the verb ‘be’ based on the
length of a vector.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"J."</span>, <span class="st">"M."</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/string_magic.html">string_magic</a></span><span class="op">(</span><span class="st">"My BFF{$s, are} {enum?x}!"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## My BFFs are J. and M.!</span></span></code></pre>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="st">"J."</span></span>
<span><span class="fu"><a href="../reference/string_magic.html">string_magic</a></span><span class="op">(</span><span class="st">"My BFF{$s, are} {enum?x}!"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## My BFF is J.!</span></span></code></pre>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
<p>As you can notice in Ex.2, you can chain operations (here
<code>'s'</code> and <code>'are'</code>). In that case a whitespace is
automatically added between them.</p>
<p>Now let’s come to the specific pluralization operations, which are
different from regular operations.</p>
</div>
<div class="section level3">
<h3 id="pluralization-regular-operations">Pluralization: Regular operations<a class="anchor" aria-label="anchor" href="#pluralization-regular-operations"></a>
</h3>
<div class="section level4">
<h4 id="s-es">s, es<a class="anchor" aria-label="anchor" href="#s-es"></a>
</h4>
<p>Adds an <code>"s"</code> (or <code>"es"</code>) if it is plural (&gt;
1), nothing otherwise. Accepts the option <code>0</code> or
<code>zero</code> which treats a 0-length or a 0-value as plural.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nfiles</span> <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="fu"><a href="../reference/string_magic.html">string_magic</a></span><span class="op">(</span><span class="st">"We've found {#n.no ? nfiles} file{#s}."</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## We've found 1 file.</span></span></code></pre>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nfiles</span> <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="fu"><a href="../reference/string_magic.html">string_magic</a></span><span class="op">(</span><span class="st">"We've found {#n.no ? nfiles} file{#s}."</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## We've found no file.</span></span></code></pre>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nfiles</span> <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="fu"><a href="../reference/string_magic.html">string_magic</a></span><span class="op">(</span><span class="st">"We've found {#n.no ? nfiles} file{#s.0}."</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## We've found no files.</span></span></code></pre>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nfiles</span> <span class="op">=</span> <span class="fl">4</span></span>
<span><span class="fu"><a href="../reference/string_magic.html">string_magic</a></span><span class="op">(</span><span class="st">"We've found {#n.no ? nfiles} file{#s.0}."</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## We've found 4 files.</span></span></code></pre>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="y-or-ies">y or ies<a class="anchor" aria-label="anchor" href="#y-or-ies"></a>
</h4>
<p>Adds an ‘y’ if singular and ‘ies’ if plural (&gt;1). Accepts the
option <code>0</code> or <code>zero</code> which treats a 0-length or a
0-value as plural.</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ndir</span> <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="fu"><a href="../reference/string_magic.html">string_magic</a></span><span class="op">(</span><span class="st">"We've found {ndir} director{#y}."</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## We've found 1 directory.</span></span></code></pre>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ndir</span> <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="fu"><a href="../reference/string_magic.html">string_magic</a></span><span class="op">(</span><span class="st">"We've found {ndir} director{#y}."</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## We've found 5 directories.</span></span></code></pre>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ndir</span> <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="fu"><a href="../reference/string_magic.html">string_magic</a></span><span class="op">(</span><span class="st">"We've found {ndir} director{#ies}."</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## We've found 1 directory.</span></span></code></pre>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="enum">enum<a class="anchor" aria-label="anchor" href="#enum"></a>
</h4>
<p>Enumerates the elements (see help for the <a href="LINK">regular
operation <code>enum</code></a>).</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fruits</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"apples"</span>, <span class="st">"oranges"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/string_magic.html">string_magic</a></span><span class="op">(</span><span class="st">"The fruit{$s ? fruits} I love {$are, enum}."</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## The fruits I love are apples and oranges.</span></span></code></pre>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fruits</span> <span class="op">=</span> <span class="st">"apples"</span></span>
<span><span class="fu"><a href="../reference/string_magic.html">string_magic</a></span><span class="op">(</span><span class="st">"The fruit{$s ? fruits} I love {$are, enum}."</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## The fruit I love is apples.</span></span></code></pre>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="n-n-len-len">n, N, len, Len<a class="anchor" aria-label="anchor" href="#n-n-len-len"></a>
</h4>
<p>Add the number of elements (<code>"len"</code>) or the value
(<code>"n"</code>) of the variable as a formatted number or in letters
(upper case versions). Accepts the options <code>letter</code> (to write
in letter) and <code>upper</code> (to uppercase the first letter).</p>
<p>You can also pass the options <code>no</code> or <code>No</code>,
which replace the 0 values with “no”/“No”. Alternatively, pass a
free-form argument to be used in lieu of 0 values.</p>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nfiles</span> <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="fu"><a href="../reference/string_magic.html">string_magic</a></span><span class="op">(</span><span class="st">"{#N.upper.No ? nfiles} file{#s, are} compromised."</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Five files are compromised.</span></span></code></pre>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nfiles</span> <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="fu"><a href="../reference/string_magic.html">string_magic</a></span><span class="op">(</span><span class="st">"{#N.upper.No ? nfiles} file{#s, are} compromised."</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## One file is compromised.</span></span></code></pre>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nfiles</span> <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="fu"><a href="../reference/string_magic.html">string_magic</a></span><span class="op">(</span><span class="st">"{#N.upper.No ? nfiles} file{#s, are} compromised."</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## No file is compromised.</span></span></code></pre>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Using free-form arguments</span></span>
<span><span class="va">nfiles</span> <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="fu"><a href="../reference/string_magic.html">string_magic</a></span><span class="op">(</span><span class="st">"{#'Absolutely no'N.upper ? nfiles} file{#s, are} compromised."</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Five files are compromised.</span></span></code></pre>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nfiles</span> <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="fu"><a href="../reference/string_magic.html">string_magic</a></span><span class="op">(</span><span class="st">"{#'Absolutely no'N.upper ? nfiles} file{#s, are} compromised."</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Absolutely no file is compromised.</span></span></code></pre>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="nth-ntimes">nth, ntimes<a class="anchor" aria-label="anchor" href="#nth-ntimes"></a>
</h4>
<p>Writes the value of the variable as an order (nth) or a frequence
(ntimes). Accepts the option <code>letter</code> to write the numbers in
letters (uppercase version of the operator does the same).</p>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="fu"><a href="../reference/string_magic.html">string_magic</a></span><span class="op">(</span><span class="st">"Writing the same sentence {#Ntimes ? n} is unnecessary."</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Writing the same sentence twice is unnecessary.</span></span></code></pre>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="is-or-any-verb">is, or any verb<a class="anchor" aria-label="anchor" href="#is-or-any-verb"></a>
</h4>
<p>Conjugates any English verb appropriately depending on context. Any
command that is not recognized as one of the commands previously
described is treated as a verb.</p>
<p>Simply add an upper case first to upper case the conjugated verb.</p>
<p>Multiple verbs are illustrated in the example below. It also
anticipaed the conditional statements described in the next section.</p>
<p>Ex.3: multiple verbs and conditional statements.</p>
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pple</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Francis"</span>, <span class="st">"Henry"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/cat_magic.html">cat_magic</a></span><span class="op">(</span><span class="st">"{$enum, is, (a;) ? pple} tall guy{$s}."</span>,</span>
<span>        <span class="st">"{$(He;They), like} to eat donuts."</span>,</span>
<span>        <span class="st">"When happy, at the pub {$(he;they), goes}!"</span>,</span>
<span>        <span class="st">"{$Don't, (he;they)} have wit, {$(he;they)} who {$try}?"</span>, .sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Francis and Henry are tall guys.</span></span>
<span><span class="co">## They like to eat donuts.</span></span>
<span><span class="co">## When happy, at the pub they go!</span></span>
<span><span class="co">## Don't they have wit, they who try?</span></span></code></pre>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pple</span> <span class="op">=</span> <span class="st">"Francis"</span></span>
<span><span class="fu"><a href="../reference/cat_magic.html">cat_magic</a></span><span class="op">(</span><span class="st">"{$enum, is, (a;) ? pple} tall guy{$s}."</span>,</span>
<span>        <span class="st">"{$(He;They), like} to eat donuts."</span>,</span>
<span>        <span class="st">"When happy, at the pub {$(he;they), goes}!"</span>,</span>
<span>        <span class="st">"{$Don't, (he;they)} have wit, {$(he;they)} who {$try}?"</span>, .sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Francis is a tall guy.</span></span>
<span><span class="co">## He likes to eat donuts.</span></span>
<span><span class="co">## When happy, at the pub he goes!</span></span>
<span><span class="co">## Doesn't he have wit, he who tries?</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="pluralization-conditional-statements">Pluralization: Conditional statements<a class="anchor" aria-label="anchor" href="#pluralization-conditional-statements"></a>
</h3>
<p>On top of the previous operations, there is a special operation
allowing to add verbatim text depending on the situation. The syntax is
as follows:</p>
<ul>
<li>
<code>(s1;s2)</code>: adds verbatim ‘s1’ if singular and ‘s2’ if
plural (&gt;1)</li>
<li>
<code>(s1;s2;s3)</code>: adds verbatim ‘s1’ if zero, ‘s2’ if
singular (=1) and ‘s3’ if plural</li>
<li>
<code>(s1;;s3)</code>: adds verbatim ‘s1’ if zero, ‘s3’ if singular
or plural (i.e. &gt;=1)</li>
</ul>
<p>These case-dependent verbatim values <strong>are
interpolated</strong> (if appropriate). In these interpolations you need
not refer explicitly to the variable for pluralization
interpolations.</p>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="fu"><a href="../reference/string_magic.html">string_magic</a></span><span class="op">(</span><span class="st">"{#(Sorry, nothing found.;;{#N.upper} match{#es, were} found.)?x}"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Sorry, nothing found.</span></span></code></pre>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="fu"><a href="../reference/string_magic.html">string_magic</a></span><span class="op">(</span><span class="st">"{#(Sorry, nothing found.;;{#N.upper} match{#es, were} found.)?x}"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## One match was found.</span></span></code></pre>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="fu"><a href="../reference/string_magic.html">string_magic</a></span><span class="op">(</span><span class="st">"{#(Sorry, nothing found.;;{#N.upper} match{#es, were} found.)?x}"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Three matches were found.</span></span></code></pre>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Laurent R Berge.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
