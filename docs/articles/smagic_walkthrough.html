<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>`smagic`: Magical string interpolation • fixest</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="`smagic`: Magical string interpolation">
<meta property="og:description" content="stringmagic">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fixest</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/stringmagic_tour.html">`stringmagic`: A quick tour</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Guides</li>
    <li>
      <a href="../articles/smagic_walkthrough.html">`smagic`: Magical string interpolation</a>
    </li>
    <li>
      <a href="../articles/string_tools.html">String tools: magic edition</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/lrberge/stringmagic/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>
<code>smagic</code>: Magical string
interpolation</h1>
                        <h4 data-toc-skip class="author">Laurent R.
Berge</h4>
            
            <h4 data-toc-skip class="date">2023-06-25</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/lrberge/stringmagic/blob/HEAD/vignettes/smagic_walkthrough.rmd" class="external-link"><code>vignettes/smagic_walkthrough.rmd</code></a></small>
      <div class="hidden name"><code>smagic_walkthrough.rmd</code></div>

    </div>

    
    
<p>String interpolation is a common feature of many programming
languages and is used to insert the value of variables directly into
character strings. This is useful to compose dynamic messages in a
natural way. For example <code>"Hello {x}"</code> will be interpolated
as “Hello John” if <code>x = "John"</code>.</p>
<p>What if you want to apply some modifications to the variable before
insertion? Like normalizing the case, trimming at 40 characters, or
concatenating? In general, you can’t. Well, actually you can but have to
use the language’s own native tools. And it can be surprising how
performing a few basic operations can quickly amount to lot of
typing.</p>
<p>The aim of the package <code>stringmagic</code> is to simplify and
empower string interpolation. With the <code>smagic</code> function, you
can apply 50+ basic operations to interpolated variables, interpolations
can be nested, there is advanced support for pluralization, and much
more.</p>
<p>Before moving on, we set the global option <code>.smagic.class</code>
to <code>TRUE</code> such that the character vectors produced by
<code>smagic</code> are displayed nicely in this vignette.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">setSmagic</span><span class="op">(</span>.smagic.class <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="motivating-examples-and-advice-for-reading">Motivating examples and advice for reading<a class="anchor" aria-label="anchor" href="#motivating-examples-and-advice-for-reading"></a>
</h2>
<p>Here’s a few things the algorithm can do (don’t worry if it looks
like gibberish when first discovering it: it will make sense
later!):</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lrberge.github.io/stringmagic/" class="external-link">stringmagic</a></span><span class="op">)</span></span>
<span><span class="va">name</span> <span class="op">=</span> <span class="st">"john doe"</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Hi {title ? name}."</span><span class="op">)</span></span>
<span><span class="co">#&gt; Hi John Doe.</span></span>
<span></span>
<span><span class="va">cars</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">cars</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "Mazda RX4"           "Mazda RX4 Wag"       "Datsun 710"         </span></span>
<span><span class="co">#&gt;  [4] "Hornet 4 Drive"      "Hornet Sportabout"   "Valiant"            </span></span>
<span><span class="co">#&gt;  [7] "Duster 360"          "Merc 240D"           "Merc 230"           </span></span>
<span><span class="co">#&gt; [10] "Merc 280"            "Merc 280C"           "Merc 450SE"         </span></span>
<span><span class="co">#&gt; [13] "Merc 450SL"          "Merc 450SLC"         "Cadillac Fleetwood" </span></span>
<span><span class="co">#&gt; [16] "Lincoln Continental" "Chrysler Imperial"   "Fiat 128"           </span></span>
<span><span class="co">#&gt; [19] "Honda Civic"         "Toyota Corolla"      "Toyota Corona"      </span></span>
<span><span class="co">#&gt; [22] "Dodge Challenger"    "AMC Javelin"         "Camaro Z28"         </span></span>
<span><span class="co">#&gt; [25] "Pontiac Firebird"    "Fiat X1-9"           "Porsche 914-2"      </span></span>
<span><span class="co">#&gt; [28] "Lotus Europa"        "Ford Pantera L"      "Ferrari Dino"       </span></span>
<span><span class="co">#&gt; [31] "Maserati Bora"       "Volvo 142E"</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"I like cars starting with C like {'i/^c'get, x, unik, enum.or ? cars}."</span><span class="op">)</span></span>
<span><span class="co">#&gt; I like cars starting with C like Cadillac, Chrysler or Camaro.</span></span>
<span></span>
<span><span class="va">friends</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Piglet"</span>, <span class="st">"Eeyore"</span><span class="op">)</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"My best friend{$s, are, enum ? friends}. Who am I?"</span><span class="op">)</span></span>
<span><span class="co">#&gt; My best friends are Piglet and Eeyore. Who am I?</span></span>
<span></span>
<span><span class="va">friends</span> <span class="op">=</span> <span class="st">"Mercutio"</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"My best friend{$s, are, enum ? friends}. Who am I?"</span><span class="op">)</span></span>
<span><span class="co">#&gt; My best friend is Mercutio. Who am I?</span></span></code></pre></div>
<p>If you discover this package, since it’s a lot of content, here’s
some advice:</p>
<ul>
<li>read the first sections completely (<a href="#sec_basic">regular
interpolation</a>, <a href="#sec_interpol">interpolation with
operations</a>, <a href="#sec_verbatim">verbatim and nesting</a>, and <a href="#sec_syntax">the operations syntax</a>). They’re short.</li>
<li>skim the <a href="#sec_operations_reference">operations
reference</a>
</li>
</ul>
<p>And you should be good to go for some basic usage.</p>
<p><strong>Tip:</strong> don’t be afraid to try out some operations at
random (from memory), the error messages will remind you the available
operations. You can also use the argument <code>help = TRUE</code> to
get interactive help (use <code>help = "regex"</code> to perform a regex
search on the full doc!). Finally, <code>smagic("--help")</code> gives
you a compact help.</p>
<p>Once you’re a bit comfortable, here are extra sections of
interest:</p>
<ul>
<li><a href="#sec_group_wise">group-wise operations</a></li>
<li><a href="#sec_conditional">conditional operations</a></li>
<li><a href="#sec_ifelse">the if-else operator</a></li>
<li>
<a href="#sec_pluralization">pluralization</a>: must read if
interested in the topic</li>
<li><a href="#sec_special_cases">escaping and special cases</a></li>
<li>
<a href="#sec_creation">creating your own operations</a>: rather
advanced</li>
</ul>
</div>
<div class="section level2">
<h2 id="sec_basic">Basic interpolation<a class="anchor" aria-label="anchor" href="#sec_basic"></a>
</h2>
<p>To interpolate a variable, say <code>x</code>, simply use
<code>{x}</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="st">"world"</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"hello {x}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; hello world</span></span></code></pre></div>
<p>As we can see, anything in curly brackets gets interpolated. This
behavior is similar to the well known function <a href="https://glue.tidyverse.org/" class="external-link">glue</a> from the tidyverse.</p>
<p>Now let’s come to what <code>smagic</code> really brings to the
table.</p>
</div>
<div class="section level2">
<h2 id="sec_interpol">Interpolation with operations: Principle<a class="anchor" aria-label="anchor" href="#sec_interpol"></a>
</h2>
<p>To any interpolation you can add operations. Let’s take the example
of the previous section and say we want to display “hello W O R L D”.
This means upper casing all letters of the interpolated variable and
adding a space between each of them. Let’s do it:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"hello {upper, ''s, c ? x}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; hello W O R L D</span></span></code></pre></div>
<p>Now let’s explain what happened. Within the <code><a href="https://rdrr.io/r/base/Paren.html" class="external-link">{}</a></code>
<em>box</em>, we first write a set of operations, here
<code>upper, ''s, c</code>, then add <code>?</code> and finally write
the variable to interpolate, <code>x</code>. The operations (detailed in
<a href="#sec_operations_reference">the reference section</a>) are
<code>upper</code>, to upper-case all letters, <code>''s</code>: to
split with the empty string, <code>c</code>: to concatenate the vector
that was just split with spaces (<code>' '</code>). The question mark
means that the expression coming after it is to be evaluated (this is
opposed to the exclamation mark presented in the next section).</p>
<p>The syntax is always the same:
<code>{operations ? expression}</code>, where the operations section is
a <em>comma separated</em> list of operations. These operations are of
the form <code>'arg'op</code>, with <code>arg</code> the argument to the
operator <code>op</code>. These operations are performed sequentially
from left to right.</p>
<p>Some operations, like <code>upper</code>, accept options. You attach
options to an operation with a dot followed by the option name.
Formally: <code>op.option1.option2</code>, etc. Example:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="st">"hi there. what's up? fine."</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"He said: {upper.sentence, Q ? x}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; He said: "Hi there. What's up? Fine."</span></span></code></pre></div>
<p>Both operators and options are partially matched. So
<code>smagic("He said: {up.s, Q ? x}")</code> would also work. You have
more details on the operations syntax in the <a href="#sec_syntax">syntax section</a>.</p>
</div>
<div class="section level2">
<h2 id="sec_verbatim">Verbatim interpolation and nesting: Principle<a class="anchor" aria-label="anchor" href="#sec_verbatim"></a>
</h2>
<p>Instead of interpolating a variable, say <code>x</code>, with
<code>{x}</code>, you can use an exclamation mark to trigger verbatim
evaluation. For example <code>smagic("hello {!x}")</code> would lead to
“hello x”. (To use <code>!</code> as a regular logical operator, see the
<a href="#sec_special_cases">section on special cases</a>.) Please hold
on a little bit to see the point.</p>
<p>Verbatim evaluation is a powerful way to apply operations to plain
text. For example:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"hello {upper, ''s, c ! world}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; hello W O R L D</span></span></code></pre></div>
<p>Before moving on, a necessary detail. The spaces surrounding the
exclamation mark are non necessary, but when one space is present on
both sides of the <code>!</code>, then the verbatim expression only
begins after the space. This is illustrated below</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The decorative space in verbatim mode</span></span>
<span><span class="co">#                  v                      =&gt; adds a space before 'hi'</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{upper, Q! hi}"</span>, </span>
<span>        <span class="co">#         v v                     =&gt; no space added (ie decorative space)</span></span>
<span>        <span class="st">"{upper, Q ! hi}"</span>, </span>
<span>        <span class="co">#         v vv                    =&gt; adds a space before 'hi'</span></span>
<span>        <span class="st">"{upper, Q !  hi}"</span>, .sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; " HI"</span></span>
<span><span class="co">#&gt; "HI"</span></span>
<span><span class="co">#&gt; " HI"</span></span></code></pre></div>
<div class="section level4">
<h4 id="nesting">Nesting<a class="anchor" aria-label="anchor" href="#nesting"></a>
</h4>
<p>The main advantage, and real power, of verbatim evaluations is
<em>nesting</em>. Anything in a verbatim expression becomes evaluated
with the function <code>smagic</code>. This means that any <em>box</em>
will be evaluated as previously described.</p>
<p>Let’s give an example. You want to write the expression of a
polynomial of order <code>n</code>: <code>a + bx + cx^2 + etc</code>.
You can do that with nesting:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"poly({n}): {' + 'c ! {letters[1 + 0:n]}x^{0:n}}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; poly(2): ax^0 + bx^1 + cx^2</span></span></code></pre></div>
<p>How does it work? The verbatim expression (the one following the
exclamation mark), here <code>"{letters[1 + 0:n]}x^{0:n}"</code>, is
evaluated with <code>smagic</code>.
<code>smagic("{letters[1 + 0:n]}x^{0:n}")</code> leads to the vector
<code>c("ax^0", "bx^1", "cx^2")</code>.</p>
<p>The operation <code>' + 'c</code> then concatenates (or collapses)
that vector with <code>' + '</code>. This value is then appended to the
previous string.</p>
<p>We could refine by adding a cleaning operation in which we replace
<code>"x^0"</code> and <code>"^1"</code> by the empty string. Let’s do
it:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">=</span> <span class="fl">4</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"poly({n}): {' + 'c, 'f/x^0, ^1'clean ! {letters[1 + 0:n]}x^{0:n}}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; poly(4): a + bx + cx^2 + dx^3 + ex^4</span></span></code></pre></div>
<p>We obtain the desired result. Note that the <code>clean</code>
operation is explained in the <a href="#op_clean">operations reference
section</a>.</p>
</div>
</div>
<div class="section level2">
<h2 id="sec_syntax">Regular operations: General syntax<a class="anchor" aria-label="anchor" href="#sec_syntax"></a>
</h2>
<p>As seen in the previous sections, within a <em>box</em>
(i.e. <code>"{}"</code>), multiple operations can be performed. We can
do so by stacking the operations in a comma separated enumeration.
Operations can have arguments, and operations can also have options. The
general syntax, with argument and options, is:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{'arg1'op1.optionA.optionB, arg2 op2.optionC, </span></span>
<span><span class="st">          `arg3`op3, 51op4, op5 ? x}"</span><span class="op">)</span></span></code></pre></div>
<p>Any blanks after the commas are discarded (inclusing tabs and
newlines) so the chain of operations can be written across several
lines, as above.</p>
<p>You can include arguments in four different ways:</p>
<ol style="list-style-type: decimal">
<li>inside single or double quotes just before the operation name
(<code>arg1</code> above),</li>
<li>verbatim, separated with a space, just before the operation name
(<code>arg2</code> above),</li>
<li>inside bactick quotes, which will trigger evaluation of the argument
from the environment (<code>arg3</code> above),</li>
<li>when the argument is an integer it can be juxtaposed to the opeation
name (like in <code>op4</code> above).</li>
</ol>
<p>The options are always dot separated and attached to the operation
name, they are specific to each operation.</p>
<p>Both the operation name and the option names are partially matched.
This means, for example, that command <code>"upper.first"</code> is
equivalent to <code>"up.f"</code>.</p>
<p>Here are examples for each types of arguments:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># quoted argument</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"y = {'x'paste, ' + 'c ? 1:2}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; y = x1 + x2</span></span>
<span></span>
<span><span class="co"># verbatim argument, space separated</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"y = {x paste, ' + 'c ? 1:2}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; y = x1 + x2</span></span>
<span></span>
<span><span class="co"># evaluated argument</span></span>
<span><span class="va">x</span> <span class="op">=</span> <span class="st">"z"</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"y = {`x`paste, ' + 'c ? 1:2}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; y = z1 + z2</span></span>
<span></span>
<span><span class="co"># digits accolated to the operator</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"y = {0paste, ' + 'c ? 1:2}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; y = 01 + 02</span></span>
<span></span>
<span><span class="co"># options `bq` (back quote) and `a` passed to operator `enum`</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"y = the sum of {'x'paste, enum.bq.a ? 1:2}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; y = the sum of a) `x1`, and b) `x2`</span></span></code></pre></div>
<p>A few operators have two arguments. Pass multiple arguments using a
pipe as follows:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{'arg1|arg2'op, 'arg1||arg2'op ? x}"</span><span class="op">)</span></span></code></pre></div>
<p>You can escape the meaning of the pipe as a separator with a double
backslash. Some operators accept a double pipe which modifies the
behavior of the second argument. Here is an example:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="st">"Quels sont ces serpents qui sifflent sur vos têtes?"</span></span>
<span><span class="co"># let's shorten this</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Oreste: {s, '4|..'k, c, Q ? x}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Oreste: "Quel.. sont ces serp.. qui siff.. sur vos tête.."</span></span>
<span></span>
<span><span class="va">rome</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Rome qui t'a vu naître et que ton coeur adore"</span>,</span>
<span>         <span class="st">"Rome enfin, que je hais parce qu'elle t'honore!"</span><span class="op">)</span></span>
<span><span class="co"># the double pipe triggers a different behavior in this operator</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Camille: {s, '4||..'k, c, Q ? rome}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Camille: "Rome qui t'a vu na.. et que ton co.. ad.. Rome en.. que je hais pa.. qu.. t'.."</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="sec_operations_reference">Regular operations: Reference<a class="anchor" aria-label="anchor" href="#sec_operations_reference"></a>
</h2>
<p>This section references all <code>smagic</code>’s regular
operations.</p>
<div class="section level3">
<h3 id="basic-string-operations">Basic string operations<a class="anchor" aria-label="anchor" href="#basic-string-operations"></a>
</h3>
<p>This section describes some of the most common string operations:
extracting, replacing, collapsing, splitting, etc. Because they are so
common, many of these operations have a name composed of just one
letter. These functions accept generic flags (“ignore”, “fixed”, “word”)
in their patterns (syntax: “flags/pattern”). For more information on
regex flags, see the <a href="https://lrberge.github.io/stringmagic/articles/string_tools.html" class="external-link">dedicated
section</a>.</p>
<div class="section level4">
<h4 id="s-s-split-split">s, S, split, Split<a class="anchor" aria-label="anchor" href="#s-s-split-split"></a>
</h4>
<p>Splits the string according to a pattern. The three operations have
different defaults: <code>' '</code> for <code>s</code> and
<code>split</code>, and <code>',[ \t\n]*'</code> for <code>S</code> and
<code>Split</code> (i.e. comma separation).</p>
<p>When character strings are split, their identity is kept in memory so
that group-wise operations can be applied. See the <a href="#sec_group_wise">section on group-wise operations</a>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 'S' with its default (comma separation)</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{S ! romeo, juliet}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; romeo</span></span>
<span><span class="co">#&gt; juliet</span></span>
<span></span>
<span><span class="co"># result with 's' is different</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{s ! romeo, juliet}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; romeo,</span></span>
<span><span class="co">#&gt; juliet</span></span>
<span></span>
<span><span class="co"># with argument: 's' and 'S' are identical</span></span>
<span><span class="co"># note the flag 'fixed' (`f/`) to remove regex interpretation</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{'f/+'s, '-'c ! 5 + 2} = 3"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 5 - 2 = 3</span></span>
<span></span>
<span><span class="co"># group wise operations (here `~(sort, c)`, see dedicated section)</span></span>
<span><span class="va">prince_talk</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"O that this too too solid flesh would melt"</span>,</span>
<span>                <span class="st">"Thaw, and resolve itself into a dew!"</span>,</span>
<span>                <span class="st">"Or that the Everlasting had not fix'd"</span>,</span>
<span>                <span class="st">"His canon 'gainst self-slaughter!"</span><span class="op">)</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Order matters:\n{s, ~(sort, c), fill.c, lower, upper.sentence,</span></span>
<span><span class="st">                          Q, '\n'c ? prince_talk}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Order matters:</span></span>
<span><span class="co">#&gt; "Flesh melt o solid that this too too would"</span></span>
<span><span class="co">#&gt; "   A and dew! Into itself resolve thaw,   "</span></span>
<span><span class="co">#&gt; "  Everlasting fix'd had not or that the   "</span></span>
<span><span class="co">#&gt; "    'gainst canon his self-slaughter!     "</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="c-c-collapse-collapse">c, C, collapse, Collapse<a class="anchor" aria-label="anchor" href="#c-c-collapse-collapse"></a>
</h4>
<p>To collapse (or concatenate) multiple strings into a single one. The
three operations are identical, only their defaults change. The default
is <code>' '</code> for <code>c</code> and <code>collapse</code>, and
<code>', | and '</code> for <code>C</code> and <code>Collapse</code>.
The syntax of the argument is <code>'s1'</code> or <code>'s1|s2'</code>.
s1 is the string used to concatenate (think
<code>paste(x, collapse = s1)</code>). In arguments of the form
<code>'s1|s2'</code>, <code>s2</code> will be used to concatenate the
last two elements. When the elements of the vector are split, each
original item is kept in memory so that group-wise operations can be
applied. See the section on group-wise operations.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># regular way</span></span>
<span><span class="va">x</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"And {' and 'c ? x}!"</span><span class="op">)</span></span>
<span><span class="co">#&gt; And 1 and 2 and 3 and 4!</span></span>
<span></span>
<span><span class="co"># with s2</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Choose: {', | or 'c ? 2:4}?"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Choose: 2, 3 or 4?</span></span>
<span></span>
<span><span class="co"># default of C: enumeration</span></span>
<span><span class="va">wines</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Saint-Estephe"</span>, <span class="st">"Margaux"</span><span class="op">)</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"I like {C?wines}."</span><span class="op">)</span></span>
<span><span class="co">#&gt; I like Saint-Estephe and Margaux.</span></span>
<span></span>
<span><span class="co"># default of c: space concatenation</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{s, '.{5,}'get, c ! I don't like short words}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; don't short words</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="extract-x-x">extract, x, X<a class="anchor" aria-label="anchor" href="#extract-x-x"></a>
</h4>
<p>Extracts the first or multiple patterns from a string. Default
argument is <code>'[[:alnum:]]+'</code>. Command <code>"extract"</code>
accepts the option <code>"first"</code>, and <code>"x"</code> and
<code>"X"</code> accept no option. <code>x</code> is an alias for
<code>extract.first</code> and <code>X</code> for <code>extract</code>.
Use the option <code>"first"</code> to extract only the first match for
each string.</p>
<p>When patterns are extracted, the identity of each original character
string is kept in memory so that group-wise operations can be applied.
See the <a href="#sec_group_wise">section on group-wise
operations</a>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"margo: 32, 1m75"</span>, <span class="st">"luke doe: 27, 1m71"</span><span class="op">)</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{'^\\w+'extract ? x} is {'\\d+'extract.first ? x}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; margo is 32</span></span>
<span><span class="co">#&gt; luke is 27</span></span>
<span></span>
<span><span class="co"># illustrating multiple extractions</span></span>
<span><span class="co"># group-wise operation (~()) is detailed in its own section</span></span>
<span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Combien de marins, combien de capitaines."</span>,</span>
<span>      <span class="st">"Qui sont partis joyeux pour des courses lointaines,"</span>,</span>
<span>      <span class="st">"Dans ce morne horizon se sont évanouis !"</span><span class="op">)</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Endings with i: {'i\\w*'extract, ~(', 'c), enum.1 ? x}."</span><span class="op">)</span></span>
<span><span class="co">#&gt; Endings with i: 1) ien, ins, ien, itaines, 2) i, is, intaines, and 3) izon, is.</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"6 feet under"</span>, <span class="st">"mahogany"</span><span class="op">)</span></span>
<span><span class="co"># single extraction</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{'\\w{3}'x ? x}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; fee</span></span>
<span><span class="co">#&gt; mah</span></span>
<span><span class="co"># multiple extraction</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{'\\w{3}'X ? x}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; fee</span></span>
<span><span class="co">#&gt; und</span></span>
<span><span class="co">#&gt; mah</span></span>
<span><span class="co">#&gt; oga</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="r-r-replace">r, R, replace<a class="anchor" aria-label="anchor" href="#r-r-replace"></a>
</h4>
<p>Replaces a pattern with a string. The three operators are identical
and have no default. Accepts the option <code>"first"</code>. The syntax
is <code>'flags/old'</code> or <code>'old =&gt; new'</code> with
<code>'old'</code> the pattern to find and <code>new</code> the
replacement. <code>flags/</code> are optional regex flags. The default
for <code>new</code> is the empty string. On top of regular regex flags,
this operation also accepts the flag <code>"total"</code> which
instructs to replace the fulll string in case the pattern is found.</p>
<p>If the option <code>"single"</code> is provided, only a single
substitution is performed (the first pattern is replaced). That is, the
function <code><a href="https://rdrr.io/r/base/grep.html" class="external-link">base::sub</a></code> is used instead of
<code><a href="https://rdrr.io/r/base/grep.html" class="external-link">base::gsub</a></code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># regex without replacement (ie removing)</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{'e'replace ! Where is the letter e?}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Whr is th lttr ?</span></span>
<span></span>
<span><span class="co"># regex with replacement</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{'(?&lt;!\\b)e =&gt; a'replace ! Where is the letter e?}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Whara is tha lattar e?</span></span>
<span></span>
<span><span class="co"># with option "single"</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{'(?&lt;!\\b)e =&gt; a'replace.single ! Where is the letter e?}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Whare is the letter e?</span></span>
<span></span>
<span><span class="co"># we replace the full string with the flag total (`t/`)</span></span>
<span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Where is the letter e?"</span>, <span class="st">"Not this way!"</span><span class="op">)</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{'t/e =&gt; here!'r ? x}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; here!</span></span>
<span><span class="co">#&gt; Not this way!</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="op_clean">clean<a class="anchor" aria-label="anchor" href="#op_clean"></a>
</h4>
<p>Replaces a pattern with a string. Similar to the operation
<code>r</code>, except that here the comma is a pattern separator. The
argument is of the form
<code>"flags/pattern1, pattern2 =&gt; replacement"</code>. See detailed
explanations in <a href="https://lrberge.github.io/stringmagic/articles/string_tools.html#sec_clean" class="external-link"><code>str_clean()</code></a>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># we use the fixed pattern to remove the regex meaning</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{'f/[, ]'clean ! x[a]}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; xa</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="get">get<a class="anchor" aria-label="anchor" href="#get"></a>
</h4>
<p>Restricts the string vector to only the values respecting a pattern.
This operation has no default. Accepts the options <code>"equal"</code>
and <code>"in"</code>. By default it uses the same syntax as <a href="https://lrberge.github.io/stringmagic/articles/string_tools.html#detect_funs" class="external-link"><code>str_get()</code></a>
so that you can use regex flags and include logical operations between
regex patterns with <code>' &amp; '</code> and <code>' | '</code>. If
the option <code>"equal"</code> is used, a simple string equality with
the argument is tested (hence no flags are accepted). If the option
<code>"in"</code> is used, the argument is first split with respect to
commas and then set inclusion is tested.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></span>
<span><span class="co">#  we only keep models containing "Merc" and ending with a letter ([[:alpha:]]$)</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Mercedes models: {'Merc &amp; [[:alpha:]]$'get, '^.+ 'r, C ? x}."</span><span class="op">)</span></span>
<span><span class="co">#&gt; Mercedes models: 240D, 280C, 450SE, 450SL and 450SLC.</span></span>
<span></span>
<span><span class="va">models</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Merc 230"</span>, <span class="st">"Merc 450SE"</span>, <span class="st">"Merc 480"</span><span class="op">)</span></span>
<span><span class="co"># we only ekep the ones in the set</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Mercedes models: {`models`get.in, C ? x}."</span><span class="op">)</span></span>
<span><span class="co">#&gt; Mercedes models: Merc 230 and Merc 450SE.</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="is">is<a class="anchor" aria-label="anchor" href="#is"></a>
</h4>
<p>Detects if a pattern is present in a string, returns a logical
vector. This operation has no default. Mostly useful as the final
operation in a <a href="https://lrberge.github.io/stringmagic/articles/string_tools.html#sec_ops" class="external-link"><code>str_ops()</code></a>
call. By default it uses the same syntax as <a href="https://lrberge.github.io/stringmagic/articles/string_tools.html#detect_funs" class="external-link"><code>str_is()</code></a>
so that you can use regex flags and include logical operations between
regex patterns with <code>' &amp; '</code> and <code>' | '</code>. If
the option <code>"equal"</code> is used, a simple string equality with
the argument is tested (hence no flags are accepted). If the option
<code>"in"</code> is used, the argument is first split with respect to
commas and then set inclusion is tested.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Mark"</span>, <span class="st">"Lucas"</span><span class="op">)</span></span>
<span><span class="co"># note that we use the flag `i/` to ignore the case</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Mark? {'i/mark'is, C ? x}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Mark? TRUE and FALSE</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="which">which<a class="anchor" aria-label="anchor" href="#which"></a>
</h4>
<p>Returns the index of string containing a specified pattern. With no
default, can be applied to a logical vector directly. By default it uses
the same syntax as <a href="https://lrberge.github.io/stringmagic/articles/string_tools.html#detect_funs" class="external-link"><code>str_which()</code></a>
so that you can use regex flags and include logical operations between
regex patterns with <code>' &amp; '</code> and <code>' | '</code>. If
the option <code>"equal"</code> is used, a simple string equality with
the argument is tested (hence no flags are accepted). If the option
<code>"in"</code> is used, the argument is first split with respect to
commas and then set inclusion is tested. Mostly useful as the final
operation in a <a href="https://lrberge.github.io/stringmagic/articles/string_tools.html#sec_ops" class="external-link"><code>str_ops()</code></a>
call.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Mark"</span>, <span class="st">"Lucas"</span>, <span class="st">"Markus"</span><span class="op">)</span></span>
<span><span class="co"># note that we use the flag `i` to ignore the case and `w` to add word boundaries</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Mark is number {'iw/mark'which ? x}."</span><span class="op">)</span></span>
<span><span class="co">#&gt; Mark is number 1.</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="subsec_op_length">Operations changing the length or the order<a class="anchor" aria-label="anchor" href="#subsec_op_length"></a>
</h3>
<div class="section level4">
<h4 id="first">first<a class="anchor" aria-label="anchor" href="#first"></a>
</h4>
<p>Keeps only the first <code>n</code> elements.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"First 3 mpg values: {3 first, C ? mtcars$mpg}."</span><span class="op">)</span></span>
<span><span class="co">#&gt; First 3 mpg values: 21, 21 and 22.8.</span></span>
<span></span>
<span><span class="co"># you could have done the same with regular R in the expression...</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"First 3 mpg values: {C ? head(mtcars$mpg, 3)}."</span><span class="op">)</span></span>
<span><span class="co">#&gt; First 3 mpg values: 21, 21 and 22.8.</span></span>
<span></span>
<span><span class="co"># ...but not in the middle of an operations chain</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"First 3 integer mpg values: {'!f/.'get, 3 first, C ? mtcars$mpg}."</span><span class="op">)</span></span>
<span><span class="co">#&gt; First 3 integer mpg values: 21, 21 and 26.</span></span></code></pre></div>
<p>Negative numbers as argument remove the first <code>n</code> values.
You can add a second argument in the form <code>'n1|n2'first</code> in
which case the first <code>n1</code> and last <code>n2</code> values are
kept; <code>n1</code> and <code>n2</code> must be positive numbers.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Letters in the middle: {13 first, 5 last, C ? letters}."</span><span class="op">)</span></span>
<span><span class="co">#&gt; Letters in the middle: i, j, k, l and m.</span></span>
<span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"First and last letters: {'3|3'first, C ? letters}."</span><span class="op">)</span></span>
<span><span class="co">#&gt; First and last letters: a, b, c, x, y and z.</span></span>
<span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Last letters: {-21 first, C ? letters}."</span><span class="op">)</span></span>
<span><span class="co">#&gt; Last letters: v, w, x, y and z.</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="k">K<a class="anchor" aria-label="anchor" href="#k"></a>
</h4>
<p>Keeps only the first <code>n</code> elements; has more options than
<code>first</code>. The syntax is <code>'n'K</code>,
<code>'n|s'K</code>, <code>'n||s'K</code>. <code>n</code> provides the
number of elements to keep. If <code>s</code> is provided and the number
of elements are greater than <code>n</code>, then in <code>'n|s'</code>
the string <code>s</code> is added at the end, and if
<code>'n||s'</code> the string <code>s</code> replaces the nth element.
The string <code>s</code> accepts specials values: + <code>:n:</code> or
<code>:N:</code> which gives the total number of items in digits or
letters (N) + <code>:rest:</code> or <code>:REST:</code> which gives the
number of elements that have been truncated in digits or letters
(REST)</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># basic use</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"First 3 letters: {'3'K, q, C ? letters}."</span><span class="op">)</span></span>
<span><span class="co">#&gt; First 3 letters: 'a', 'b' and 'c'.</span></span>
<span></span>
<span><span class="co"># advanced use: using the extra argument</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"The letters are: {q, '3|:rest: others'K, C ? letters}."</span><span class="op">)</span></span>
<span><span class="co">#&gt; The letters are: 'a', 'b', 'c' and 23 others.</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="last">last<a class="anchor" aria-label="anchor" href="#last"></a>
</h4>
<p>Keeps only the last <code>n</code> elements. Negative numbers as
argument remove the last <code>n</code> values.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Last 3 mpg values: {3 last, C ? mtcars$mpg}."</span><span class="op">)</span></span>
<span><span class="co">#&gt; Last 3 mpg values: 19.7, 15 and 21.4.</span></span>
<span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Removing the 3 last elements leads to {-3 last, C ! x{1:5}}."</span><span class="op">)</span></span>
<span><span class="co">#&gt; Removing the 3 last elements leads to x1 and x2.</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="sort">sort<a class="anchor" aria-label="anchor" href="#sort"></a>
</h4>
<p>Sorts the vector in increasing order. Accepts an optional argument
and the option <code>"num"</code>.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sort"</span>, <span class="st">"me"</span><span class="op">)</span></span>
<span><span class="co"># basic use</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{sort, c ? x}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; me sort</span></span></code></pre></div>
<p>If an argument is provided, it must be a regex pattern that will be
applied to the vector using <a href="https://lrberge.github.io/stringmagic/articles/string_tools.html#sec_clean" class="external-link"><code>str_clean()</code></a>.
The sorting will be applied to the modified version of the vector and
the original vector will be ordered according to this sorting.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># first modifying the string before sorting</span></span>
<span><span class="co"># here the regex first removes the first word, meaning that we sort on the last names</span></span>
<span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Jon Snow"</span>, <span class="st">"Khal Drogo"</span><span class="op">)</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{'.+ 'sort, C?x}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Khal Drogo and Jon Snow</span></span></code></pre></div>
<p>The option <code>"num"</code> sorts over a numeric version (with
silent conversion) of the vector and reorders the original vector
accordingly. Values which could not be converted are last.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="st">"Mark is 34, Bianca is 55, Odette is 101, Julie is 21 and Frank is 5"</span></span>
<span><span class="co"># sort on the "character string" number</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{', | and 's, '\\D'sort, C ? x}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Odette is 101, Julie is 21, Mark is 34, Frank is 5 and Bianca is 55</span></span>
<span></span>
<span><span class="co"># we extract the numbers, then convert to numeric, then sort</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{', | and 's, '\\D'sort.num, C ? x}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Frank is 5, Julie is 21, Mark is 34, Bianca is 55 and Odette is 101</span></span></code></pre></div>
<p><strong>Important note</strong>: the sorting operation is applied
before any character conversion. If previous operations were applied, it
is likely that numeric data were transformed to character.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># note the difference</span></span>
<span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">100</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># sorting on numeric</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{sort, ' + 'c ? x}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 10 + 20 + 100</span></span>
<span><span class="co"># sorting on character since 'n' operation transformed the vector to character</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{n, sort, ' + 'c ? x}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 10 + 100 + 20</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="dsort">dsort<a class="anchor" aria-label="anchor" href="#dsort"></a>
</h4>
<p>Sorts the vector in decreasing order. It accepts an optional argument
and the option <code>"num"</code>. See the operation <code>"sort"</code>
for a description of the argument and the option.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"5 = {dsort, ' + 'c ? 2:3}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 5 = 3 + 2</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="rev">rev<a class="anchor" aria-label="anchor" href="#rev"></a>
</h4>
<p>Reverses the vector.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{rev, ''c ? 1:3}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 321</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="unik">unik<a class="anchor" aria-label="anchor" href="#unik"></a>
</h4>
<p>Makes the string vector unique.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Iris species: {unik, upper.first, C ? iris$Species}."</span><span class="op">)</span></span>
<span><span class="co">#&gt; Iris species: Setosa, Versicolor and Virginica.</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="each">each<a class="anchor" aria-label="anchor" href="#each"></a>
</h4>
<p>Repeats each element of the vector <code>n</code> times. Option
<code>"c"</code> then collapses the full vector with the empty string as
a separator.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># note: operation `S` splits splits wrt to commas (default behavior)</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{S!x, y}{2 each ? 1:2}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; x1</span></span>
<span><span class="co">#&gt; y1</span></span>
<span><span class="co">#&gt; x2</span></span>
<span><span class="co">#&gt; y2</span></span>
<span></span>
<span><span class="co"># illustrating collapsing</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Large number: 1{5 each.c ! 0}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Large number: 100000</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="times">times<a class="anchor" aria-label="anchor" href="#times"></a>
</h4>
<p>Repeats the vector sequence <code>n</code> times. Option
<code>"c"</code> then collapses the full vector with the empty string as
a separator.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"What{6 times.c ! ?}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; What??????</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="rm">rm<a class="anchor" aria-label="anchor" href="#rm"></a>
</h4>
<p>Removes elements from the vector. Options: <code>"empty"</code>,
<code>"blank"</code>, <code>"noalpha"</code>, <code>"noalnum"</code>,
<code>"all"</code>. The <em>optional</em> argument represents the
pattern used to detect strings to be deleted.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Luke"</span>, <span class="st">"Charles"</span><span class="op">)</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{'i/lu'rm ? x}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Charles</span></span></code></pre></div>
<p>By default it removes empty strings. Option <code>"blank"</code>
removes strings containing only blank characters (spaces, tab, newline).
Option <code>"noalpha"</code> removes strings not containing letters.
Option <code>"noalnum"</code> removes strings not containing alpha
numeric characters. Option <code>"all"</code> removes all strings
(useful in conditions, see the dedicated section). If an argument is
provided, only the options <code>"empty"</code> and <code>"blank"</code>
are available.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"I want to enter."</span>, <span class="st">"Age?"</span>, <span class="st">"21."</span><span class="op">)</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Nightclub conversation: {rm.noalpha, c ! - {x}}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Nightclub conversation: - I want to enter. - Age?</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="nuke">nuke<a class="anchor" aria-label="anchor" href="#nuke"></a>
</h4>
<p>Removes all elements, equivalent to <code>rm.all</code> but possibly
more explicit. Useful in conditions, see the dedicated section.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">7</span>, <span class="fl">453</span>, <span class="fl">647</span><span class="op">)</span></span>
<span><span class="co"># here we use a condition: see the dedicated section for more information</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Small numbers only: {if(.&gt;20 ; nuke), C ? x}."</span><span class="op">)</span></span>
<span><span class="co">#&gt; Small numbers only: 5 and 7.</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="insert">insert<a class="anchor" aria-label="anchor" href="#insert"></a>
</h4>
<p>Inserts a new element to the vector. Options: <code>"right"</code>
and <code>"both"</code>. Option <code>"right"</code> adds the new
element to the right. Option <code>"both"</code> inserts the new element
on the two sides of the vector.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{'3'insert.right, ' + 'c ? 1:2}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 1 + 2 + 3</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="formatting-operations">Formatting operations<a class="anchor" aria-label="anchor" href="#formatting-operations"></a>
</h3>
<div class="section level4">
<h4 id="lower">lower<a class="anchor" aria-label="anchor" href="#lower"></a>
</h4>
<p>Lower cases the full string.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="st">"MesSeD uP CaSe"</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"from a {x} to {lower?x}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; from a MesSeD uP CaSe to messed up case</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="upper">upper<a class="anchor" aria-label="anchor" href="#upper"></a>
</h4>
<p>Upper cases the full string. Options: <code>"first"</code> and
<code>"sentence"</code>. Option <code>"first"</code> upper cases only
the first character. Option <code>"sentence"</code> upper cases the
first letter after punctuation.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="st">"hi. how are you? fine."</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{upper.sentence ? x}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Hi. How are you? Fine.</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="title">title<a class="anchor" aria-label="anchor" href="#title"></a>
</h4>
<p>Applies a title case to the string. Options: <code>"force"</code> and
<code>"ignore"</code>. Option <code>"force"</code> first puts everything
to lowercase before applying the title case. Option
<code>"ignore"</code> ignores a few small prepositions (“a”, “the”,
“of”, etc).</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="st">"bryan is in the KITCHEN"</span></span>
<span></span>
<span><span class="co"># default: respects upper cases</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{title ? x}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Bryan Is In The KITCHEN</span></span>
<span></span>
<span><span class="co"># force: force to title case</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{title.force ? x}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Bryan Is In The Kitchen</span></span>
<span></span>
<span><span class="co"># ignore: ignores small prepositions</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{title.force.ignore ? x}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Bryan Is in the Kitchen</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="ws">ws<a class="anchor" aria-label="anchor" href="#ws"></a>
</h4>
<p>Normalizes whitespaces (WS). It trims the whitespaces on the edges
and transforms any succession of whitespaces into a single one. Can also
be used to further clean the string with its options. Options:
<code>"punct"</code>, <code>"digit"</code>, <code>"isolated"</code>.
Option <code>"punct"</code> cleans the punctuation. Option
<code>"digit"</code> cleans digits. Option <code>"isolated"</code>
cleans isolated letters. WS normalization always come after any of these
options. <strong>Important note:</strong> punctuation (or digits) are
replaced with WS and <strong>not</strong> the empty string. This means
that <code>smagic("ws.punct ! Meg's car")</code> will become
<code>"Meg s car"</code>.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="st">"   I    should? review 85 4 this text!!"</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"v0: {x}"</span>, </span>
<span>        <span class="st">"v1: {ws ? x}"</span>,</span>
<span>        <span class="st">"v2: {ws.punct ? x}"</span>,</span>
<span>        <span class="st">"v3: {ws.punct.digit ? x}"</span>,</span>
<span>        <span class="st">"v4: {ws.punct.digit.isolated ? x}"</span>, .sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; v0:    I    should? review 85 4 this text!!</span></span>
<span><span class="co">#&gt; v1: I should? review 85 4 this text!!</span></span>
<span><span class="co">#&gt; v2: I should review 85 4 this text</span></span>
<span><span class="co">#&gt; v3: I should review this text</span></span>
<span><span class="co">#&gt; v4: should review this text</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="trimws">trimws<a class="anchor" aria-label="anchor" href="#trimws"></a>
</h4>
<p>Trims the white spaces on both ends of the strings.</p>
</div>
<div class="section level4">
<h4 id="q-q-bq">q, Q, bq<a class="anchor" aria-label="anchor" href="#q-q-bq"></a>
</h4>
<p>To add quotes to the strings. q: single quotes, Q: double quotes, bq:
back quotes.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Mark"</span>, <span class="st">"Pam"</span><span class="op">)</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Hello {q, C ? x}!"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Hello 'Mark' and 'Pam'!</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="format-format">format, Format<a class="anchor" aria-label="anchor" href="#format-format"></a>
</h4>
<p>Applies the base R’s function <code><a href="https://rdrr.io/r/base/format.html" class="external-link">base::format()</a></code> to the
string. By default, the values are left aligned, <em>even numbers</em>
(differently from <code><a href="https://rdrr.io/r/base/format.html" class="external-link">base::format()</a></code>’s behavior). The upper
case command (<code>Format</code>) applies right alignment. Options:
<code>"0"</code>, <code>"zero"</code>, <code>"right"</code>,
<code>"center"</code>. Options <code>"0"</code> or <code>"zero"</code>
fills the blanks with 0s: useful to format numbers. Option
<code>"right"</code> right aligns, and <code>"center"</code> centers the
strings.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">12345</span><span class="op">)</span> </span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"left:   {format, q, C ? x}"</span>, </span>
<span>        <span class="st">"right:  {Format, q, C ? x}"</span>,</span>
<span>        <span class="st">"center: {format.center, q, C ? x}"</span>,</span>
<span>        <span class="st">"zero:   {format.0, q, C ? x}"</span>, .sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; left:   '1     ' and '12,345'</span></span>
<span><span class="co">#&gt; right:  '     1' and '12,345'</span></span>
<span><span class="co">#&gt; center: '  1   ' and '12,345'</span></span>
<span><span class="co">#&gt; zero:   '000001' and '12,345'</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="section">%<a class="anchor" aria-label="anchor" href="#section"></a>
</h4>
<p>Applies <code><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">base::sprintf()</a></code> formatting. The syntax is
<code>'arg'%</code> with arg an sprintf formatting, or directly the
sprint formatting.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"pi = {%.3f ? pi}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; pi = 3.142</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="stopwords">stopwords<a class="anchor" aria-label="anchor" href="#stopwords"></a>
</h4>
<p>Removes basic English stopwords (the snowball list is used). The
stopwords are replaced with an empty space but the left and right WS are
untouched. So WS normalization may be needed (see operation
<code>ws</code>).</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"He is tall"</span>, <span class="st">"He isn't young"</span><span class="op">)</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Is he {stop, ws, C ? x}?"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Is he tall and young?</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="ascii">ascii<a class="anchor" aria-label="anchor" href="#ascii"></a>
</h4>
<p>Turns all letters into ASCII with transliteration. Failed
translations are transformed into question marks. Options:
<code>"silent"</code>, <code>"utf8"</code>. By default, if some
conversion fails a warning is prompted. Option <code>"silent"</code>
disables the warning in case of failed conversion. The conversion is
done with <code><a href="https://rdrr.io/r/base/iconv.html" class="external-link">base::iconv()</a></code>, option <code>"utf8"</code>
indicates that the source endocing is UTF-8, can be useful in some
cases.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">author</span> <span class="op">=</span> <span class="st">"Laurent Bergé"</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"This package has been developped by {ascii ? author}."</span><span class="op">)</span></span>
<span><span class="co">#&gt; This package has been developped by Laurent Berge.</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="n-n-formatting-integers">n, N: Formatting integers<a class="anchor" aria-label="anchor" href="#n-n-formatting-integers"></a>
</h4>
<p>Formats integers by adding a comma to separate thousands. Options:
<code>"letter"</code>, <code>"upper"</code>, <code>"0"</code>,
<code>"zero"</code>, <code>"roman"</code>, <code>"Roman"</code>. The
option <code>"letter"</code> writes the number in letters (large numbers
keep their numeric format). The option <code>"upper"</code> is like the
option <code>"letter"</code> but uppercases the first letter. Options
<code>"0"</code> or <code>"zero"</code> left pads numeric vectors with
0s. The options <code>"roman"</code> and <code>"Roman"</code> write the
integer in Roman with <code><a href="https://rdrr.io/r/utils/roman.html" class="external-link">utils::as.roman</a></code>. The lower case
version writes them in lower case. The upper case command
(<code>N</code>) adds the option <code>"letter"</code>.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">12</span>, <span class="fl">52123</span><span class="op">)</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"She owes {n, '$'paste, C ? x}."</span><span class="op">)</span></span>
<span><span class="co">#&gt; She owes $5, $12 and $52,123.</span></span>
<span></span>
<span><span class="co"># option 0: all same width, no ',' for thousands</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"|---|\n{n.0, '\n'c ? x}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; |---|</span></span>
<span><span class="co">#&gt; 00005</span></span>
<span><span class="co">#&gt; 00012</span></span>
<span><span class="co">#&gt; 52123</span></span>
<span></span>
<span><span class="co"># option "upper"</span></span>
<span><span class="va">n</span> <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{n.upper ? n} is my favourite number."</span><span class="op">)</span></span>
<span><span class="co">#&gt; Five is my favourite number.</span></span>
<span></span>
<span><span class="co"># N: like "n.letter"</span></span>
<span><span class="va">x</span> <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"He's {N ? x} years old."</span><span class="op">)</span></span>
<span><span class="co">#&gt; He's five years old.</span></span>
<span></span>
<span><span class="co"># roman</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"What's nicer? {c?11:13}, {n.roman, c?11:13} or {n.Roman, c?11:13}?"</span><span class="op">)</span></span>
<span><span class="co">#&gt; What's nicer? 11 12 13, xi xii xiii or XI XII XIII?</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="nth-nth-numbered-position">nth, Nth: Numbered position<a class="anchor" aria-label="anchor" href="#nth-nth-numbered-position"></a>
</h4>
<p>When applied to a number, this operator writes them as a rank.
Options: <code>"letter"</code>, <code>"upper"</code>,
<code>"compact"</code>.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">7</span><span class="op">)</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"They finished {nth, enum ? n}!"</span><span class="op">)</span></span>
<span><span class="co">#&gt; They finished 3rd and 7th!</span></span></code></pre></div>
<p>Option <code>"letter"</code> tries to write the numbers in letters,
but note that it stops at 20. Option <code>"upper"</code> is the same as
<code>"letter"</code> but uppercases the first letter. Option
<code>"compact"</code> aggregates consecutive sequences in the form
<code>"start_n_th to end_n_th"</code>.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"They arrived {nth.compact ? 5:20}."</span><span class="op">)</span></span>
<span><span class="co">#&gt; They arrived 5th to 20th.</span></span></code></pre></div>
<p>The upper case command (<code>Nth</code>) adds the option
<code>"letter"</code>.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">7</span><span class="op">)</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"They finished {Nth, enum ? n}!"</span><span class="op">)</span></span>
<span><span class="co">#&gt; They finished third and seventh!</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="ntimes-ntimes-number-of-times">ntimes, Ntimes: Number of times<a class="anchor" aria-label="anchor" href="#ntimes-ntimes-number-of-times"></a>
</h4>
<p>Write numbers in the form <code>n</code> times. Options:
<code>"letter"</code>, <code>"upper"</code>. Option
<code>"letter"</code> writes the number in letters (up to 100). Option
<code>"upper"</code> does the same as <code>"letter"</code> and
uppercases the first letter.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"They lost {C ! {ntimes ? c(1, 12)} against {S!Real, Barcelona}}."</span><span class="op">)</span></span>
<span><span class="co">#&gt; They lost once against Real and 12 times against Barcelona.</span></span></code></pre></div>
<p>The upper case command (<code>Ntimes</code>) adds the option
<code>"letter"</code>.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"This paper was rejected {Ntimes ? x}..."</span><span class="op">)</span></span>
<span><span class="co">#&gt; This paper was rejected five times...</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="firstchar-lastchar-firstlast-characters">firstchar, lastchar: First/last characters<a class="anchor" aria-label="anchor" href="#firstchar-lastchar-firstlast-characters"></a>
</h4>
<p>To select the first/last characters of each element. Negative numbers
remove the first/last characters.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{19 firstchar, 9 lastchar ! This is a very long sentence}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; very long</span></span>
<span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"delete 3 = {-3 firstchar ! delete 3}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; delete 3 = ete 3</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="k-shorten-shorten-shortens-character-strings">k, shorten, Shorten: Shortens character strings<a class="anchor" aria-label="anchor" href="#k-shorten-shorten-shortens-character-strings"></a>
</h4>
<p>To keep only the first <code>n</code> characters (like
<code>firstchar</code> but with more options). (Note that <code>k</code>
stands for “keep” and exists for historical reasons.) Available options:
<code>"include"</code>, <code>"dots"</code>. The argument can be of the
form <code>'n'</code> or <code>'n|s'</code> with <code>n</code> a number
and <code>s</code> a string. <code>n</code> provides the number of
characters to keep. Optionnaly, only for strings <em>whose length is
greater than <code>n</code></em>, after truncation, the string
<code>s</code> is appended at the end.</p>
<p>By default, if argument <code>s</code> is provided, strings longer
than <code>n</code> end up at size <code>n + nchar(s)</code>. If option
<code>"include"</code> is provided, the strings are guaranteed to be of
maximum size <code>n</code>, even after the string <code>s</code> has
been appended. Example: if <code>n=4</code> and <code>s=".."</code>,
then “hello” becomes “hell..” without <code>"include"</code>, and “he..”
with it.</p>
<p>Option <code>"dots"</code>: if strings are longer than
<code>n+1</code>, they are truncated at <code>n-1</code> and two dots
are appended. For example if <code>n = 3</code>, then “hello” becomes
“he..”. Disregards the argument <code>s</code>. The operation
<code>"Shorten"</code> (upper case), is with the option
<code>"dots"</code>.</p>
<p>Note that another way to add the option <code>"include"</code> is to
use a double pipe for the argument <code>s</code>, like in
<code>'n||s'</code>.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="st">"long sentence"</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"v0: {x}"</span>, </span>
<span>        <span class="st">"v1: {4 shorten ? x}"</span>, </span>
<span>        <span class="st">"v2: {'4|..'shorten ? x}"</span>, </span>
<span>        <span class="st">"v3: {'4|..'shorten.include ? x}"</span>, </span>
<span>        <span class="st">"v4: {4 shorten.dots ? x}"</span>, .sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; v0: long sentence</span></span>
<span><span class="co">#&gt; v1: long</span></span>
<span><span class="co">#&gt; v2: long..</span></span>
<span><span class="co">#&gt; v3: lo..</span></span>
<span><span class="co">#&gt; v4: lon..</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="fill">fill<a class="anchor" aria-label="anchor" href="#fill"></a>
</h4>
<p>Fills the character strings up to a size. Options:
<code>"right"</code> or <code>"center"</code>. Default is left-alignment
of the strings.</p>
<p>The argument is optional and can be of the form <code>'n'</code> or
<code>'n|s'</code>. By default if no argument is provided, of if
<code>n=0</code>,<code>n</code> is equal to the maximum character length
of the vector. The optional argument <code>s</code> is a symbol used to
fill the blanks. By default <code>s</code> is equal to a white
space.</p>
<p>Option <code>"right"</code> right aligns and <code>"center"</code>
centers the strings.</p>
<p>See help for <a href="https://lrberge.github.io/stringmagic/reference/str_fill.html" class="external-link"><code>str_fill()</code></a>
for more information.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">life</span> <span class="op">=</span> <span class="st">"full of sound and fury, Signifying nothing"</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{'[ ,]+'s, upper.first, fill.center, q, '\n'c ? life}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; '   Full   '</span></span>
<span><span class="co">#&gt; '    Of    '</span></span>
<span><span class="co">#&gt; '  Sound   '</span></span>
<span><span class="co">#&gt; '   And    '</span></span>
<span><span class="co">#&gt; '   Fury   '</span></span>
<span><span class="co">#&gt; 'Signifying'</span></span>
<span><span class="co">#&gt; ' Nothing  '</span></span>
<span></span>
<span><span class="co"># fixing the length and filling with 0s</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{'5|0'fill.right, C ? c(1, 55)}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 00001 and 00055</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="paste">paste<a class="anchor" aria-label="anchor" href="#paste"></a>
</h4>
<p>Pastes a custom character string to all elements of the string. This
operation has no default. Options: <code>"both"</code>,
<code>"right"</code>, <code>"front"</code>, <code>"back"</code>,
<code>"delete"</code>. By default, a string is pasted on the left.
Option <code>"right"</code> pastes on the right and <code>"both"</code>
pastes on both sides. Option <code>"front"</code> only pastes on the
first element while option <code>"back"</code> only pastes on the last
element. Option <code>"delete"</code> first replaces all elements with
the empty string.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"6 = {'|'paste.both, ' + 'c ? -3:-1}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 6 = |-3| + |-2| + |-1|</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="other-operations">Other operations:<a class="anchor" aria-label="anchor" href="#other-operations"></a>
</h3>
<div class="section level4">
<h4 id="num">num<a class="anchor" aria-label="anchor" href="#num"></a>
</h4>
<p>Converts to numeric. Options: <code>"warn"</code>,
<code>"soft"</code>, <code>"rm"</code>, <code>"clear"</code>. By
default, the conversion is performed silently and elements that fail to
convert are turned into NA. Option <code>"warn"</code> displays a
warning if the conversion to numeric fails. Option <code>"soft"</code>
does not convert if the conversion of at least one element fails,
leading to a character vector. Option <code>"rm"</code> converts and
removes the elements that could not be converted. Option
<code>"clear"</code> turns failed conversions into the empty string, and
hence lead to a character vector.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="st">"six"</span><span class="op">)</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"   origin: {C, q ? x}"</span>, </span>
<span>        <span class="st">"      num: {num, C, q ? x}"</span>, </span>
<span>        <span class="st">"   num.rm: {num.rm, C, q ? x}"</span>, </span>
<span>        <span class="st">" num.soft: {num.soft, C, q ? x}"</span>, </span>
<span>        <span class="st">"num.clear: {num.clear, C, q ? x}"</span>, .sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;    origin: '5 and six'</span></span>
<span><span class="co">#&gt;       num: '5 and NA'</span></span>
<span><span class="co">#&gt;    num.rm: '5'</span></span>
<span><span class="co">#&gt;  num.soft: '5 and six'</span></span>
<span><span class="co">#&gt; num.clear: '5 and '</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="enum">enum<a class="anchor" aria-label="anchor" href="#enum"></a>
</h4>
<p>Enumerates the elements. It creates a single string containing the
comma separated list of elements. If there are more than 7 elements,
only the first 6 are shown and the number of items left is written.</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"enum ? 1:5"</span><span class="op">)</span></span>
<span><span class="co">#&gt; enum ? 1:5</span></span></code></pre></div>
<p>You can add the following options:</p>
<ul>
<li>
<code>q</code>, <code>Q</code>, or <code>bq</code>: to quote the
elements</li>
<li>
<code>or</code>, <code>nor</code>: to finish with an ‘or’ (or ‘nor’)
instead of an ‘and’</li>
<li>
<code>i</code>, <code>I</code>, <code>a</code>, <code>A</code>,
<code>1</code>: to enumerate with this prefix, like in: i) one, and ii)
two</li>
<li>a number: to tell the number of items to display</li>
</ul>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Marv"</span>, <span class="st">"Nancy"</span><span class="op">)</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"The murderer must be {enum.or ? x}."</span><span class="op">)</span></span>
<span><span class="co">#&gt; The murderer must be Marv or Nancy.</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"oranges"</span>, <span class="st">"milk"</span>, <span class="st">"rice"</span><span class="op">)</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Shopping list: {enum.i.q ? x}."</span><span class="op">)</span></span>
<span><span class="co">#&gt; Shopping list: i) 'oranges', ii) 'milk', and iii) 'rice'.</span></span>
<span></span>
<span><span class="co"># enum is made for display: when vectors are too long, they are truncated</span></span>
<span><span class="co"># default is at 7</span></span>
<span><span class="va">x</span> <span class="op">=</span> <span class="fu">smagic</span><span class="op">(</span><span class="st">"x{sample(100, 30)}"</span><span class="op">)</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"The problematic variables are {'x'sort.num, enum ? x}."</span><span class="op">)</span></span>
<span><span class="co">#&gt; The problematic variables are x1, x4, x7, x11, x12, x14 and 24 others.</span></span>
<span></span>
<span><span class="co"># you can augment or reduce the numbers to display with an option</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"The problematic variables are {'x'sort.num, enum.3 ? x}."</span><span class="op">)</span></span>
<span><span class="co">#&gt; The problematic variables are x1, x4 and 28 others.</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="len-len">len, Len<a class="anchor" aria-label="anchor" href="#len-len"></a>
</h4>
<p>Gives the length of the vector. Options <code>"letter"</code>,
<code>"upper"</code>, <code>"format"</code>. Option
<code>"letter"</code> writes the length in words (up to 100). Option
<code>"upper"</code> is the same as letter but uppercases the first
letter. Option <code>"format"</code> add comma separation for
thousands.</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Size = {len.format ? 1:5000}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Size = 5,000</span></span></code></pre></div>
<p>The upper case command (<code>Len</code>) adds the option
<code>"letter"</code>.</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Its size is {Len ? 1:8}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Its size is eight</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="width">width<a class="anchor" aria-label="anchor" href="#width"></a>
</h4>
<p>Formats the string to fit a given width by cutting at word
boundaries. Accepts arguments of the form <code>'n'</code> or
<code>'n|s'</code>, with <code>n</code> a number and <code>s</code> a
string. An argument of the form <code>'n|s'</code> will add
<code>s</code> at the beginning of each line. Further, by default a
trailing white space is added to <code>s</code>; to remove this
behavior, add an underscore at the end of it. The argument
<code>n</code> is either an integer giving the target character width
(minimum is 15), or it can be a fraction expressing the target size as a
fraction of the current screen. Finally it can be an expression that
uses the variable <code>.sw</code> which will capture the value of the
current screen width.</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="st">"this is a long sentence"</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"------ version 0 ------\n{x}"</span>, </span>
<span>        <span class="st">"------ version 1 ------\n{15 width ? x}"</span>, </span>
<span>        <span class="st">"------ version 2 ------\n{'15|#&gt;'width ? x}"</span>,</span>
<span>        <span class="st">"------ version 3 ------\n{'15|#&gt;_'width ? x}"</span>, .sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; ------ version 0 ------</span></span>
<span><span class="co">#&gt; this is a long sentence</span></span>
<span><span class="co">#&gt; ------ version 1 ------</span></span>
<span><span class="co">#&gt; this is a long</span></span>
<span><span class="co">#&gt; sentence</span></span>
<span><span class="co">#&gt; ------ version 2 ------</span></span>
<span><span class="co">#&gt; #&gt; this is a</span></span>
<span><span class="co">#&gt; #&gt; long</span></span>
<span><span class="co">#&gt; #&gt; sentence</span></span>
<span><span class="co">#&gt; ------ version 3 ------</span></span>
<span><span class="co">#&gt; #&gt;this is a</span></span>
<span><span class="co">#&gt; #&gt;long sentence</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="dtime">dtime<a class="anchor" aria-label="anchor" href="#dtime"></a>
</h4>
<p>Displays a formatted time difference. Option <code>"silent"</code>
does not report a warning if the operation fails. It accepts either
objects of class <code>POSIXt</code> or <code>difftime</code>.</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">0.15</span><span class="op">)</span> </span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Time: {dtime ? x}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Time: 163ms</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="sec_group_wise">Group-wise operations<a class="anchor" aria-label="anchor" href="#sec_group_wise"></a>
</h2>
<p>In <code>smagic</code>, the operations <code>s</code> (split) and
<code>extract</code> keep a memory of the strings that were split
(i.e. they provide multiple results for each initial string
element).</p>
<p>Use the tilde operator, of the form <code>~(op1, op2)</code>, to
apply operations group-wise, to each of the split strings. Better with
an example.</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Oreste, Hermione"</span>, <span class="st">"Hermione, Pyrrhus"</span>, <span class="st">"Pyrrhus, Andromaque"</span><span class="op">)</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Troubles ahead: {S, ~(' loves 'c), C ? x}."</span><span class="op">)</span></span>
<span><span class="co">#&gt; Troubles ahead: Oreste loves Hermione, Hermione loves Pyrrhus and Pyrrhus loves Andromaque.</span></span></code></pre></div>
<p>Almost all operations can be applied group-wise (although only
operations changing the order or the length of the strings really
matter, see the <a href="#subsec_op_length">dedicated section</a>).</p>
</div>
<div class="section level2">
<h2 id="sec_conditional">Conditional operations<a class="anchor" aria-label="anchor" href="#sec_conditional"></a>
</h2>
<p>There are two operators to apply operations conditionally:
<code>if</code> and <code>vif</code>, the latter standing for
<em>verbatim if</em>.</p>
<p>The syntax of <code>if</code> is
<code>if(cond ; ops_true ; ops_false)</code> with <code>cond</code> a
condition (i.e. logical operation) on the value being interpolated,
<code>ops_true</code> a comma-separated sequence of operations if the
condition is <code>TRUE</code> and <code>ops_false</code> an
<em>optional</em> a sequence of operations if the condition is
<code>FALSE</code>.</p>
<p>Ex.1: Let’s take a sentence, delete words of less than 4 characters,
and trim words of 7+ characters.</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="st">"Songe Céphise à cette nuit cruelle qui fut pour tout un peuple une nuit éternelle"</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{s, if(.nchar&lt;=4 ; nuke ; '7|..'k), c ? x}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Songe Céphise cette cruelle peuple éternel..</span></span></code></pre></div>
<p>Let’s break it down. First the sentence is split w.r.t. spaces
(command <code>s</code>), leading to a vector of words. Then we use the
special variable <code>.nchar</code> in <code>if</code>’s condition to
refer to the number of characters of the current vector (the words). The
words with less than 4 characters are nuked (i.e. removed), and the
other words are trimmed at 7 characters (<code>'7|..'k</code>). Finally
the modified vector of words is collapsed with the command
<code>c</code>, leading to the result.</p>
<p>The condition <code>cond</code> accepts the following special values:
<code>.</code> (the dot), <code>.nchar</code>, <code>.C</code>,
<code>.len</code>, <code>.N</code>. The dot, <code>.</code>, refers to
the current vector. <code>.nchar</code> represent the number of
characters of the current vector (equivalent to <code>nchar(.)</code>).
<code>.C</code> is an alias to <code>.nchar</code>. <code>.len</code>
represent the length of the current vector (equivalent to
<code>length(.)</code>). <code>.N</code> is an alias to
<code>.len</code>.</p>
<p>In Ex.1 the condition led to a vector of length greater than 1
(length = number of words), triggerring element-wise operations. If a
condition leads to a result of length 1, then the operations are applied
to the full string vector. Contrary to element-wise conditions for which
operations modifying the length of the vectors are
<strong>forbidden</strong> (apart from nuking), such operations are fine
in full-string conditions.</p>
<p>Ex.2: we write the sum of several elements, if the vector is longer
than 4, we replace all remaining elements with an ellispsis.</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># same expression for two values of x give different results</span></span>
<span><span class="va">x_short</span> <span class="op">=</span> <span class="fu">smagic</span><span class="op">(</span><span class="st">"x{1:4}"</span><span class="op">)</span></span>
<span><span class="co"># the false statement is missing: it means that nothing is done is .N&lt;=4</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"y = {if(.N&gt;4 ; 3 first, '...'insert.right), ' + 'c ? x_short}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; y = x1 + x2 + x3 + x4</span></span>
<span><span class="co"># here equiv to: smagic("y = {' + 'c ? x_short}")</span></span>
<span></span>
<span><span class="va">x_long</span> <span class="op">=</span> <span class="fu">smagic</span><span class="op">(</span><span class="st">"x{1:10}"</span><span class="op">)</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"y = {if(.N&gt;4 ; 3 first, '...'insert.right), ' + 'c ? x_long}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; y = x1 + x2 + x3 + ...</span></span>
<span><span class="co"># here equiv to: smagic("y = {3 first, '...'insert.right, ' + 'c ? x_long}")</span></span></code></pre></div>
<p>For <code>vif</code>, the syntax is
<code>vif(cond ; verb_true ; verb_false)</code> with
<code>verb_true</code> a verbatim value with which the vector will be
replaced if the condition is <code>TRUE</code>. This is similar for
<code>verb_false</code>. The condition works as in <code>if</code>.</p>
<p>Ex.3: we want to replace all values lower than 10 by the the string
“&lt;10”, and then create an enumeration.</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">25</span>, <span class="fl">12</span>, <span class="fl">6</span><span class="op">)</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Values: {vif(.&lt;10 ; &lt;10), C ? x}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Values: &lt;10, 25, 12 and &lt;10</span></span></code></pre></div>
<p>In Ex.3 the condition is of the same length as the vector, so an
element-wise operation is triggered. Conditions of length 1 apply the
replacement to the full vector. Knowing this, let’s redo Ex.3
differently:</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fu">smagic</span><span class="op">(</span><span class="st">"x{1:10}"</span><span class="op">)</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"y = {vif(.N&gt;4 ; {x[1]} + ... + {last?x} ; {' + 'c?x}) ? x}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; y = x1 + ... + x10</span></span></code></pre></div>
<p>Let’s break it down. If the length of the vector is greater than 4
(here it’s 10), then the full string is replaced with
<code>"{x[1]} + ... + {last?x}"</code>. Since this string contains curly
brackets, interpolation applies. Hence we obtain the string
<code>"x1 + ... + x10"</code>. Finally, this is collated to
<code>"y = "</code> leading to the result.</p>
<p>If the vector were of length lower than 4, it would have been
replaced with “{’ + ’c?x}”, which will be interpolated.</p>
<p>The <code>vif</code> condition allows the use of ‘.’ to refer to the
current value in <code>verb_true</code> and <code>verb_false</code>, as
illustrated by the last example.</p>
<p>Ex.5: we take in numeric values, keep only the last 4 values, append
<code>x</code> for odd numbers and <code>y</code> for even numbers, we
further revert the order of the even numbers.</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{4 last, vif(. %% 2 ; x{.} ; y{rev?.}), C ? 1:11}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; y10, x9, y8 and x11</span></span></code></pre></div>
<p>Let’s break it down. We take in <code>1:11</code>, and after the
command <code>4 last</code> we’re left with <code>8:11</code>. Then
<code>vif</code> applies. The elements for which the condition,
<code>. %% 2</code>, is true are <code>c(9, 11)</code> and these
elements are transofrmed into <code>c("x9", "x11")</code> thanks to
<code>"x{.}"</code>. The elements for which the condition is false are
<code>c(8, 10)</code>. These elements are transformed into
<code>c("y10", "y8")</code> due to <code>"y{rev?.}"</code>. Each element
of the vector is then replaced with these values, here’s a sketch of
what happens: <code>vec[cond==TRUE] = c("x9", "x11")</code> and
<code>vec[cond==FALSE] = c("y10", "y8")</code>. This leads to the
result.</p>
</div>
<div class="section level2">
<h2 id="sec_ifelse">Special interpolation: if-else<a class="anchor" aria-label="anchor" href="#sec_ifelse"></a>
</h2>
<p>Using an ampersand (“&amp;”) as the first character of an
interpolation leads to an <em>if-else</em> operation. Using two
ampersands (“&amp;&amp;”) leads to a slightly different operation
described at the end of this section.</p>
<p>The syntax is as follows:
<code>{&amp;cond ; verb_true ; verb_false}</code> with <code>cond</code>
a condition (i.e. logical operation), <code>verb_true</code> a verbatim
value with which the vector will be replaced if the condition is
<code>TRUE</code> and <code>verb_false</code> an <em>optional</em>
verbatim value with which the vector will be replaced if the condition
is <code>FALSE</code>. If not provided, <code>verb_false</code> is
considered to be the <em>empty string</em> unless the operator is the
double ampersand described (<code>&amp;&amp;</code>) at the end of this
section.</p>
<p>Note that in <code>cond</code>, you can use the function
<code>len</code>, an alias to <code>length</code>.</p>
<p>Ex.1: we take a vector and compose a message depending on its length.
If its length is lower than 10 then we write the message
<code>"x is short"</code>, otherwise we write <code>"x is long"</code>,
and insert <code>"very"</code> depending on the number of digits.</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"x is {&amp;len(x)&lt;10 ; short ; {`log10(.N)-1`times, ''c ! very }long}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; x is short</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">50</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"x is {&amp;len(x)&lt;10 ; short ; {`log10(.N)-1`times, ''c ! very }long}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; x is long</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5000</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"x is {&amp;len(x)&lt;10 ; short ; {`log10(.N)-1`times, ''c ! very }long}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; x is very very long</span></span></code></pre></div>
<p>If a condition leads to a result of length 1, the full string is
replaced by the verbatim expression. Further, this expression will be
interpolated if requested. This was the case in Ex.1 where
<code>verb_false</code> was interpolated.</p>
<p>If the condition uses a variable, in later interpolations you can
refer to the first variable present in the condition with ‘.’, and use
‘.len’ or ‘.N’ to refer to its length.</p>
<p>If the condition’s length is greater than 1, then each logical values
equal to <code>TRUE</code> is replaced by <code>verb_true</code>, and
<code>FALSE</code> values are replaced with <code>verb_false</code>.
There can be interpolation on the values <code>verb_true</code> and
<code>verb_false</code>. In that case the interpolation must result into
a vector of either length 1 or a length equal to the condition. Then
element-wise replacements are made, a la <code><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">base::ifelse</a></code>.</p>
<p>Ex.2: illustration of element-wise replacements.</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span></span>
<span><span class="va">y</span> <span class="op">=</span> <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{&amp;x %% 2 ; odd ; {y}}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; odd</span></span>
<span><span class="co">#&gt; b</span></span>
<span><span class="co">#&gt; odd</span></span>
<span><span class="co">#&gt; d</span></span></code></pre></div>
<p>In that example, when x is odd, it is replaced with
<code>"odd"</code>, and when even it is replaced with the elements of
y.</p>
<p>Using the two ampersands operator (<code>&amp;&amp;</code>) is like
the simple ampersand version but the default for <code>verb_false</code>
is the variable used in the condition itself. So the syntax is
<code>{&amp;&amp;cond ; verb_true}</code> and <em>it does not
accept</em> <code>verb_false</code>.</p>
<p>Ex.3: let’s write the integer <code>i</code> in letters when equal to
3 only.</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">i</span> <span class="op">=</span> <span class="fl">3</span> </span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"i = {&amp;&amp;i == 3 ; three}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; i = three</span></span>
<span></span>
<span><span class="va">i</span> <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"i = {&amp;&amp;i == 3 ; three}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; i = 5</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="sec_pluralization">Special interpolation: Pluralization<a class="anchor" aria-label="anchor" href="#sec_pluralization"></a>
</h2>
<p>There is advanced support for pluralization which greatly facilitates
the writing of messages in natural language.</p>
<div class="section level3">
<h3 id="pluralization-principles">Pluralization: Principles<a class="anchor" aria-label="anchor" href="#pluralization-principles"></a>
</h3>
<p>There are two ways to pluralize: over length or over value. To
trigger a “pluralization” interpolation use as first character:</p>
<ul>
<li>
<code>$</code> to pluralize over the length of a variable (see
Ex.2)</li>
<li>
<code>#</code> to pluralize over the value of a variable (see
Ex.1)</li>
</ul>
<p>Ex.1: we add an ending ‘s’ based on a number.</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"I bought {N?x} book{#s}."</span><span class="op">)</span></span>
<span><span class="co">#&gt; I bought five books.</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"I bought {N?x} book{#s}."</span><span class="op">)</span></span>
<span><span class="co">#&gt; I bought one book.</span></span></code></pre></div>
<p>The syntax is <code>{#plural_ops ? variable}</code> or
<code>{#plural_ops}</code> where <code>plural_ops</code> are specific
pluralization operations which will be described below. The
pluralization is perfomed <em>always</em> with respect to the value of a
variable.</p>
<p>You can either add the variable explicitly
(<code>{#plural_ops ? variable}</code>) or refer to it implicitly
(<code>{#plural_ops}</code>). If implicit, then the algorithm will look
at the previous variable that was interpolated and pluralize over it.
This is exaclty what happens in Ex.1 where <code>x</code> was
interpolated in <code>{N?x}</code> and the plural operation
<code>s</code> (in <code>{#s}</code>) applies to <code>x</code>. It
would have been equivalent to have <code>{#s ? x}</code>. If a variable
wasn’t interpolated before, then the next interpolated variable will be
used (see Ex.2). If no variable is interpolated at all, an error is
thrown.</p>
<p>Ex.2: we add an ending ‘s’ and conjugate the verb ‘be’ based on the
length of a vector.</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"J."</span>, <span class="st">"M."</span><span class="op">)</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"My BFF{$s, are} {C?x}!"</span><span class="op">)</span></span>
<span><span class="co">#&gt; My BFFs are J. and M.!</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">=</span> <span class="st">"J."</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"My BFF{$s, are} {C?x}!"</span><span class="op">)</span></span>
<span><span class="co">#&gt; My BFF is J.!</span></span></code></pre></div>
<p>As you can notice in Ex.2, you can chain operations. In that case a
whitespace is automatically added between them.</p>
<p>Now let’s come to the specific pluralization operations, which are
different from regular operations.</p>
</div>
<div class="section level3">
<h3 id="pluralization-regular-operations">Pluralization: Regular operations<a class="anchor" aria-label="anchor" href="#pluralization-regular-operations"></a>
</h3>
<div class="section level4">
<h4 id="s-es">s, es<a class="anchor" aria-label="anchor" href="#s-es"></a>
</h4>
<p>Adds an <code>"s"</code> (or <code>"es"</code>) if it is plural (&gt;
1), nothing otherwise. Accepts the option <code>0</code> or
<code>zero</code> which treats a 0-length or a 0-value as plural.</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nfiles</span> <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"We've found {&amp;nfiles;{.};no} file{#s}."</span><span class="op">)</span></span>
<span><span class="co">#&gt; We've found 1 file.</span></span>
<span></span>
<span><span class="va">nfiles</span> <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"We've found {&amp;nfiles;{.};no} file{#s}."</span><span class="op">)</span></span>
<span><span class="co">#&gt; We've found no file.</span></span>
<span></span>
<span><span class="va">nfiles</span> <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"We've found {&amp;nfiles;{.};no} file{#s.0}."</span><span class="op">)</span></span>
<span><span class="co">#&gt; We've found no files.</span></span>
<span></span>
<span><span class="va">nfiles</span> <span class="op">=</span> <span class="fl">4</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"We've found {&amp;nfiles;{.};no} file{#s.0}."</span><span class="op">)</span></span>
<span><span class="co">#&gt; We've found 4 files.</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="y-or-ies">y or ies<a class="anchor" aria-label="anchor" href="#y-or-ies"></a>
</h4>
<p>Adds an ‘y’ if singular and ‘ies’ if plural (&gt;1). Accepts the
option <code>0</code> or <code>zero</code> which treats a 0-length or a
0-value as plural.</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ndir</span> <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"We've found {ndir} director{#y}."</span><span class="op">)</span></span>
<span><span class="co">#&gt; We've found 1 directory.</span></span>
<span></span>
<span><span class="va">ndir</span> <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"We've found {ndir} director{#y}."</span><span class="op">)</span></span>
<span><span class="co">#&gt; We've found 5 directories.</span></span>
<span></span>
<span><span class="va">ndir</span> <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"We've found {ndir} director{#ies}."</span><span class="op">)</span></span>
<span><span class="co">#&gt; We've found 1 directory.</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="enum-1">enum<a class="anchor" aria-label="anchor" href="#enum-1"></a>
</h4>
<p>Enumerates the elements (see help for the regular operation
<code>enum</code>).</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fruits</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"apples"</span>, <span class="st">"oranges"</span><span class="op">)</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"The fruit{$s ? fruits} I love {$are, enum}."</span><span class="op">)</span></span>
<span><span class="co">#&gt; The fruits I love are apples and oranges.</span></span>
<span></span>
<span><span class="va">fruits</span> <span class="op">=</span> <span class="st">"apples"</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"The fruit{$s ? fruits} I love {$are, enum}."</span><span class="op">)</span></span>
<span><span class="co">#&gt; The fruit I love is apples.</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="n-n-len-len">n, N, len, Len<a class="anchor" aria-label="anchor" href="#n-n-len-len"></a>
</h4>
<p>Add the number of elements (<code>"len"</code>) or the value
(<code>"n"</code>) of the variable as a formatted number or in letters
(upper case versions). Accepts the options <code>letter</code> (to write
in letter) and <code>upper</code> (to uppercase the first letter).</p>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nfiles</span> <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{#N.upper ? nfiles} file{#s, are} compromised."</span><span class="op">)</span></span>
<span><span class="co">#&gt; Five files are compromised.</span></span>
<span></span>
<span><span class="va">nfiles</span> <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{#N.upper ? nfiles} file{#s, are} compromised."</span><span class="op">)</span></span>
<span><span class="co">#&gt; One file is compromised.</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="nth-ntimes">nth, ntimes<a class="anchor" aria-label="anchor" href="#nth-ntimes"></a>
</h4>
<p>Writes the value of the variable as an order (nth) or a frequence
(ntimes). Accepts the option <code>letter</code> to write the numbers in
letters (uppercase version of the operator does the same).</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Writing the same sentence {#Ntimes ? n} is unnecessary."</span><span class="op">)</span></span>
<span><span class="co">#&gt; Writing the same sentence twice is unnecessary.</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="is-or-any-verb">is, or any verb<a class="anchor" aria-label="anchor" href="#is-or-any-verb"></a>
</h4>
<p>Conjugates any English verb appropriately depending on context. Any
command that is not recognized as one of the commands previously
described is treated as a verb.</p>
<p>Simply add an upper case first to upper case the conjugated verb.</p>
<p>Multiple verbs are illustrated in the example below. It also
anticipaed the conditional statements described in the next section.</p>
<p>Ex.3: multiple verbs and conditional statements.</p>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pple</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Francis"</span>, <span class="st">"Henry"</span><span class="op">)</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{$enum, is, (a;) ? pple} tall guy{$s}."</span>,</span>
<span>        <span class="st">"{$(He;They), like} to eat donuts."</span>,</span>
<span>        <span class="st">"When happy, at the pub {$(he;they), goes}!"</span>,</span>
<span>        <span class="st">"{$Don't, (he;they)} have wit, {$(he;they)} who {$try}?"</span>, .sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Francis and Henry are tall guys.</span></span>
<span><span class="co">#&gt; They like to eat donuts.</span></span>
<span><span class="co">#&gt; When happy, at the pub they go!</span></span>
<span><span class="co">#&gt; Don't they have wit, they who try?</span></span>
<span></span>
<span><span class="va">pple</span> <span class="op">=</span> <span class="st">"Francis"</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{$enum, is, (a;) ? pple} tall guy{$s}."</span>,</span>
<span>        <span class="st">"{$(He;They), like} to eat donuts."</span>,</span>
<span>        <span class="st">"When happy, at the pub {$(he;they), goes}!"</span>,</span>
<span>        <span class="st">"{$Don't, (he;they)} have wit, {$(he;they)} who {$try}?"</span>, .sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Francis is a tall guy.</span></span>
<span><span class="co">#&gt; He likes to eat donuts.</span></span>
<span><span class="co">#&gt; When happy, at the pub he goes!</span></span>
<span><span class="co">#&gt; Doesn't he have wit, he who tries?</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="pluralization-conditional-statements">Pluralization: Conditional statements<a class="anchor" aria-label="anchor" href="#pluralization-conditional-statements"></a>
</h3>
<p>On top of the previous operations, there is a special operation
allowing to add verbatim text depending on the situation. The syntax is
as follows:</p>
<ul>
<li>
<code>(s1;s2)</code>: adds verbatim ‘s1’ if singular and ‘s2’ if
plural (&gt;1)</li>
<li>
<code>(s1;s2;s3)</code>: adds verbatim ‘s1’ if zero, ‘s2’ if
singular (=1) and ‘s3’ if plural</li>
<li>
<code>(s1;;s3)</code>: adds verbatim ‘s1’ if zero, ‘s3’ if singular
or plural (i.e. &gt;=1)</li>
</ul>
<p>These case-dependent verbatim values <strong>are
interpolated</strong> (if appropriate). In these interpolations you need
not refer explicitly to the variable for pluralization
interpolations.</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{#(Sorry, nothing found.;;{#N.upper} match{#es, were} found.)?x}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Sorry, nothing found.</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{#(Sorry, nothing found.;;{#N.upper} match{#es, were} found.)?x}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; One match was found.</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{#(Sorry, nothing found.;;{#N.upper} match{#es, were} found.)?x}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Three matches were found.</span></span></code></pre></div>
<p>For more example of conditional statements, see Ex.3 described in
verb operations.</p>
</div>
</div>
<div class="section level2">
<h2 id="sec_special_cases">Escaping and special cases<a class="anchor" aria-label="anchor" href="#sec_special_cases"></a>
</h2>
<p>The opening and closing brakets, <code><a href="https://rdrr.io/r/base/Paren.html" class="external-link">{}</a></code>, are special
characters and cannot be used as regular text. To bypass their special
meaning, you need to escape them with a double backslash.</p>
<p>You only need to escape the special delimiters which the algorithm is
currently looking for. In the examples below, you don’t need to escape
the closing bracket in Ex.1 since no box was open. On the other hand,
you need to escape it in Ex.2.</p>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the closing bracket does not have a special meaning since no open bracket</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"open = \\{, close = }"</span><span class="op">)</span></span>
<span><span class="co">#&gt; open = {, close = }</span></span>
<span></span>
<span><span class="co"># we need to escape the first closing bracket</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"many {5 times.c ! \\}}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; many }}}}}</span></span></code></pre></div>
<p>Alternatively, use the argument <code>.delim</code> to change the
delimiters.</p>
<p>Ex.3: changing the delimiter.</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Here I {interpolate} with .[this] "</span>, .delim <span class="op">=</span> <span class="st">".[ ]"</span>, this <span class="op">=</span> <span class="st">".[]"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Here I {interpolate} with .[]</span></span></code></pre></div>
<p>You can also use the following hack: Ex.4: using regular
interpolation to pass verbatim text.</p>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"I {'can {write} {{what}} I want'}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; I can {write} {{what}} I want</span></span></code></pre></div>
<p>Since <code>{expr}</code> evaluates <code>expr</code>, the stuff
inside the <em>box</em>, you can pass a character string and it will
stay untouched.</p>
<p>In the few operations expecting a semi-colon (if-else and
pluralization), it can also be escaped with a double backslash.</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">is_c</span> <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{&amp;is_c ; int i =1\\; ; i = 1}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; int i =1;</span></span>
<span></span>
<span><span class="va">is_c</span> <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{&amp;is_c ; int i =1\\; ; i = 1}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; i = 1</span></span></code></pre></div>
<p>In interpolations, the exclamation mark (<code>!</code>) signals a
verbatim expression. But what if you use it to mean the logical
operation <em>not</em> in an operation-free interpolation? In that case,
you need a hack: use a question mark (<code>?</code>) first to indicate
to the algorithm that you want to evaluate the expression.</p>
<p>Ex.4: using the <code>?</code> hack to use <code>!</code> as a
logical operation.</p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{!TRUE} is {?!TRUE}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; TRUE is FALSE</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="sec_creation">Creating your own operations<a class="anchor" aria-label="anchor" href="#sec_creation"></a>
</h2>
<p>You can add any arbitraty operation to <code>smagic</code>. You only
need to use the function <code>smagic_register</code>.</p>
<p>First you need to create a function that will be applied to a
character vector. That function must have at least the arguments ‘x’ and
‘…’. Additionnaly, it can have the arguments: ‘argument’, ‘options’,
‘group’, ‘group_flag’.</p>
<p>Second, this function must return a vector or a list of two items:
<code>x</code> and <code>group</code>. The latter form is only used in
functions modifying the length or order of the vector.</p>
<p>Finally, you need to register the function with
<code>smagic_register</code> and provide it an alias. Optionnally, you
can provide a list of valid options.</p>
<p>Ex.1: a new operation adding markdown emphasis.</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># A) define the function</span></span>
<span><span class="va">fun_emph</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"*"</span>, <span class="va">x</span>, <span class="st">"*"</span><span class="op">)</span></span>
<span> </span>
<span><span class="co"># B) register it</span></span>
<span><span class="fu">smagic_register</span><span class="op">(</span><span class="va">fun_emph</span>, <span class="st">"emph"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># C) use it</span></span>
<span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="../reference/str_vec.html">str_vec</a></span><span class="op">(</span><span class="st">"right, now"</span><span class="op">)</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Take heed, {emph, c? x}."</span><span class="op">)</span></span>
<span><span class="co">#&gt; Take heed, *right* *now*.</span></span></code></pre></div>
<p>Above, we have created a simple functon that adds markdown emphasis
to words.</p>
<p>More generally, the function taken by <code>smagic_register</code> is
called internally by <code>smagic</code> in the form
<code>fun(x, argument, options, group, group_flag)</code>. Here is the
meaning of the arguments:</p>
<ul>
<li>
<code>x</code>: the value to which the operation applies.</li>
<li>
<code>argument</code>: the quoted <code>smagic</code> argument
(always character).</li>
<li>
<code>options</code>: a character vector of <code>smagic</code>
options.</li>
<li>
<code>group</code>: an index of the group to which belongs each
observation (integer).</li>
<li>
<code>group_flag</code>: value between 0 and 2; 0: no grouping
operation requested; 1: keep track of groups; 2: apply grouping.</li>
</ul>
<p>The two last arguments, <code>group</code> and
<code>group_flag</code>, are of use only in group-wise operations only
if <code>fun</code> changes the length or the order of vectors.</p>
<p>Let’s add an argument and an option to the <code>"emph"</code>
operation that we defined in Ex.1.</p>
<p>Ex.2: new operation with argument and option.</p>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fun_emph</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">argument</span>, <span class="va">options</span>, <span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">arg</span> <span class="op">=</span> <span class="va">argument</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">arg</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="va">arg</span> <span class="op">=</span> <span class="st">"*"</span></span>
<span>  </span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="st">"strong"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">options</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">arg</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">arg</span>, <span class="fl">3</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">arg</span>, <span class="va">x</span>, <span class="va">arg</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">smagic_register</span><span class="op">(</span><span class="va">fun_emph</span>, <span class="st">"emph"</span>, <span class="st">"strong"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="../reference/str_vec.html">str_vec</a></span><span class="op">(</span><span class="st">"right, now"</span><span class="op">)</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Take heed, {'_'emph.s, c? x}."</span><span class="op">)</span></span>
<span><span class="co">#&gt; Take heed, ___right___ ___now___.</span></span>
<span></span>
<span><span class="co"># In smagic_register, the valid_option argument is used to validate them.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Take heed, {'_'emph.aaa, c? x}."</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error : in smagic("Take heed, {'_'emph.aaa, c? x}."): </span></span>
<span><span class="co">#&gt; CONTEXT: Problem found in "Take heed, {'_'emph.aaa, c? x}.",</span></span>
<span><span class="co">#&gt;          when dealing with the interpolation `{'_'emph.aaa, c? x}`. See</span></span>
<span><span class="co">#&gt;          error below:</span></span>
<span><span class="co">#&gt; The option `aaa` is not valid for the current operation.</span></span>
<span><span class="co">#&gt; FYI the option available is `strong`.</span></span></code></pre></div>
<p>Finally let’s illustrate an example with group-wise axareness.</p>
<p>Ex.3: we create a function that only keeps variable names (ex: x5,
is_num, etc).</p>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">keep_varnames</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">group</span>, <span class="va">group_flag</span>, <span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">is_ok</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^[[:alpha:].][[:alnum:]._]*$"</span>, <span class="va">x</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">group_flag</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">group</span> <span class="op">=</span> <span class="va">group</span><span class="op">[</span><span class="va">is_ok</span><span class="op">]</span></span>
<span>    <span class="va">group</span> <span class="op">=</span> <span class="fu">stringmagic</span><span class="fu">:::</span><span class="fu">cpp_recreate_index</span><span class="op">(</span><span class="va">group</span><span class="op">)</span></span>
<span>  <span class="op">}</span> </span>
<span>  </span>
<span>  <span class="va">res</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="va">is_ok</span><span class="op">]</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">smagic_register</span><span class="op">(</span><span class="va">keep_varnames</span>, <span class="st">"keepvar"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">expr</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x1 + 52"</span>, <span class="st">"73 %% 5 == x"</span>, <span class="st">"y[y &gt; .z_5]"</span><span class="op">)</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"All vars: {'[^[:alnum:]_.]+'s, keepvar, unik, bq, C ? expr}."</span><span class="op">)</span></span>
<span><span class="co">#&gt; All vars: `x1`, `x`, `y` and `.z_5`.</span></span>
<span></span>
<span><span class="co"># thanks to the group flag, we can apply group-wise operations</span></span>
<span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Vars in each expr:\n"</span>,</span>
<span>        <span class="st">"{'\n'c ! - {1:3}) {'[^[:alnum:]_.]+'s, keepvar, bq, ~(unik, C) ? expr}}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Vars in each expr:</span></span>
<span><span class="co">#&gt; - 1) `x1`</span></span>
<span><span class="co">#&gt; - 2) `x`</span></span>
<span><span class="co">#&gt; - 3) `y` and `.z_5`</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Laurent R Berge.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
