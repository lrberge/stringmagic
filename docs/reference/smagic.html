<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>String interpolation with operation chaining — smagic • stringmagic</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="String interpolation with operation chaining — smagic"><meta property="og:description" content="This is firstly a string interpolation tool. On top of this it can apply, and chain, over 50
basic string operations to the interpolated variables. Advanced support for pluralization."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">stringmagic</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li class="divider">
    <li class="dropdown-header">Guides</li>
    <li>
      <a href="../articles/guide_smagic.html">`stringmagic`: A quick tour</a>
    </li>
    <li>
      <a href="../articles/guide_string_tools.html">String tools: magic edition</a>
    </li>
    <li>
      <a href="../articles/guide_customization.html">Tailor-made functions and operations</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">References</li>
    <li>
      <a href="../articles/ref_smagic.html">`smagic`: Magical string interpolation</a>
    </li>
    <li>
      <a href="../articles/ref_operations.html">`smagic`'s operations: The reference</a>
    </li>
    <li>
      <a href="../articles/ref_regex_flags.html">Regular expression flags</a>
    </li>
    <li>
      <a href="../articles/ref_regex_logic.html">Regular expression logic</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/lrberge/stringmagic/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>String interpolation with operation chaining</h1>
    <small class="dont-index">Source: <a href="https://github.com/lrberge/stringmagic/blob/HEAD/R/smagic_doc.R" class="external-link"><code>R/smagic_doc.R</code></a>, <a href="https://github.com/lrberge/stringmagic/blob/HEAD/R/smagic_main.R" class="external-link"><code>R/smagic_main.R</code></a></small>
    <div class="hidden name"><code>smagic.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This is firstly a string interpolation tool. On top of this it can apply, and chain, over 50
basic string operations to the interpolated variables. Advanced support for pluralization.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">smagic</span><span class="op">(</span></span>
<span>  <span class="va">...</span>,</span>
<span>  .envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  .sep <span class="op">=</span> <span class="st">""</span>,</span>
<span>  .vectorize <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  .delim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"{"</span>, <span class="st">"}"</span><span class="op">)</span>,</span>
<span>  .last <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .post <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .collapse <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .invisible <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  .default <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .check <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  .class <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .help <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .namespace <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">.smagic</span><span class="op">(</span></span>
<span>  <span class="va">...</span>,</span>
<span>  .envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  .sep <span class="op">=</span> <span class="st">""</span>,</span>
<span>  .vectorize <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  .delim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"{"</span>, <span class="st">"}"</span><span class="op">)</span>,</span>
<span>  .collapse <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .last <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .namespace <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>...</dt>
<dd><p>Character scalars that will be collapsed with the argument <code>sep</code>. Note that
named arguments are used for substitution.</p>
<p>To interpolate, you can
use <code>"{x}"</code> within each character string to insert the value of <code>x</code> in the string.
You can add string operations in each <code>"{}"</code> instance with the syntax <code>"'arg'op ? x"</code>
(resp. <code>"'arg'op ! x"</code>) to apply the operation <code>'op'</code> with the argument <code>'arg'</code> to <code>x</code>
(resp. the verbatim of <code>x</code>). Otherwise, what to say? Ah, nesting is enabled, and since
there's over 50 operators, it's a bit complicated to sort you out in this small space.</p>
<p>Use the argument <code>.help = "keyword"</code> (or <code>.help = TRUE</code>) to obtain a selective help
from the main documentation.</p>
<p>Note that in interpolations you have access to the special variables: <code>.now</code> and <code>.date</code>
to get the current time; and the special function <code>.now("format")</code> to
format the time. Ex: <code>.now('%Y-%m %H:%m')</code>.</p></dd>


<dt>.envir</dt>
<dd><p>An environment used to evaluate the variables in <code>"{}"</code>. By default the variables are
evaluated using the environment from where the function is called or using the named
arguments passed to the function.</p></dd>


<dt>.sep</dt>
<dd><p>Character scalar, default is the empty string <code>""</code>. It is used to collapse all
the elements in <code>...</code> before applying any operation.</p></dd>


<dt>.vectorize</dt>
<dd><p>Logical scalar, default is <code>FALSE</code>. If <code>TRUE</code>, Further, elements in <code>...</code> are
NOT collapsed together, but instead vectorised.</p></dd>


<dt>.delim</dt>
<dd><p>Character vector of length 1 or 2. Default is <code>c("{", "}")</code>. Defines
the opening and the closing delimiters for interpolation.</p>
<p>If of length 1, it must be of the form: 1) the opening delimiter,
2) a single space, 3) the closing delimiter. Ex: <code>".[ ]"</code> is equivalent to <code>c(".[", "]")</code>.
The default value is equivalent to <code>"{ }"</code>.</p>
<p>[ ]: R:%20
[", "]: R:%22,%20%22</p></dd>


<dt>.last</dt>
<dd><p>Character scalar, a function, or <code>NULL</code> (default). If provided and character:
it must be an <code>smagic</code> chain of operations of the form <code>"'arg1'op1, op2, etc"</code>. All these operations
are applied just before returning the vector. If a function,
it will be applied to the resulting vector.</p></dd>


<dt>.post</dt>
<dd><p>Function or <code>NULL</code> (default). If not <code>NULL</code>, this function will be applied
after all the processing, just before returning the object. This function can have
extra arguments which will be caught directly in the <code>...</code> argument of <code>smagic</code>.
For example if <code>.post = head</code>, you can directly pass the argument <code>n = 3</code> to <code>smagic</code>'s arguments.</p></dd>


<dt>.collapse</dt>
<dd><p>Character scalar, default is <code>NULL</code>. If provided, the character vector
that should be returned is collapsed with the value of this argument. This leads
to return a string of length 1.</p></dd>


<dt>.invisible</dt>
<dd><p>Logical scalar, default is <code>FALSE</code>. Whether the object returned should be
invisible (i.e. not printed on the console).</p></dd>


<dt>.default</dt>
<dd><p>Character scalar or <code>NULL</code> (default). If provided, it must be
a sequence of <code>smagic</code> operations. It will be applied as a default to any interpolation.
Ex: if <code>x = 1:2</code>, then <code>smagic("x = {x}", .default = "enum")</code> leads to "x = 1 and 2",
and is equivalent to <code>smagic("x = {enum?x}")</code>. Note that this default operations does
not apply to nested expressions. That is <code>smagic("{!x{1:2}}", .default = "enum")</code> leads
to <code>c("x1", "x2")</code> and NOT <code>"x1 and 2"</code>.</p></dd>


<dt>.check</dt>
<dd><p>Logical scalar, default is <code>TRUE</code>. Whether to enable error-handling (i.e.
human readable error messages).
Without error-handling you can save something of the order of 40us. Useful only
in long loops.</p></dd>


<dt>.class</dt>
<dd><p>Character vector representing the class to give to the object returned.
By default it is <code>NULL</code>. Note that the class <code>smagic</code> has a specific <code>print</code> method, usually
nicer for small vectors (it <code><a href="https://rdrr.io/r/base/cat.html" class="external-link">base::cat()</a></code>s the elements).</p></dd>


<dt>.help</dt>
<dd><p>Character scalar or <code>TRUE</code>, default is <code>NULL</code>. This argument
is used to generate a dynamic help on the console. If <code>TRUE</code>, the user can select which
topic to read from the main documentation, with the possibility to search for keywords and
navigate the help pages. If a character scalar, then a regex search is perfomed on the main
documentation and any section containining a match is displayed. The user can easily
navigate across matches.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>It returns a character vector whose length depends on the elements and operations in the interpolations.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>There are over 50 basic string operations, it supports pluralization, string operations can be
nested, operations can be applied group-wise or conditionally and
operators have sensible defaults.
You can also declare your own operations with <code><a href="smagic_register_fun.html">smagic_register_fun()</a></code> or <code><a href="smagic_register_fun.html">smagic_register_ops()</a></code>.
They will be seamlessly integrated to <code>smagic</code>.</p>
<p>The function <code>.smagic</code> (prefixed with a dot) is a leaner version of the function <code>smagic</code>.
It does the same operations but with the following differences:</p><ul><li><p>there is no error handling: meaning that the error messages, if any, will be poor and
hard to understand</p></li>
<li><p>default options are not applied: hence the user must always explicitly provide the arguments</p></li>
</ul><p>This leads to a faster processing time (of about 50 microseconds) at the cost of user experience.</p>
<p>If you want to change the default values of <code>smagic</code> (like changing the delimiter), use
the function <code><a href="smagic_alias.html">smagic_alias()</a></code>.</p>
<p>Use the argument <code>.help</code> to which
you can pass keywords or regular expressions and fecth select pieces from the main documentation.</p>
    </div>
    <div id="functions">
    <h2>Functions</h2>
    
<ul><li><p><code>smagic()</code>: String interpolation with operation chaining</p></li>
<li><p><code>.smagic()</code>: A simpler version of <code>smagic</code> without any error handling to save a few micro seconds</p></li>
</ul></div>
    <div id="interpolation-and-string-operations">
    <h2>Interpolation and string operations</h2>
    <p>Principle:</p>
<p>To interpolate a variable, say <code>x</code>, simply use <code>{x}</code>. For example <code>x = "world"; smagic("hello {x}")</code> leads
to "hello world".</p>
<p>To any interpolation you can add operations. Taking the previous example, say we want to display
"hello W O R L D". This means upper casing all letters of the interpolated variable and adding a space between
each of them. Do you think we can do that? Of course yes: smagic("hello upper, ''s, c ? x"). And that's it.</p>
<p>Now let's explain what happened. Within the <code><a href="https://rdrr.io/r/base/Paren.html" class="external-link">{}</a></code> <em>box</em>, we first write a set of
operations, here "upper, ''s, c", then add "?" and finally write
the variable to interpolate, "x".  The operations (explained in more details
below) are <code>upper</code>, upper-casing all letters, ''s: splitting
with the empty string, 'c': concatenating with spaces the vector of string that was just split.
The question mark means that the expression coming after it is to be evaluated
(this is opposed to the exclamation mark presented next).</p>
<p>The syntax is always the same: operations ? expression, where the operations section
is a <em>comma separated</em> list of operations.
These operations are of the form <code>'arg'op</code>, with <code>arg</code> the argument to the operator
code <code>op</code>. These operations are performed sequantially from left to right.</p>
<p>Some operations, like <code>upper</code>, accept options. You attach options to an operation
with a dot followed by the option name. Formally: <code>op.option1.option2</code>, etc.
Example: <code>x = "hi there. what's up? fine." ; smagic("He said: {upper.sentence, Q ? x}")</code>.
Leads to: <code>He said: "Hi there. What's up? Fine."</code>.</p>
<p>Both operators and options are partially matched. So <code>smagic("He said: {up.s, Q ? x}")</code> would
also work.</p>
    </div>
    <div id="verbatim-interpolation-and-nesting">
    <h2>Verbatim interpolation and nesting</h2>
    <p>Principle:</p>
<p>Instead of interpolating a variable, say <code>x</code>, with <code>{x}</code>, you can use an exclamation
mark to trigger varbatim evaluation.
For example <code>smagic("hello {!x}")</code> would lead to "hello x". It's a
bit disappointing, right? What's the point of doing that? Wait until the next two paragraphs.</p>
<p>Verbatim evaluation is a powerful way to apply operations to plain text. For example:
<code>smagic("hello {upper, ''s, c ! world}")</code> leads to "hello W O R L D".</p>
<p>(A note in passing. The spaces surrounding the exclamation mark are non necessary,
but when one space is present on both sides of the <code>!</code>, then the verbatim
expression only begins after it. Ex: "upper! hi" leads to " HI" while <code>"{upper ! hi}"</code>
leads to "HI" and <code>"{upper !  hi}"</code> leads to " HI".)</p>
<p>The second advantage of verbatim evaluations is <em>nesting</em>. Anything in a verbatim
expression is evaluated with the function <code>smagic</code>.
This means that any <em>box</em> will be evaluated as previously described. Let's
give an example. You want to write the expression of a polynomial of order n: a + bx + cx^2 + etc.
You can do that with nesting. Assume we have <code>n = 2</code>.</p>
<p>Then <code>smagic("poly({n}): {' + 'c ! {letters[1 + 0:n]}x^{0:n}}")</code> leads to
"poly(2): ax^0 + bx^1 + cx^2".</p>
<p>How does it work? The verbatim expression (the one following the exclamation mark),
here <code>"{letters[1 + 0:n]}x^{0:n}"</code>, is evaluated with <code>smagic</code>.
<code>smagic("{letters[1 + 0:n]}x^{0:n}")</code> leads to the vector c("ax^0", "bx^1", "cx^2").</p>
<p>The operation <code>' + 'c</code> then concatenates (or collapses) that vector with ' + '.
This value is then appended to the previous string.</p>
<p>We could refine by adding a cleaning operation in which we replace "x^0" and "^1"
by the empty string. Let's do it:</p>
<p><code>smagic("poly({n}): {' + 'c, 'x\\^0|\\^1'r ! {letters[1 + 0:n]}x^{0:n}}")</code> leads to
"poly(2): a + bx + cx^2", what we wanted.</p>
<p>You can try to write a function to express the polynomial as before: although it is
a simple task, my guess is that it will require more typing.</p>
    </div>
    <div id="operations">
    <h2>Operations</h2>
    <p>General syntax:</p>
<p>As seen in the previous sections, within a <em>box</em> (i.e. <code>"{}"</code>), multiple operations
can be performed.
We can do so by stacking the operations codes and in a comma separated enumeration.
Operations can have arguments, and operations can also have options. The general
syntax, with argument and options, is:</p>
<p><code>{'arg1'op1.optionA.optionB, arg2 op2.optionC, </code>arg3<code>op3, 51op4 ? x}</code></p>
<p>The argument can appear in four forms: a) inside single or double quotes just
before the operation name (<code>arg1</code> above),
b) verbatim, separated with a space, just before the operation name (<code>arg2</code> above),
c) inside bactick quotes the argument is evaluated from the environment (<code>arg3</code> above),
or d) when the argument is an integer it can be juxtaposed to the opeation name (like in <code>op4</code> above).</p>
<p>The options are always dot separated and attached to the operation name, they are
specific to each operation.</p>
<p>Both the operation name and the option names are partially matched.</p>
    </div>
    <div id="basic-string-operations">
    <h2>Basic string operations</h2>
    


<p>This section describes some of the most common string operations: extracting, replacing, collapsing, splitting, etc.
These functions accept generic flags ("ignore", "fixed", "word") in their patterns (syntax: "flags/pattern").
Please see the dedicated section for more information on flags.</p><ul><li><p>s, split, S, Split: splits the string according to a pattern.
The operations have different defaults: <code>' '</code>
for <code>s</code> and 'split', and <code>',[ \t\n]*'</code> for <code>S</code> and 'Split' (i.e. comma separation).
Ex.1: <code>smagic("{S ! romeo, juliet}")</code> leads to the vector c("romeo", "juliet").
Ex.2: <code>smagic("{'f/+'s, '-'c ! 5 + 2} = 3")</code> leads to "5 - 2 = 3" (note the flag "fixed" in <code>s</code>'s pattern).</p></li>
<li><p>c, C: to concatenate multiple strings into a single one. The two operations are
identical, only their default change. c: default is <code>' '</code>, C: default is <code>', | and '</code>.
The syntax of the argument is 's1' or 's1|s2'. s1 is the string used to concatenate
(think <code>paste(x, collapse = s1)</code>). In arguments of the form <code>'s1|s2'</code>, <code>s2</code> will be used to concatenate the last two elements.
Ex.1: <code>x = 1:4; smagic("Et {' et 'c ? x}!")</code> leads to "Et 1 et 2 et 3 et 4!".
Ex.2: <code>smagic("Choose: {', | or 'c ? 2:4}?")</code> leads to "Choose: 2, 3 or 4?".</p></li>
<li><p>x, X: extracts patterns from a string. Both have the same default: <code>'[[:alnum:]]+'</code>.
<code>x</code> extracts the first match while <code>X</code> extracts <strong>all</strong> the matches.
Ex.1: <code>x = c("6 feet under", "mahogany") ; smagic("{'\\w{3}'x ? x}")</code> leads to the vector c("fee", "mah").
Ex2.: <code>x = c("6 feet under", "mahogany") ; smagic("{'\\w{3}'X ? x}")</code> leads to the
vector c("fee", "und", "mah", "oga").</p></li>
<li><p>extract: extracts multiple patterns from a string, this is an alias to the operation <code>X</code> described above.
Use the option "first" to extract only the first match for each string (behavior becomes like <code>x</code>).
Ex: <code>x = c("margo: 32, 1m75", "luke doe: 27, 1m71") ; smagic("{'^\\w+'extract ? x} is {'\\d+'extract.first ? x}")</code>
leads to c("margo is 32", "luke is 27").</p></li>
<li><p>r, R: replacement within a string. The two operations are identical and have no default.
The syntax is <code>'old'</code> or <code>'old =&gt; new'</code> with <code>'old'</code> the pattern to find and <code>new</code> the replacement. If <code>new</code> is missing, it is
considered the empty string. This operation also accepts the flag "total" which instruct to
replace the fulll string in case the pattern is found.
Ex.1: <code>smagic("{'e'r ! Where is the letter e?}")</code> leads to "Whr is th lttr ?".
Ex.2: <code>smagic("{'(?&lt;!\\b)e =&gt; a'R ! Where is the letter e?}")</code> leads to "Whara is tha lattar e?".
Ex.3: <code>smagic("{'t/e =&gt; here'r ! Where is the letter e?}")</code> leads to "here".</p></li>
<li><p>clean: replacement with a string. Similar to the operation <code>r</code>, except that here the comma is
a pattern separator, see detailed explanations in <code><a href="string_clean.html">string_clean()</a></code>. Ex: <code>smagic("{'f/[, ]'clean ! x[a]}")</code>
leads to "xa".</p></li>
<li><p>get: restricts the string only to values respecting a pattern. This operation has no default.
Accepts the options "equal" and "in".
By default it uses the same syntax as <code><a href="string_get.html">string_get()</a></code> so that you can use regex flags and
include logical operations with <code>' &amp; '</code> and <code>' | '</code> to detect patterns.
If the option "equal" is used, a simple string equality with the argument is tested (hence
no flags are accepted). If the option "in" is used, the argument is first split with respect to commas
and then set inclusion is tested.
Example: <code>x = row.names(mtcars) ; smagic("Mercedes models: {'Merc &amp; [[:alpha:]]$'get, '^.+ 'r, C ? x}")</code>
leads to "Mercedes models: 240D, 280C, 450SE, 450SL and 450SLC".</p></li>
<li><p>is: detects if a pattern is present in a string, returns a logical vector. This operation has no default.
Accepts the options "equal" and "in".
By default it uses the same syntax as <code><a href="string_is.html">string_is()</a></code> so that you can use regex flags and
include logical operations with <code>' &amp; '</code> and <code>' | '</code> to detect patterns.
If the option "equal" is used, a simple string equality with the argument is tested (hence
no flags are accepted). If the option "in" is used, the argument is first split with respect to commas
and then set inclusion is tested.
Mostly useful as the final operation in a <code><a href="string_ops.html">string_ops()</a></code> call.
Example: <code>x = c("Mark", "Lucas") ; smagic("Mark? {'i/mark'is, C ? x}")</code> leads to "Mark? TRUE and FALSE".</p></li>
<li><p>which: returns the index of string containing a specified pattern. With no default, can be applied
to a logical vector directly.
By default it uses the same syntax as string_which() so that you can use regex flags and
include logical operations with <code>' &amp; '</code> and <code>' | '</code> to detect patterns.
If the option "equal" is used, a simple string equality with the argument is tested (hence
no flags are accepted). If the option "in" is used, the argument is first split with respect to commas
and then set inclusion is tested.
Mostly useful as the final operation in a <code><a href="string_ops.html">string_ops()</a></code> call.
Ex.1: <code>x = c("Mark", "Lucas") ; smagic("Mark is number {'i/mark'which ? x}.")</code> leads to
"Mark is number 1.".</p></li>
</ul></div>
    <div id="operations-changing-the-length-or-the-order">
    <h2>Operations changing the length or the order</h2>
    

<ul><li><p>first: keeps only the first <code>n</code> elements. Example: <code>smagic("First 3 numbers: {3 first, C ? mtcars$mpg}.")</code>
leads to "First 3 numbers: 21, 21 and 22.8.". Negative numbers as argument remove the
first <code>n</code> values. You can add a second argument in the form <code>'n1|n2'first</code> in which case the first <code>n1</code> and last
<code>n2</code> values are kept; <code>n1</code> and <code>n2</code> must be positive numbers.</p></li>
<li><p>K, Ko, KO: keeps only the first <code>n</code> elements; has more options than <code>first</code>. The syntax is <code>'n'K</code>,
<code>'n|s'K</code>, <code>'n||s'K</code>. The values Ko and KO only accept the two first syntax (with <code>n</code> only).
<code>n</code> provides the number of elements to keep. If <code>s</code> is provided and the number of
elements are greater than <code>n</code>, then in 'n|s' the string <code>s</code> is added at the end, and
if 'n||s' the string s replaces the nth element.
The string <code>s</code> accepts specials values:</p><ul><li><p><code>:n:</code> or <code>:N:</code> which gives the total number of items in digits or letters (N)</p></li>
<li><p><code>:rest:</code> or <code>:REST:</code> which gives the number of elements that have been truncated in digits or letters (REST)
Ex: <code>smagic("{'3|:rest: others'K ? 1:200}")</code> leads to the vector <code>c("1", "2", "3", "197 others")</code>.</p></li>
<li><p>The operator 'n'Ko is like <code>'n||:rest: others'K</code> and 'n'KO is like <code>'n||:REST: others'K</code>.</p></li>
</ul></li>
<li><p>last: keeps only the last <code>n</code> elements. Example: <code>smagic("Last 3 numbers: {3 last, C ? mtcars$mpg}.")</code>
leads to "Last 3 numbers: 19.7, 15 and 21.4.". Negative numbers as argument remove the
last <code>n</code> values.</p></li>
<li><p>sort: sorts the vector in increasing order. Accepts optional arguments and the option "num".
Example: <code>x = c("sort", "me") ; smagic("{sort, c ? x}")</code> leads to "me sort".
If an argument is provided, it must be a regex pattern that will be applied to
the vector using <code><a href="string_clean.html">string_clean()</a></code>. The sorting will be applied to the modified version of the vector
and the original vector will be ordered according to this sorting.
Ex: <code>x = c("Jon Snow", "Khal Drogo")</code>; <code>smagic("{'.+ 'sort, C?x}")</code> leads to
"Khal Drogo and Jon Snow". The option "num" sorts over a numeric version
(with silent conversion) of the vector and reorders the original vector accordingly.
Values which could not be converted are last.
<strong>Important note</strong>: the sorting operation is applied before any character conversion.
If previous operations were applied, it is likely that numeric data were transformed to character.
Note the difference: <code>x = c(20, 100, 10); smagic("{sort, ' + 'c ? x}")</code> leads to "10 + 20 + 100"
while <code>smagic("{n, sort, ' + 'c ? x}")</code> leads to "10 + 100 + 20" because the operation "n"
first transformed the numeric vector into character.</p></li>
<li><p>dsort: sorts the vector in decreasing order. It accepts an optional argument and
the option "num". Example: <code>smagic("5 = {dsort, ' + 'c ? 2:3}")</code>
leads to "5 = 3 + 2". See the operation "sort" for a description of the argument and the option.</p></li>
<li><p>rev: reverses the vector. Example: <code>smagic("{rev, ''c ? 1:3}")</code> leads to "321".</p></li>
<li><p>unik: makes the string vector unique. Example: <code>smagic("Iris species: {unik, C ? iris$Species}.")</code>
leads to "Iris species: setosa, versicolor and virginica.".</p></li>
<li><p>each: repeats each element of the vector <code>n</code> times. Option "c" then collapses the full vector
with the empty string as a separator. Ex.1: <code>smagic("{/x, y}{2 each ? 1:2}")</code> leads to the
vector <code>c("x1", "y1", "x2", "y2")</code>. Ex.2: <code>smagic("Large number: 1{5 each.c ! 0}")</code> leads to
"Large number: 100000".</p></li>
<li><p>times: repeats the vector sequence <code>n</code> times. Option "c" then collapses the full vector
with the empty string as a separator. Example: <code>smagic("What{6 times.c ! ?}")</code> leads to "What??????".</p></li>
<li><p>rm: removes elements from the vector. Options: "empty", "blank", "noalpha", "noalnum", "all".
The <em>optional</em> argument represents the pattern used to detect strings to be deleted.
Ex.1: <code>x = c("Luke", "Charles")</code>; <code>smagic("{'i/lu'rm ? x}")</code> leads to "charles". By default it removes
empty strings. Option "blank" removes strings containing only blank characters (spaces, tab, newline).
Option "noalpha" removes strings not containing letters. Option "noalnum" removes strings not
containing alpha numeric characters. Option "all" removes all strings (useful in conditions, see
the dedicated section). If an argument is provided, only the options "empty" and "blank" are available.
Ex.2: <code>x = c("I want to enter.", "Age?", "21")</code>; <code>smagic("Nightclub conversation: {rm.noalpha, c ! - {x}}")</code>
leads to "Nightclub conversation: - I want to enter. - Age?"</p></li>
<li><p>nuke: removes all elements, equivalent to <code>rm.all</code> but possibly more explicit (not sure).
Useful in conditions, see the dedicated section.
Example: <code>x = c(5, 7, 453, 647); smagic("Small numbers only: {if(.&gt;20 ; nuke), C ? x}")</code> leads
to "Small numbers only: 5 and 7";</p></li>
<li><p>insert: inserts a new element to the vector. Options: "right" and "both". Option "right" adds
the new element to the right. Option "both" inserts the new element on the two sides of the vector.
Example: <code>smagic("{'3'insert.right, ' + 'c ? 1:2}")</code> leads to "1 + 2 + 3".</p></li>
</ul></div>
    <div id="formatting-operations">
    <h2>Formatting operations</h2>
    

<ul><li><p>lower: lower cases the full string.</p></li>
<li><p>upper: upper cases the full string. Options: "first" and "sentence".
Option "first" upper cases only the first character. Option "sentence"
upper cases the first letter after punctuation.
Ex: <code>x = "hi. how are you? fine." ; smagic("{upper.sentence ? x}")</code> leads
to "Hi. How are you? Fine.".</p></li>
<li><p>title: applies a title case to the string. Options: "force" and "ignore".
Option "force" first puts everything to lowercase before applying the title case.
Option "ignore" ignores a few small prepositions ("a", "the", "of", etc).
Ex: <code>x = "bryan is in the KITCHEN" ; smagic("{title.force.ignore ? x}")</code> leads to "Bryan Is in the Kitchen".</p></li>
<li><p>ws: normalizes whitespaces (WS). It trims the whitespaces on the edges and transforms any succession
of whitespaces into a single one. Can also be used to further clean the string with its options.
Options: "punct", "digit", "isolated". Option "punct" cleans the punctuation. Option "digit" cleans digits.
Option "isolated" cleans isolated letters. WS normalization always come after any of these options.
<strong>Important note:</strong> punctuation (or digits) are replaced with WS and <strong>not</strong>
the empty string. This means that <code>smagic("ws.punct ! Meg's car")</code> will become "Meg s car".</p></li>
<li><p>trimws: trims the white spaces on both ends of the strings.</p></li>
<li><p>q, Q, bq: to add quotes to the strings. q: single quotes, Q: double quotes, bq:
back quotes. <code>x = c("Mark", "Pam"); smagic("Hello {q, C ? x}!")</code> leads to "Hello 'Mark' and 'Pam'!".</p></li>
<li><p>format, Format: applies the base R's function <code><a href="https://rdrr.io/r/base/format.html" class="external-link">base::format()</a></code> to the string.
By default, the values are left aligned, <em>even numbers</em> (differently from <code><a href="https://rdrr.io/r/base/format.html" class="external-link">base::format()</a></code>'s behavior).
The upper case command (<code>Format</code>) applies right alignment. Options: "0", "zero", "right", "center".
Options "0" or "zero" fills the blanks with 0s: useful to format numbers. Option "right" right aligns,
and "center" centers the strings.
Ex: <code>x = c(1, 12345); smagic("left: {format.0, q, C ? x}, right: {Format, q, C ? x}")</code>
leads to "left: '000001' and '12,345', right: '     1' and '12,345'".</p></li>
<li><p>%: applies <code><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">base::sprintf()</a></code> formatting. The syntax is 'arg'% with arg an sprintf formatting,
or directly the sprint formatting, e.g. <code>% 5s</code>. Example: <code>smagic("pi = {%.3f ? pi}")</code> leads
to "pi = 3.142".</p></li>
<li><p>stopwords: removes basic English stopwords (the snowball list is used).
The stopwords are replaced with an empty space but the left and right WS are
untouched. So WS normalization may be needed (see operation <code>ws</code>).
<code>x = c("He is tall", "He isn't young"); smagic("Is he {stop, ws, C ? x}?")</code> leads to "Is he tall and young?".</p></li>
<li><p>ascii: turns all letters into ASCII with transliteration. Failed translations
are transformed into question marks. Options: "silent", "utf8". By default, if some conversion fails
a warning is prompted. Option "silent" disables the warning in case of failed conversion. The conversion
is done with <code><a href="https://rdrr.io/r/base/iconv.html" class="external-link">base::iconv()</a></code>, option "utf8" indicates that the source endocing is UTF-8, can be useful
in some cases.</p></li>
<li><p>n: formats integers by adding a comma to separate thousands. Options: "letter", "upper", "0", "zero".
The option "letter" writes the number in letters (large numbers keep their numeric format). The option
"upper" is like the option "letter" but uppercases the first letter. Options "0" or "zero" left pads
numeric vectors with 0s. Ex.1: <code>x = 5; smagic("He's {N ? x} years old.")</code> leads to "He's five years old.".
Ex.2: <code>x = c(5, 12, 52123); smagic("She owes {n.0, '$'paste, C ? x}.")</code> leads to
"She owes $5, $12 and $52,123.".</p></li>
<li><p>N: same as <code>n</code> but automatically adds the option "letter".</p></li>
<li><p>nth: when applied to a number, these operators write them as a rank. Options: "letter",
"upper", "compact".
Ex.1: <code>n = c(3, 7); smagic("They finished {nth, enum ? n}!")</code> leads to "They finished 3rd and 7th!".
Option "letter" tries to write the numbers in letters, but note that it stops at 20. Option "upper"
is the same as "letter" but uppercases the first letter. Option "compact" aggregates
consecutive sequences in the form "start_n_th to end_n_th".
Ex.2: <code>smagic("They arrived {nth.compact ? 5:20}.")</code> leads to "They arrived 5th to 20th.".
Nth: same as <code>nth</code>, but automatically adds the option "letter". Example:
<code>n = c(3, 7); smagic("They finished {Nth, enum ? n}!")</code> leads to "They finished third and seventh!".</p></li>
<li><p>ntimes: write numbers in the form <code>n</code> times. Options: "letter", "upper". Option
"letter" writes the number in letters (up to 100). Option "upper" does the same as "letter"
and uppercases the first letter. Example: <code>smagic("They lost {C ! {ntimes ? c(1, 12)} against {S!Real, Barcelona}}.")</code>
leads to "They lost once against Real and 12 times against Barcelona.".</p></li>
<li><p>Ntimes: same as <code>ntimes</code> but automatically adds the option "letter".
Example: <code>x = 5; smagic("This paper was rejected {Ntimes ? x}...")</code> leads to
"This paper was rejected five times...".</p></li>
<li><p>firstchar, lastchar: to select the first/last characters of each element.
Ex: <code>smagic("{19 firstchar, 9 lastchar ! This is a very long sentence}")</code> leads to "very long".
Negative numbers remove the first/last characters.</p></li>
<li><p>k: to keep only the first n characters (like <code>firstchar</code> but with more options). The
argument can be of the form <code>'n'k</code>, <code>'n|s'k</code> or <code>'n||s'k</code> with <code>n</code> a number and <code>s</code> a string.
<code>n</code> provides the number of characters to keep. Optionnaly, only for strings whose
length is greater than <code>n</code>, after truncation, the string <code>s</code> can be appended at the end.
The difference between 'n|s' and 'n||s' is that in the second case the strings
will always be of maximum size <code>n</code>, while in the first case they can be of length <code>n + nchar(s)</code>.
Ex: <code>smagic("{4k ! long sentence}")</code> leads to "long",  <code>smagic("{'4|..'k ! long sentence}") </code>
leads to "long..", <code>smagic("{'4||..'k ! long sentence}")</code> leads to "lo..".</p></li>
<li><p>fill: fills the character strings up to a size. Options: "right", "center".
Accepts arguments of the form <code>'n'</code> or <code>'n|s'</code>, with <code>n</code> a number and <code>s</code> a symbol.
Default is left-alignment of the strings.
Option "right" right aligns and "center" centers the strings. When using <code>'n|s'</code>, the symbol <code>s</code>
is used for the filling. By default if no argument is provided, the
maximum size of the character string is used. See help for <code><a href="string_fill.html">string_fill()</a></code> for more information.
Ex.1: <code>smagic("Numbers: {'5|0'fill.right, C ? c(1, 55)}")</code> leads to "Numbers: 00001 and 00055".</p></li>
<li><p>paste: pastes some character to all elements of the string. This operation has no default.
Options: "both", "right", "front", "back", "delete". By default, a string is pasted on the left.
Option "right" pastes on the right and "both" pastes on both sides. Option "front" only
pastes on the first element while option "back" only pastes on the last element. Option "delete"
first replaces all elements with the empty string.
Example: <code>smagic("6 = {'|'paste.both, ' + 'c ? -3:-1}")</code> leads to "6 = |-3| + |-2| + |-1|".</p></li>
<li><p>join: joins lines ending with a double backslash. Ex: <code>x = "the sun \\\n is shining"</code>;
<code>smagic("{join ? x}")</code> leads to "the sun is shining".</p></li>
<li><p>escape: adds backslashes in front of specific characters. Options <code>"nl"</code>, <code>"tab"</code>.
Option <code>"nl"</code> escapes the newlines (<code>\n</code>), leading them to be displayed as <code>"\\\\n"</code>.
Option <code>"tab"</code> does the same for tabs (<code>"\t"</code>). This is useful to make the value free
of space formatters.
The default behavior is to escape both newlines and tabs.</p></li>
</ul></div>
    <div id="other-operations">
    <h2>Other operations</h2>
    

<ul><li><p>num: converts to numeric. Options: "warn", "soft", "rm", "clear". By default, the conversion
is performed silently and elements that failed to convert are turned into NA.
Option "warns" displays a warning if the conversion to numeric fails.
Option "soft" does not convert if the conversion of at least one element fails.
Option "rm" converts and removes the elements that could not be converted.
Option "clear" turns failed conversions into the empty string, and hence lead to a character vector.
Example: <code>x = c(5, "six"); smagic("Compare {num, C, q ? x} with {num.rm, C, q ? x}.")</code> leads to
"Compare '5 and NA' with '5'.", and <code>smagic("Compare {num.soft, C, q ? x} with {clear, C, q ? x}.")</code>
leads to "Compare '5 and six' with '5 and '.".</p></li>
<li><p>enum: enumerates the elements. It creates a single string containing the comma
separated list of elements.
If there are more than 7 elements, only the first 6 are shown and the number of
items left is written.
For example <code>smagic("enum ? 1:5")</code> leads to "1, 2, 3, 4, and 5".
You can add the following options by appending the letter to enum after a dot:</p><ul><li><p>q, Q, or bq: to quote the elements</p></li>
<li><p>or, nor: to finish with an 'or' (or 'nor') instead of an 'and'</p></li>
<li><p>i, I, a, A, 1: to enumerate with this prefix, like in: i) one, and ii) two</p></li>
<li><p>a number: to tell the number of items to display
Ex.1: <code>x = c("Marv", "Nancy"); smagic("The main characters are {enum ? x}.")</code> leads to
"The main characters are Marv and Nancy.".
Ex.2: <code>x = c("orange", "milk", "rice"); smagic("Shopping list: {enum.i.q ? x}.")</code> leads to
"Shopping list: i) 'orange', ii) 'milk', and iii) 'rice'."</p></li>
</ul></li>
<li><p>len: gives the length of the vector. Options "letter", "upper", "num".
Option "letter" writes the length in words (up to 100). Option "upper" is the same
as letter but uppercases the first letter.
By default, commas are added to separate thousands. Use uption "num" to preserve
a regular numeric format.
Example: <code>smagic("Size = {len ? 1:5000}")</code> leads to "Size = 5,000".</p></li>
<li><p>width: formats the string to fit a given width by cutting at word boundaries.
Accepts arguments of the form <code>'n'</code> or <code>'n|s'</code>, with <code>n</code> a number and <code>s</code> a string.
An argument of the form <code>'n|s'</code> will add <code>s</code> at the beginning of each line. Further,
by default a trailing white space is added to <code>s</code>; to remove this
behavior, add an underscore at the end of it.
The argument <code>n</code> is either
an integer giving the target character width (minimum is 15), or it can be a fraction expressing the
target size as a fraction of the current screen. Finally it can be an expression that
uses the variable <code>.sw</code> which will capture the value of the current screen width.
Ex.1: <code>smagic("{15 width ! this is a long sentence}")</code> leads to "this is a long\nsentence".
Ex.2: <code>smagic("{15 width.#&gt; ! this is a long sentence}")</code> leads to "#&gt; this is a long\n#&gt; sentence".</p></li>
<li><p>dtime: displays a formatted time difference. Option "silent" does not report a warning if the
operation fails. It accepts either objects of class <code>POSIXt</code> or <code>difftime</code>.
Example: <code>x = Sys.time() ; Sys.sleep(0.5) ; smagic("Time: {dtime ? x}")</code> leads to something
like "Time: 514ms".</p></li>
</ul></div>
    <div id="group-wise-operations">
    <h2>Group-wise operations</h2>
    


<p>In <code>smagic</code>, the splitting operation <code>s</code> (or <code>S</code>) keeps a memory of the strings
that were split. Use the tilde operator, of the form <code>~(op1, op2)</code>, to apply operations
group-wise, to each of the split strings.</p>
<p>Better with an example. <code>x = c("Oreste, Hermione", "Hermione, Pyrrhus", "Pyrrhus, Andromaque") ;</code>
<code>smagic("Troubles ahead: {S, ~(' loves 'c), C ? x}.")</code> leads to
"Troubles ahead: Oreste loves Hermione, Hermione loves Pyrrhus and Pyrrhus loves Andromaque.".</p>
<p>Almost all operations can be applied group-wise (although only operations changing the order or
the length of the strings really matter).</p>
    </div>
    <div id="conditional-operations">
    <h2>Conditional operations</h2>
    


<p>There are two operators to apply operations conditionally: <code>if</code> and <code>vif</code>, the latter
standing for <em>verbatim if</em>.</p>
<p>The syntax of <code>if</code> is <code>if(cond ; ops_true ; ops_false)</code> with <code>cond</code> a
condition (i.e. logical operation) on the value being interpolated, <code>ops_true</code> a comma-separated
sequence of operations if the condition is <code>TRUE</code> and <code>ops_false</code> an <em>optional</em> a sequence of
operations if the condition is <code>FALSE</code>.</p>
<p>Ex.1: Let's take a sentence, delete words of less than 4 characters, and trim
words of 7+ characters.
x = "Songe Cephise a cette nuit cruelle qui fut pour tout un peuple une nuit eternelle"
<code>smagic("{' 's, if(.nchar&lt;=4 ; nuke ; '7|..'k), c ? x}")</code>.
Let's break it down. First the sentence is split w.r.t. spaces, leading to a vector
of words. Then we use the special variable <code>.nchar</code> in <code>if</code>'s condition to refer
to the number of characters of the current vector (the words). The words with
less than 4 characters are nuked (i.e. removed), and the other words are
trimmed at 7 characters. Finally the modified vector of words is collapsed with
the function <code>c</code>, leading to the result.</p>
<p>The condition <code>cond</code> accepts the following special values: <code>.</code> (the dot), <code>.nchar</code>, <code>.C</code>, <code>.len</code>, <code>.N</code>.
The dot, <code>.</code>, refers to the current vector. <code>.nchar</code> represent the number of characters
of the current vector (equivalent to <code>nchar(.)</code>). <code>.C</code> is an alias to <code>.nchar</code>.
<code>.len</code> represent the length of the current vector (equivalent to <code>length(.)</code>).
<code>.N</code> is an alias to <code>.len</code>.</p>
<p>If a condition leads to a result of length 1, then the operations are applied to
the full string vector and not element-wise (as was the case in Ex.1). Contrary to element-wise conditions
for which operations modifying the length of the vectors are forbidden (apart from nuking),
such operations are fine in full-string conditions.</p>
<p>Ex.2: <code>x = smagic("x{1:10}")</code>; <code>smagic("y = {if(.N&gt;4 ; 3 first, '...'insert.right), ' + 'c ? x}")</code>
leads to "y = x1 + x2 + x3 + ...". the same opration applied to <code>x = smagic("x{1:4}")</code>
leads to "y = x1 + x2 + x3 + x4".</p>
<p>For <code>vif</code>, the syntax is <code>vif(cond ; verb_true ; verb_false)</code> with <code>verb_true</code>
a verbatim value with which the vector will be replaced if the condition is <code>TRUE</code>.
This is similar for <code>verb_false</code>. The condition works as in <code>if</code>.</p>
<p>Ex.3: <code>x = c(1, 25, 12, 6) ; smagic("Values: {vif(.&lt;10 ; &lt;10), C ? x}")</code> leads to
"Values: &lt;10, 25, 12 and &lt;10". As we can see values lower than 10 are replaced
with "&lt;10" while other values are not modified.</p>
<p>Ex.4: <code>x = smagic("x{1:10}")</code>; <code>smagic("y = {vif(.N&gt;4 ; {S!{x[1]}, ..., {last?x}}), ' + 'c ? x}")</code>
leads to "y = x1 + ... + x10".
Let's break it down. If the length of the vector is greater than 4 (here it's 10), then
the full string is replaced with <code>"{S!{x[1]}, ..., {last?x}}"</code>. Interpolation applies to
such string. Hence the split operation <code>S</code> breaks the string w.r.t.
the commas (default behavior), leading to the vector <code>c("{x[1]}", "...", "{last?x}")</code>. Since the
string contains curly brackets, interpolation is applied again. This leads to
the vector <code>c("x1", "...", "x10")</code>. Finally, this vector is collapsed with ' + ' leading
to the final string.
Note that there are many ways to get to the same result. Here is another example:
<code>smagic("y = {vif(.N&gt;4 ; {x[1]} + ... + {last?x} ; {' + 'c ? x}) ? x}")</code>.</p>
<p>The <code>vif</code> condition allows the use of '.' to refer to the current value in
<code>verb_true</code> and <code>verb_false</code>, as illustrated by the last example:</p>
<p>Ex.5: <code>smagic("{4 last, vif(. %% 2 ; x{.} ; y{rev?.}), C ? 1:11}")</code>
leads to "y10, x9, y8 and x11".</p>
    </div>
    <div id="special-interpolation">
    <h2>Special interpolation</h2>
    <p>if-else:</p>
<p>Using an ampersand ("&amp;") as the first character of an interpolation leads to an <em>if-else</em> operation.
Using two ampersands ("&amp;&amp;") leads to a slightly different operation described at the end of this section.</p>
<p>The syntax is as follows: <code>{&amp;cond ; verb_true ; verb_false}</code> with <code>cond</code> a
condition (i.e. logical operation) on the value being interpolated, <code>verb_true</code>
a verbatim value with which the vector will be replaced if the condition is <code>TRUE</code> and
<code>verb_false</code> an <em>optional</em> verbatim value with which the vector will be replaced if the condition is <code>FALSE</code>.
If not provided, <code>verb_false</code> is considered to be the empty string unless the operator is
the double ampersand described at the end of this section.</p>
<p>Note that in <code>cond</code>, you can use the function <code>len</code>, an alias to <code>length</code>.</p>
<p>Ex.1: <code>x = 1:5</code>; <code>smagic("x is {&amp;len(x)&lt;10 ; short ; {`log10(.N)-1`times, ''c ! very }long}")</code>
leads to "x is short". With <code>x = 1:50</code>, it leads to "x is long", and to "x is very very long"
if <code>x = 1:5000</code>.</p>
<p>If a condition leads to a result of length 1, the full string is replaced by the verbatim
expression. Further, this expression will be interpolated if requested. This was the case
in Ex.1 where <code>verb_false</code> was interpolated.</p>
<p>If the condition's length is greater than 1, then each logical values equal to <code>TRUE</code> is replaced
by <code>verb_true</code>, and <code>FALSE</code> or <code>NA</code> values are replaced with <code>verb_false</code>. Note,
importantly, that <strong>no interpolation is perfomed in that case</strong>.</p>
<p>Ex.2: <code>x = 1:3 ; smagic("x is {&amp;x == 2 ; two ; not two}")</code> leads to the vector
<code>c("x is not two", "x is two", "x is not two")</code>.</p>
<p>In that example, when x is odd, it is replaced with "odd", and when even it is
replaced with the elements of y.</p>
<p>Using the two ampersand operator ("&amp;&amp;") is like the simple ampersand version but the
default for <code>verb_false</code> is the variable used in the condition itself. So the syntax is
<code>{&amp;&amp;cond ; verb_true}</code> and <em>it does not accept</em> <code>verb_false</code>.</p>
<p>Ex.3: <code>i = 3 ; smagic("i = {&amp;&amp;i == 3 ; three}")</code> leads to "i = three", and to "i = 5" if <code>i = 5</code>.</p>
<p>Pluralization:</p>
<p>There is advanced support for pluralization which greatly facilitates the writing of messages
in natural language.</p>
<p>There are two ways to pluralize: over length or over value. To trigger a "pluralization" interpolation
use as first character:</p><ul><li><p><code>$</code> to pluralize over the length of a variable (see Ex.2)</p></li>
<li><p><code>#</code> to pluralize over the value of a variable (see Ex.1)</p></li>
</ul><p>Ex.1: <code>x = 5; smagic("I bought {N?x} book{#s}.")</code> leads to "I bought five books.".
If <code>x = 1</code>, this leads to "I bought one book.".</p>
<p>The syntax is <code>{#plural_ops ? variable}</code> or <code>{#plural_ops}</code> where <code>plural_ops</code> are
specific pluralization operations which will be described below.
The pluralization is perfomed <em>always</em> with respect to the value of a variable.
You can either add the variable explicitly (<code>{#plural_ops ? variable}</code>) or refer
to it implicitly (<code>{#plural_ops}</code>). If implicit, then the algorithm will look at the
previous variable that was interpolated and pluralize over it. This is exaclty what happens in
Ex.1 where <code>x</code> was interpolated in <code>{N?x}</code> and plural operation <code>s</code> in <code>{#s}</code> then applied to
<code>x</code>. It was equivalent to have <code>{#s ? x}</code>. If a variable wasn't interpolated before, then
the next interpolated variable will be used (see Ex.2). If no variable is interpolated
at all, an error is thrown.</p>
<p>Ex.2: <code>x = c("J.", "M."); smagic("My BFF{$s, are} {C?x}!")</code> leads to "My BFFs are J. and M.!".
If "x = "S.", this leads to "My BFF is S.!".</p>
<p>Pluralizing accepts the following operations:</p><ul><li><p>s, es: adds an "s" (or "es") if it is plural (&gt; 1), nothing otherwise. Accepts the option <code>0</code> or <code>zero</code> which
treats a 0-length or a 0-value as plural.</p></li>
<li><p>y or ies: adds an 'y' if singular and 'ies' if plural (&gt;1). Accepts the option <code>0</code> or <code>zero</code> which
treats a 0-length or a 0-value as plural.</p></li>
<li><p>enum: enumerates the elements (see help for the regular operation <code>enum</code>)</p></li>
<li><p>n, N, len, Len: add the number of elements ("len") or the value ("n") of the variable as a formatted number or
in letters (upper case versions). Accepts the options <code>letter</code> (to write in letter)
and <code>upper</code> (to uppercase the first letter).</p></li>
<li><p>nth, ntimes: writes the value of the variable as an order (nth) or a frequence (ntimes). Accepts the option <code>letter</code>
to write the numbers in letters (uppercase version of the operator does the same).</p></li>
<li><p>is, or any verb: conjugates the verb appropriately</p></li>
</ul><p>You can chain operations, in that case a whitespace is automatically added between them.</p>
<p>Ex.3: <code>x = c(7, 3, 18); smagic("The winning number{$s, is, enum ? sort(x)}.")</code>
leads to "The winning numbers are 3, 7 and 18.". With <code>x = 7</code> this leads to
"The winning number is 7.".</p>
<p>On top of the previous operations, there is a special operation allowing to add verbatim text depending on
the situation. The syntax is as follows:</p><ul><li><p><code>(s1;s2)</code>: adds verbatim 's1' if singular and 's2' if plural (&gt;1)</p></li>
<li><p><code>(s1;s2;s3)</code>: adds verbatim 's1' if zero, 's2' if singular (=1) and 's3' if plural</p></li>
<li><p><code>(s1;;s3)</code>: adds verbatim 's1' if zero, 's3' if singular or plural (i.e. &gt;=1)</p></li>
</ul><p>These case-dependent verbatim values <strong>are interpolated</strong> (if appropriate). In these interpolations
you need not refer explicitly to the variable for pluralization interpolations.</p>
<p>Ex.4: <code>x = 3; smagic("{#(Sorry, nothing found.;;{#N.upper} match{#es, were} found.)?x}")</code> leads to
"Three matches were found.". If "x = 1", this leads to "One match was found." and if "x = 0" this leads
to "Sorry, nothing found.".</p>
    </div>
    <div id="escaping-and-special-cases">
    <h2>Escaping and special cases</h2>
    


<p>The opening and closing brakets, <code><a href="https://rdrr.io/r/base/Paren.html" class="external-link">{}</a></code>, are special characters and cannot be used as regular text.
To bypass their special meaning, you need to escape them with a double backslash.</p>
<p>Ex.1: <code>smagic("open = \\\\{, close = }")</code> leads to <code>"open = {, close = }"</code>.
Ex.2: <code>smagic("many {5 times.c ! \\\\}}")</code> leads to <code>many }}}}}</code>.</p>
<p>You only need to escape the special delimiters which the algorithm is currently looking for.
As you can see, you don't need to escape the closing bracket in Ex.1 since no box
was open. On the other hand, you need to escape it in Ex.2.</p>
<p>Alternatively, use the argument <code>.delim</code> to set custom delimiters.</p>
<p>Ex.3: smagic("I 'can write what I want'") leads to <code>"I can {write} {{what}} I want"</code>.</p>
<p>Since <code>{expr}</code> evaluates <code>expr</code>, the stuff inside the <em>box</em>, you can pass a
character string and it will stay untouched.</p>
<p>In the few operations expecting a semi-colon (if-else and pluralization), it can also be
escaped with a double backslash.</p>
<p>In interpolations, the exclamation mark (<code>!</code>) signals a verbatim expression. But what
if you use it to mean the logical operation <em>not</em> in an operation-free interpolation?
In that case, you need a hack: use a question mark (<code>?</code>) first to indicate to the
algorithm that you want to evaluate the expression.</p>
<p>Ex.4: <code>smagic("{!TRUE} is {?!TRUE}")</code> leads to "TRUE is FALSE". The first expression is
taken verbatim while the second is evaluated.</p>
    </div>
    <div id="generic-regular-expression-flags">
    <h2>Generic regular expression flags</h2>
    


<p>All <code>stringmagic</code> functions support generic flags in regular-expression patterns.
The flags are useful to quickly give extra instructions, similarly to <em>usual</em>
<a href="https://javascript.info/regexp-introduction" class="external-link">regular expression flags</a>.</p>
<p>Here the syntax is "flag1, flag2/pattern". That is: flags are a comma separated list of flag-names
separated from the pattern with a slash (<code>/</code>). Example: <code>string_which(c("hello...", "world"), "fixed/.")</code> returns <code>1</code>.
Here the flag "fixed" removes the regular expression meaning of "." which would have otherwise meant <em>"any character"</em>.
The no-flag verion <code>string_which(c("hello...", "world"), ".")</code> returns <code>1:2</code>.</p>
<p>Alternatively, and this is recommended, you can collate the initials of the flags instead of using a
comma separated list. For example: "if/dt[" will apply the flags "ignore" and "fixed" to the pattern "dt[".</p>
<p>The four flags always available are: "ignore", "fixed", "word" and "magic".</p><ul><li><p>"ignore" instructs to ignore the case. Technically, it adds the perl-flag "(?i)"
at the beginning of the pattern.</p></li>
<li><p>"fixed" removes the regular expression interpretation, so that the characters ".", "$", "^", "["
(among others) lose their special meaning and are treated for what they are: simple characters.</p></li>
<li><p>"word" adds word boundaries (<code>"\\b"</code> in regex language) to the pattern. Further, the comma (<code>","</code>)
becomes a word separator. Technically, "word/one, two" is treated as "\b(one|two)\b". Example:
<code>string_clean("Am I ambushed?", "wi/am")</code> leads to " I ambushed?" thanks to the flags "ignore" and "word".</p></li>
<li><p>"magic" allows to interpolate variables inside the pattern before regex interpretation.
For example if <code>letters = "aiou"</code> then <code>string_clean("My great goose!", "magic/[{letters}] =&gt; e")</code>
leads to <code>"My greet geese!"</code></p></li>
</ul></div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>Other tools with aliases: 
<code><a href="cat_magic.html">cat_magic_alias</a>()</code>,
<code><a href="smagic_alias.html">smagic_alias</a>()</code>,
<code><a href="string_clean.html">string_clean_alias</a>()</code>,
<code><a href="string_ops.html">string_ops_alias</a>()</code>,
<code><a href="string_vec.html">string_vec_alias</a>()</code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># BASIC USAGE ####</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Romeo"</span>, <span class="st">"Juliet"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># {x} inserts x</span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Hello {x}!"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># elements in ... are collapsed with "" (default)</span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Hello {x[1]}, "</span>,</span></span>
<span class="r-in"><span>    <span class="st">"how is {x[2]} doing?"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Splitting a comma separated string</span></span></span>
<span class="r-in"><span><span class="co"># The mechanism is explained later</span></span></span>
<span class="r-in"><span><span class="fu"><a href="string_vec.html">string_vec</a></span><span class="op">(</span><span class="st">"J. Mills, David, Agnes, Dr Strong"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in string_vec("J. Mills, David, Agnes, Dr Strong"):</span> could not find function "string_vec"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Nota: this is equivalent to (explained later)</span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{', *'S ! J. Mills, David, Agnes, Dr Strong}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># Applying low level operations to strings</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Two main syntax:</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># A) expression evaluation</span></span></span>
<span class="r-in"><span><span class="co"># {operation ? x}</span></span></span>
<span class="r-in"><span><span class="co">#            | |</span></span></span>
<span class="r-in"><span><span class="co">#            |  \-&gt; the expression to be evaluated</span></span></span>
<span class="r-in"><span><span class="co">#             \-&gt; ? means that the expression will be evaluated</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># B) verbatim</span></span></span>
<span class="r-in"><span><span class="co"># {operation ! x}</span></span></span>
<span class="r-in"><span><span class="co">#            | |</span></span></span>
<span class="r-in"><span><span class="co">#            |  \-&gt; the expression taken as verbatim (here 'x')</span></span></span>
<span class="r-in"><span><span class="co">#             \-&gt; ! means that the expression is taken as verbatim</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># operation: usually 'arg'op with op an operation code.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example: splitting</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">=</span> <span class="st">"hello dear"</span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{' 's ? x}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span><span class="co"># x is split by ' '</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{' 's ! hello dear}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span><span class="co"># 'hello dear' is split by ' '</span></span></span>
<span class="r-in"><span><span class="co"># had we used ?, there would have been an error</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># There are 50+ string operators</span></span></span>
<span class="r-in"><span><span class="co"># Operators usually have a default value</span></span></span>
<span class="r-in"><span><span class="co"># Operations can have options</span></span></span>
<span class="r-in"><span><span class="co"># Operations can be chained by separating them with a comma</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example: default of 's' is ' ' + chaining with collapse</span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{s, ' my 'c ! hello dear}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># Nesting</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># {operations ! s1{expr}s2}</span></span></span>
<span class="r-in"><span><span class="co">#             |   |</span></span></span>
<span class="r-in"><span><span class="co">#             |    \-&gt; expr will be interpolated then added to the string</span></span></span>
<span class="r-in"><span><span class="co">#              \-&gt; nesting requires verbatim evaluation: '!'</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"The variables are: {C ! x{1:4}}."</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># This one is ugly but it shows triple nesting</span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"The variables are: {ws, C ! {2 times ! x{1:4}}{','s, 4 each !  ,_sq}}."</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># Splitting</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># s: split with fixed pattern, default is ' '</span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{s ! a b c}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{' b 's !a b c}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># S: same as 's' but default is ',[ \t\n]*'</span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{S !a, b, c}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{'[[:punct:] ]+'S ! a! b; c}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># add regex flags: e.g. fixed search</span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{'f/.'s ! hi.there}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># Collapsing</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># c and C do the same, their default is different</span></span></span>
<span class="r-in"><span><span class="co"># syntax: 's1|s2' with</span></span></span>
<span class="r-in"><span><span class="co"># - s1 the string used for collapsing</span></span></span>
<span class="r-in"><span><span class="co"># - s2 (optional) the string used for the last collapse</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># c: default is ' '</span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{c ? 1:3}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># C: default is ', | and '</span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{C ? 1:3}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{', | or 'c ? 1:4}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># Extraction</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># extract: to extract patterns (option first)</span></span></span>
<span class="r-in"><span><span class="co"># x: alias to extract.first</span></span></span>
<span class="r-in"><span><span class="co"># X: alias to extract</span></span></span>
<span class="r-in"><span><span class="co"># syntax: 'pattern'x</span></span></span>
<span class="r-in"><span><span class="co"># Default is '[[:alnum:]]+'</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">=</span> <span class="st">"This years is... 2020"</span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{x ? x}"</span><span class="op">)</span> <span class="co"># similar to smagic("{extract.first ? x}")</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{X ? x}"</span><span class="op">)</span> <span class="co"># similar to smagic("{extract ? x}")</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{'\\d+'x ? x}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># STRING FORMATTING ####</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># upper, lower, title</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># upper case the first letter</span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{upper.first ! julia mills}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># title case</span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{title ! julia mills}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># upper all letters</span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{upper ! julia mills}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># lower case</span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{lower ! JULIA MILLS}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># q, Q, bq: single, double, back quote</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{S, q, C ! Julia, David, Wilkins}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{S, Q, C ! Julia, David, Wilkins}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{S, bq, C ! Julia, David, Wilkins}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># format, Format: formats the string to fit the same length</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># format: the right side is filled with blanks</span></span></span>
<span class="r-in"><span><span class="co"># Format: the left side is filled with blanks, the string is right aligned</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">score</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="fl">2050</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">nm</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Wilkins"</span>, <span class="st">"David"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Monopoly scores:\n{'\n'c ! - {format ? nm}: {Format ? score} US$}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># OK that example may have been a bit too complex,</span></span></span>
<span class="r-in"><span><span class="co"># let's make it simple:</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Scores: {format ? score}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Names: {Format ? nm}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># ws: white space normalization</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># ws: suppresses trimming white spaces + normalizes successive white spaces</span></span></span>
<span class="r-in"><span><span class="co"># Add the following options in any order to:</span></span></span>
<span class="r-in"><span><span class="co"># - punct: remove punctuation</span></span></span>
<span class="r-in"><span><span class="co"># - digit: remove digits</span></span></span>
<span class="r-in"><span><span class="co"># - isolated: remove isolated characters</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{ws ! The   white  spaces are now clean.  }"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{ws.punct ! I, really -- truly; love punctuation!!!}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{ws.digit ! 1, 2, 12, a microphone check!}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{ws.i ! 1, 2, 12, a microphone check!}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{ws.d.i ! 1, 2, 12, a microphone check!}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{ws.p.d.i ! 1, 2, 12, a microphone check!}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># %: applies sprintf formatting</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> <span class="co"># add the formatting as a regular argument</span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"pi = {'.2f'% ? pi}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span><span class="co"># or right after the %</span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"pi = {%.2f ? pi}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># paste: appends text on each element</span></span></span>
<span class="r-in"><span><span class="co"># Accepts the options: right, both, front and back</span></span></span>
<span class="r-in"><span><span class="co"># It accepts the special values :1:, :i:, :I:, :a:, :A: to create enumerations</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># adding '|' on both sides</span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{'|'paste.both, ' + 'c ! x{1:4}}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Enumerations</span></span></span>
<span class="r-in"><span><span class="va">acad</span> <span class="op">=</span> <span class="fu"><a href="string_vec.html">string_vec</a></span><span class="op">(</span><span class="st">"you like admin, you enjoy working on weekends, you really love emails"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in string_vec("you like admin, you enjoy working on weekends, you really love emails"):</span> could not find function "string_vec"</span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Main reasons to pursue an academic career:\n {':i:) 'paste, C ? acad}."</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># You can also use the enum command</span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Main reasons to pursue an academic career:\n {enum.i ? acad}."</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># stopwords: removes basic English stopwords</span></span></span>
<span class="r-in"><span><span class="co"># the list is from the Snowball project:</span></span></span>
<span class="r-in"><span><span class="co">#  http://snowball.tartarus.org/algorithms/english/stop.txt</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{stop, ws ! It is a tale told by an idiot, full of sound and fury, signifying nothing.}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># k: keeps the first n characters</span></span></span>
<span class="r-in"><span><span class="co"># syntax: nk: keeps the first n characters</span></span></span>
<span class="r-in"><span><span class="co">#         'n|s'k: same + adds 's' at the end of shortened strings</span></span></span>
<span class="r-in"><span><span class="co">#         'n||s'k: same but 's' counts in the n characters kept</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">words</span> <span class="op">=</span> <span class="fu"><a href="string_vec.html">string_vec</a></span><span class="op">(</span><span class="st">"short, constitutional"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in string_vec("short, constitutional"):</span> could not find function "string_vec"</span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{5k ? words}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{'5|..'k ? words}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{'5||..'k ? words}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># K: keeps the first n elements</span></span></span>
<span class="r-in"><span><span class="co"># syntax: nK: keeps the first n elements</span></span></span>
<span class="r-in"><span><span class="co">#         'n|s'K: same + adds the element 's' at the end</span></span></span>
<span class="r-in"><span><span class="co">#         'n||s'K: same but 's' counts in the n elements kept</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># Special values :rest: and :REST:, give the number of items dropped</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">bx</span> <span class="op">=</span> <span class="fu"><a href="string_vec.html">string_vec</a></span><span class="op">(</span><span class="st">"Pessac Leognan, Saint Emilion, Marguaux, Saint Julien, Pauillac"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in string_vec("Pessac Leognan, Saint Emilion, Marguaux, Saint Julien, Pauillac"):</span> could not find function "string_vec"</span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Bordeaux wines I like: {3K, ', 'C ? bx}."</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Bordeaux wines I like: {'3|etc..'K, ', 'C ? bx}."</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Bordeaux wines I like: {'3||etc..'K, ', 'C ? bx}."</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Bordeaux wines I like: {'3|and at least :REST: others'K, ', 'C ? bx}."</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># Ko, KO: special operator which keeps the first n elements and adds "others"</span></span></span>
<span class="r-in"><span><span class="co"># syntax: nKo</span></span></span>
<span class="r-in"><span><span class="co"># KO gives the rest in letters</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Bordeaux wines I like: {4KO, C ? bx}."</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># r, R: string replacement </span></span></span>
<span class="r-in"><span><span class="co"># syntax: 's'R: deletes the content in 's' (replaces with the empty string)</span></span></span>
<span class="r-in"><span><span class="co">#         's1 =&gt; s2'R replaces s1 into s2</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{'e'r, ws ! The letter e is deleted}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># adding a perl look-behind</span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{'(?&lt;! )e'r !The letter e is deleted}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{'e =&gt; a'r !The letter e becomes a}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{'([[:alpha:]]{3})[[:alpha:]]+ =&gt; \\1.'r ! Trimming the words}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Alternative way with simple operations: split, shorten, collapse</span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{s, '3|.'k, c ! Trimming the words}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># times, each</span></span></span>
<span class="r-in"><span><span class="co"># They accept the option c to collapse with the empty string</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"N{10 times.c ! o}!"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{3 times.c ? 1:3}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{3 each.c ? 1:3}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># erase: replaces the items by the empty string</span></span></span>
<span class="r-in"><span><span class="co"># -&gt; useful in conditions</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{erase ! I am going to be annihilated}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># ELEMENT MANIPULATION ####</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># rm: removes the elements</span></span></span>
<span class="r-in"><span><span class="co"># Its (optional) argument is a regular expression giving which element to remove</span></span></span>
<span class="r-in"><span><span class="co"># Many options: "empty", "blank", "noalpha", "noalnum", "all" </span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Destroy"</span>, <span class="st">"All"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{'A'rm ? x}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{rm.all ? x}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="string_vec.html">string_vec</a></span><span class="op">(</span><span class="st">"1, 12, 123, 1234, 123456, 1234567"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in string_vec("1, 12, 123, 1234, 123456, 1234567"):</span> could not find function "string_vec"</span>
<span class="r-in"><span><span class="co"># we delete elements whose number of characters is lower or equal to 3</span></span></span>
<span class="r-in"><span><span class="co"># =&gt; see later section CONDITIONS</span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"{if(.nchar &gt; 3 ; nuke) ? x}"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># PLURALIZATION ####</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Two ways to enable pluralization:</span></span></span>
<span class="r-in"><span><span class="co"># {$ command}: means the plural is decuced from the length of the variable</span></span></span>
<span class="r-in"><span><span class="co"># {# command}: means the plural is decuced from the value of the variable</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Explanatory example</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Eschyle"</span>, <span class="st">"Sophocle"</span>, <span class="st">"Euripide"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">n</span> <span class="op">=</span> <span class="fl">37</span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"The author{$s, enum, have ? x} written {#N ? n} play{#s}."</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">=</span> <span class="st">"Laurent Berge"</span></span></span>
<span class="r-in"><span><span class="va">n</span> <span class="op">=</span> <span class="fl">0</span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"The author{$s, enum, have ? x} written {#N ? n} play{#s}."</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># How does it work?</span></span></span>
<span class="r-in"><span><span class="co"># First is {$s, enum, have ? x}.</span></span></span>
<span class="r-in"><span><span class="co"># The commands `s`, `enum` and `have` are applied to `x` which must come after a `?`</span></span></span>
<span class="r-in"><span><span class="co">#    =&gt; there the plural (whether an s is added and how to conjugate the verb have) depends</span></span></span>
<span class="r-in"><span><span class="co">#       on the **length** of the vector `x`</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># Second comes {#N ? n}.</span></span></span>
<span class="r-in"><span><span class="co"># The double dollar sign means that the command `N` will be applied to the **value** n.</span></span></span>
<span class="r-in"><span><span class="co"># The value must come after the `?`</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># Third is {#s}.</span></span></span>
<span class="r-in"><span><span class="co"># The object to which `s` should be applied is missing (there is no `? n`).</span></span></span>
<span class="r-in"><span><span class="co"># The default is to apply the command to the previous object. In this case,</span></span></span>
<span class="r-in"><span><span class="co">#  this is `n`.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Another similar example illustrating that we need not express the object several times:</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Eschyle"</span>, <span class="st">"Sophocle"</span>, <span class="st">"Euripide"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"The {Len ? x} classic author{$s, are, enum}."</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># ARGUMENTS FROM THE ENVIRONMENT ####</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Arguments can be evaluated from the calling environment.</span></span></span>
<span class="r-in"><span><span class="co"># Simply use backticks instead of quotes.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">dollar</span> <span class="op">=</span> <span class="fl">6</span></span></span>
<span class="r-in"><span><span class="va">reason</span> <span class="op">=</span> <span class="st">"glory"</span></span></span>
<span class="r-in"><span><span class="fu">smagic</span><span class="op">(</span><span class="st">"Why do you develop packages? For {`dollar`times.c ! $}?"</span>,</span></span>
<span class="r-in"><span>    <span class="st">"For money? No... for {upper,''s, c ? reason}!"</span>, .sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in missing(.default):</span> 'missing' can only be used for arguments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># Alias generation</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Let's create a formula filler</span></span></span>
<span class="r-in"><span><span class="co"># - we use .local_ops to create the ad hoc operation "add" which adds variables</span></span></span>
<span class="r-in"><span><span class="co"># - we transform into a formula ex post</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fml</span> <span class="op">=</span> <span class="fu"><a href="smagic_alias.html">smagic_alias</a></span><span class="op">(</span>.post <span class="op">=</span> <span class="va">as.formula</span>, .local_ops <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>add <span class="op">=</span> <span class="st">"' + 'collapse"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in smagic_alias(.post = as.formula, .local_ops = list(add = "' + 'collapse")):</span> unused arguments (.post = as.formula, .local_ops = list(add = "' + 'collapse"))</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># example with mtcars</span></span></span>
<span class="r-in"><span><span class="va">lhs</span> <span class="op">=</span> <span class="st">"mpg"</span></span></span>
<span class="r-in"><span><span class="va">rhs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hp"</span>, <span class="st">"drat"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">fml</span><span class="op">(</span><span class="st">"{lhs} ~ {add?rhs} + am"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in fml("{lhs} ~ {add?rhs} + am"):</span> could not find function "fml"</span>
<span class="r-in"><span>   </span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Laurent R Berge.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

